<html>

<head>
<title>GTIFGetDefn() - Read and Normalize GeoTIFF Definition</title>
</head>

<body>
<h1>GTIFKeyDefn() - Read and Normalize GeoTIFF Definition</h1>

<h3>Usage:</h3>

<b>
<pre>
    #include &lt;geotiff.h&gt;
    #include &lt;geo_normalize.h&gt;
    int GTIFGetDefn( GTIF *gtif, GTIFDefn * defn );
</pre>
</b>

<h3>Details:</h3>

This function reads the coordinate system definition from a GeoTIFF file,
and <i>normalizes</i> it into a set of component information using 
definitions from CSV (Comma Seperated Value ASCII) files derived from 
EPSG tables.  This function is intended to simplify correct support for
reading files with defined PCS (Projected Coordinate System) codes that
wouldn't otherwise be directly known by application software by reducing
it to the underlying projection method, parameters, datum, ellipsoid, 
prime meridian and units.<p>

The application should pass a pointer to an existing uninitialized 
GTIFDefn structure, and GTIFGetDefn() will fill it in.  The fuction 
currently always returns TRUE but in the future will return FALSE if 
CSV files are not found.  In any event, all geokeys actually found in the
file will be copied into the GTIFDefn.  However, if the CSV files aren't
found codes implied by other codes will not be set properly.<p>

<b>This interface is experimental, and not currently available in the
general release libgeotiff.  Contact 
<a href="mailto:warmerda@home.com">warmerda@home.com</a> for more information
on availablility.  Aspects of the GTIFDefn related functions may change
in future public releases.</b><p>

GTIFGetDefn() will not generally work if the EPSG derived CSV files cannot
be found.  By default a modest attempt will be made to find them, but 
in general it is necessary for the calling application to override the
logic to find them.  This can be done by calling the 
<a href="SetCSVFilenameHook.html">SetCSVFilenameHook()</a> function to
override the search method based on application knowledge of where they are
found.<p>

The GTIFDefn structure (defined in 
<a href="/cgi-bin/cvsweb.cgi/~checkout~/osrs/geotiff/libgeotiff/geo_normalize.h">geo_normalize.h</a>) currently looks like
this:<p>

<pre>
typedef struct {
    short	Model;		/* GTModelTypeGeoKey:
                                   ModelTypeGeographic or ModelTypeProjected */
    short	PCS;		/* ProjectedCSTypeGeoKey */
    short	GCS;		/* GeographicTypeGeoKey (Datum+PM) */

    short	UOMLength;	/* ProjLinearUnitsGeoKey (eg. Linear_Meter) */
    double	UOMLengthInMeters;  /* one UOM = UOMLengthInMeters meters*/

    short	Datum;		/* GeogGeodeticDatumGeoKey */

    short	PM;		/* GeogPrimeMeridianGeoKey */
    double	PMLongToGreenwich; /* dec. deg (Long of PM rel.to Green)*/

    short	Ellipsoid;	/* GeogEllipsoidGeoKey */
    double	SemiMajor;	/* in meters */
    double	SemiMinor;	/* in meters */

    short	ProjCode;	/* ProjectionGeoKey ... eg. Proj_UTM_11S */

    short	Projection;	/* EPSG code from TRF_METHOD */
    short	CTProjection;   /* ProjCoordTransGeoKey:
                                   GeoTIFF CT_* code from geo_ctrans.inc
                                   eg. CT_TransverseMercator */

    int		nParms;
    double	ProjParm[MAX_GTIF_PROJPARMS];
    int		ProjParmId[MAX_GTIF_PROJPARMS]; /* geokey identifier,
                                                   eg. ProjFalseEastingGeoKey*/

} GTIFDefn;
</pre>

The normalization methodology operates by fetching tags from the GeoTIFF
file, and then setting all other tags implied by them in the structure.  The
implied relationships are worked out by reading definitions from the 
various EPSG derived CSV tables.<p>

For instance, if a PCS (ProjectedCSTypeGeoKey) is found in the GeoTIFF file
this code is used to lookup a record in the <tt>horiz_cs.csv</tt> CSV
file.  For example given the PCS 26746 we can find the name
(NAD27 / California zone VI), the GCS 4257 (NAD27), and the ProjectionCode
10406 (California CS27 zone VI).  The GCS, and ProjectionCode can in turn
be looked up in other tables until all the details of units, ellipsoid, 
prime meridian, datum, projection (LambertConfConic_2SP) and projection
parameters are established.  A full listgeo dump of a file 
for this result might look like the following, all based on a single PCS
value:<p>

<pre>
% listgeo -norm ~/data/geotiff/pci_eg/spaf27.tif
Geotiff_Information:
   Version: 1
   Key_Revision: 1.0
   Tagged_Information:
      ModelTiepointTag (2,3):
         0                0                0                
         1577139.71       634349.176       0                
      ModelPixelScaleTag (1,3):
         195.509321       198.32184        0                
      End_Of_Tags.
   Keyed_Information:
      GTModelTypeGeoKey (Short,1): ModelTypeProjected
      GTRasterTypeGeoKey (Short,1): RasterPixelIsArea
      ProjectedCSTypeGeoKey (Short,1): PCS_NAD27_California_VI
      End_Of_Keys.
   End_Of_Geotiff.

PCS = 26746 (NAD27 / California zone VI)
Projection = 10406 (California CS27 zone VI)
Projection Method: CT_LambertConfConic_2SP
   ProjStdParallel1GeoKey: 33.883333
   ProjStdParallel2GeoKey: 32.766667
   ProjFalseOriginLatGeoKey: 32.166667
   ProjFalseOriginLongGeoKey: -116.233333
   ProjFalseEastingGeoKey: 609601.219202
   ProjFalseNorthingGeoKey: 0.000000
GCS: 4267/NAD27
Datum: 6267/North American Datum 1927
Ellipsoid: 7008/Clarke 1866 (6378206.40,6356583.80)
Prime Meridian: 8901/Greenwich (0.000000)
Projection Linear Units: 9003/US survey foot (0.304801m)
</pre>

Note that GTIFGetDefn() does not inspect or return the tiepoints and scale.
This must be handled seperately as it normally would.  It is intended to
simplify capture and normalization of the coordinate system definition.  
Note that GTIFGetDefn() also does the following things:

<ol>
<li> Convert all angular values to decimal degrees.
<li> Convert all linear values to meters. 
<li> Return the linear units and conversion to meters for the tiepoints and
scale (though the tiepoints and scale remain in their native units). 
<li> When reading projection parameters a variety of differences between
different GeoTIFF generators are handled, and a normalized set of parameters
for each projection are always returned.
</ol>

Code fields in the GTIFDefn are filled with KvUserDefined if there is not
value to assign.  The parameter lists for each of the underlying projection
transform methods can be found at the
<a href="http://gdal.velocet.ca/projects/tiff/proj_list">Projections</a>
page.  Note that nParms will be set based on the maximum parameter used.
Some of the parameters may not be used in which case the ProjParmId[] will
be zero.  This is done to retain correspondence to the EPSG parameter
numbering scheme.<p>

The 
<a href="/cgi-bin/cvsweb.cgi/~checkout~/osrs/geotiff/libgeotiff/geotiff_proj4.c">geotiff_proj4.c</a> module distributed with libgeotiff can 
be used as an example of code that converts a GTIFDefn into another projection
system.<p>

<b>See Also:</b> 

<a href="GTIFKeySet.html">GTIFKeySet()</a>,
<a href="SetCSVFilenameHook.html">SetCSVFilenameHook()</a>

</body>
</html>