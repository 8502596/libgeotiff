<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta name="robots" content="noindex">
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>cpl_csv_incode.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.2.3-20001105 on Sun Mar 4 23:32:44 2001 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>cpl_csv_incode.c</h1><div class="fragment"><pre>00001 <font class="comment">/**********************************************************************</font>
00002 <font class="comment"> * $Id$</font>
00003 <font class="comment"> *</font>
00004 <font class="comment"> * Name:     cpl_struct.c</font>
00005 <font class="comment"> * Project:  libgeotiff</font>
00006 <font class="comment"> * Purpose:  Provide "CSV API" interface to in-code EPSG CSV tables.</font>
00007 <font class="comment"> * Author:   Derrick J Brashear &lt;shadow@dementia.org&gt;</font>
00008 <font class="comment"> *</font>
00009 <font class="comment"> ******************************************************************************</font>
00010 <font class="comment"> * Copyright (c) 1999, Frank Warmerdam</font>
00011 <font class="comment"> *</font>
00012 <font class="comment"> * Permission is hereby granted, free of charge, to any person obtaining a</font>
00013 <font class="comment"> * copy of this software and associated documentation files (the "Software"),</font>
00014 <font class="comment"> * to deal in the Software without restriction, including without limitation</font>
00015 <font class="comment"> * the rights to use, copy, modify, merge, publish, distribute, sublicense,</font>
00016 <font class="comment"> * and/or sell copies of the Software, and to permit persons to whom the</font>
00017 <font class="comment"> * Software is furnished to do so, subject to the following conditions:</font>
00018 <font class="comment"> *</font>
00019 <font class="comment"> * The above copyright notice and this permission notice shall be included</font>
00020 <font class="comment"> * in all copies or substantial portions of the Software.</font>
00021 <font class="comment"> *</font>
00022 <font class="comment"> * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS</font>
00023 <font class="comment"> * OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</font>
00024 <font class="comment"> * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL</font>
00025 <font class="comment"> * THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</font>
00026 <font class="comment"> * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING</font>
00027 <font class="comment"> * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER</font>
00028 <font class="comment"> * DEALINGS IN THE SOFTWARE.</font>
00029 <font class="comment"> ******************************************************************************</font>
00030 <font class="comment"> *</font>
00031 <font class="comment"> * $Log$
00031 <font class="comment"> * Revision 1.2  2001/03/05 04:58:33  warmerda
00031 <font class="comment"> * updated
00031 <font class="comment"> *</font>
00032 <font class="comment"> * Revision 1.1  1999/12/10 18:00:58  warmerda</font>
00033 <font class="comment"> * New</font>
00034 <font class="comment"> *</font>
00035 <font class="comment"> */</font>
00036 
00037 <font class="preprocessor">#include &lt;stdio.h&gt;</font>
00038 <font class="preprocessor">#include "cpl_csv.h"</font>
00039 
00040 <font class="preprocessor">#include "defs.h"</font>
00041 
00042 <font class="keyword">extern</font> <font class="keyword">const</font> datafile_rows_t *compd_cs_rows[];
00043 <font class="keyword">extern</font> <font class="keyword">const</font> datafile_rows_t *ellips_alias_rows[];
00044 <font class="keyword">extern</font> <font class="keyword">const</font> datafile_rows_t *ellipsoid_rows[];
00045 <font class="keyword">extern</font> <font class="keyword">const</font> datafile_rows_t *gdatum_alias_rows[];
00046 <font class="keyword">extern</font> <font class="keyword">const</font> datafile_rows_t *geod_datum_rows[];
00047 <font class="keyword">extern</font> <font class="keyword">const</font> datafile_rows_t *geod_trf_rows[];
00048 <font class="keyword">extern</font> <font class="keyword">const</font> datafile_rows_t *horiz_cs_rows[];
00049 <font class="keyword">extern</font> <font class="keyword">const</font> datafile_rows_t *p_meridian_rows[];
00050 <font class="keyword">extern</font> <font class="keyword">const</font> datafile_rows_t *trf_nonpolynomial_rows[];
00051 <font class="keyword">extern</font> <font class="keyword">const</font> datafile_rows_t *trf_path_rows[];
00052 <font class="keyword">extern</font> <font class="keyword">const</font> datafile_rows_t *uom_an_alias_rows[];
00053 <font class="keyword">extern</font> <font class="keyword">const</font> datafile_rows_t *uom_angle_rows[];
00054 <font class="keyword">extern</font> <font class="keyword">const</font> datafile_rows_t *uom_le_alias_rows[];
00055 <font class="keyword">extern</font> <font class="keyword">const</font> datafile_rows_t *uom_length_rows[];
00056 <font class="keyword">extern</font> <font class="keyword">const</font> datafile_rows_t *uom_scale_rows[];
00057 <font class="keyword">extern</font> <font class="keyword">const</font> datafile_rows_t *uom_sc_alias_rows[];
00058 <font class="keyword">extern</font> <font class="keyword">const</font> datafile_rows_t *vert_cs_rows[];
00059 <font class="keyword">extern</font> <font class="keyword">const</font> datafile_rows_t *vert_datum_rows[];
00060 <font class="keyword">extern</font> <font class="keyword">const</font> datafile_rows_t *vert_offset_rows[];
00061 
00062 
00063 <font class="comment">/* Pointers to data */</font>
00064 <font class="keyword">static</font> <font class="keyword">const</font> datafile_t files[] = {
00065   { <font class="stringliteral">"compd_cs"</font>, compd_cs_rows },
00066   { <font class="stringliteral">"ellips_alias"</font>, ellips_alias_rows },
00067   { <font class="stringliteral">"ellipsoid"</font>, ellipsoid_rows },
00068   { <font class="stringliteral">"gdatum_alias"</font>, gdatum_alias_rows },
00069   { <font class="stringliteral">"geod_datum"</font>, geod_datum_rows },
00070   { <font class="stringliteral">"geod_trf"</font>, geod_trf_rows },
00071   { <font class="stringliteral">"horiz_cs"</font>, horiz_cs_rows },
00072   { <font class="stringliteral">"p_meridian"</font>, p_meridian_rows },
00073   { <font class="stringliteral">"trf_nonpolynomial"</font>, trf_nonpolynomial_rows },
00074   { <font class="stringliteral">"trf_path"</font>, trf_path_rows },
00075   { <font class="stringliteral">"uom_an_alias"</font>, uom_an_alias_rows },
00076   { <font class="stringliteral">"uom_angle"</font>, uom_angle_rows },
00077   { <font class="stringliteral">"uom_le_alias"</font>, uom_le_alias_rows },
00078   { <font class="stringliteral">"uom_length"</font>, uom_length_rows },
00079   { <font class="stringliteral">"uom_sc_alias"</font>, uom_sc_alias_rows },
00080   { <font class="stringliteral">"uom_scale"</font>, uom_scale_rows },
00081   { <font class="stringliteral">"vert_cs"</font>, vert_cs_rows },
00082   { <font class="stringliteral">"vert_datum"</font>, vert_datum_rows },
00083   { <font class="stringliteral">"vert_offset"</font>, vert_offset_rows },
00084   { NULL, NULL }
00085 };
00086 
00087 <font class="preprocessor">#if 0</font>
00088 <font class="preprocessor"></font>main()<font class="keyword"></font>
00089 <font class="keyword"></font>{
00090   datafile_t *csvfile;
00091   <font class="keywordtype">char</font> **papszRecord;
00092   <font class="keywordtype">int</font> i, row, col;
00093 
00094   papszRecord = CSVScanFileByName( <font class="stringliteral">"horiz_cs.csv"</font>, <font class="stringliteral">"HORIZCS_CODE"</font>,
00095                                    <font class="stringliteral">"2200"</font>, CC_Integer );
00096 
00097   printf (<font class="stringliteral">"%s %s\n"</font>, papszRecord[0], papszRecord[1]);
00098   csvfile = &amp;files[0];
00099   <font class="keywordflow">while</font> (csvfile-&gt;name != NULL) {
00100     printf(<font class="stringliteral">"file name is %s\n"</font>, csvfile-&gt;name);
00101     <font class="keywordflow">for</font> (i = 0; csvfile-&gt;cols[i]; i++) {
00102       printf(<font class="stringliteral">"column name is %s\n"</font>, csvfile-&gt;cols[i]);
00103       row = 1; col = 0;
00104       <font class="keywordflow">if</font> (csvfile-&gt;rows[row] &amp;&amp; csvfile-&gt;rows[row][col])
00105         printf(<font class="stringliteral">"value %d,%d is %s\n"</font>, row, col, csvfile-&gt;rows[row][col]);
00106     }
00107     csvfile++;
00108   }
00109 }
00110 <font class="preprocessor">#endif</font>
00111 <font class="preprocessor"></font>
00112 <font class="keyword">const</font> <font class="keywordtype">char</font> * CSVFilename( <font class="keyword">const</font> <font class="keywordtype">char</font> *pszBasename )<font class="keyword"></font>
00113 <font class="keyword"></font>{
00114   <font class="keywordflow">return</font> pszBasename;
00115 }
00116 
00117 <font class="keyword">static</font> <font class="keywordtype">int</font> CSVCompare( <font class="keyword">const</font> <font class="keywordtype">char</font> * pszFieldValue, <font class="keyword">const</font> <font class="keywordtype">char</font> * pszTarget,
00118                        CSVCompareCriteria eCriteria )<font class="keyword"></font>
00119 <font class="keyword"></font>{
00120     <font class="keywordflow">if</font>( eCriteria == CC_ExactString )
00121     {
00122         <font class="keywordflow">return</font>( strcmp( pszFieldValue, pszTarget ) == 0 );
00123     }
00124     <font class="keywordflow">else</font> <font class="keywordflow">if</font>( eCriteria == CC_ApproxString )
00125     {
00126         <font class="keywordflow">return</font>( strcasecmp( pszFieldValue, pszTarget ) );
00127     }
00128     <font class="keywordflow">else</font> <font class="keywordflow">if</font>( eCriteria == CC_Integer )
00129     {
00130         <font class="keywordflow">return</font>( atoi(pszFieldValue) == atoi(pszTarget) );
00131     }
00132     <font class="keywordflow">return</font> FALSE;
00133 }
00134 
00135 <font class="keyword">static</font> <font class="keywordtype">int</font> __CSVGetFileId( <font class="keyword">const</font> <font class="keywordtype">char</font> * pszFilename)<font class="keyword"></font>
00136 <font class="keyword"></font>{
00137   datafile_t *csvfile;
00138   <font class="keywordtype">int</font> i = 0;
00139 
00140   csvfile = (datafile_t *)&amp;files[i];
00141   <font class="keywordflow">for</font> (i = 0; csvfile-&gt;name; i++, csvfile = (datafile_t *)&amp;files[i])
00142   {
00143     <font class="keywordflow">if</font> (!strncmp(csvfile-&gt;name,pszFilename,(strlen(pszFilename)-4)))
00144       <font class="keywordflow">return</font> i;
00145   }
00146 
00147   <font class="keywordflow">return</font> -1;
00148 }
00149 
00150 <font class="keywordtype">char</font> **CSVScanFileByName( <font class="keyword">const</font> <font class="keywordtype">char</font> * pszFilename,
00151                           <font class="keyword">const</font> <font class="keywordtype">char</font> * pszKeyFieldName,
00152                           <font class="keyword">const</font> <font class="keywordtype">char</font> * pszValue, 
00153                           CSVCompareCriteria eCriteria )<font class="keyword"></font>
00154 <font class="keyword"></font>{
00155   datafile_t *csvfile;
00156   <font class="keywordtype">int</font> row, col;
00157 
00158   col = CSVGetFileFieldId(pszFilename, pszKeyFieldName);
00159 
00160   csvfile = (datafile_t *)&amp;files[__CSVGetFileId(pszFilename)];
00161   <font class="keywordflow">for</font> (row = 1; ((csvfile-&gt;rows[row] != 0) &amp;&amp; (csvfile-&gt;rows[row][col] != 0));
00162        row++) {
00163     <font class="keywordflow">if</font> (CSVCompare(csvfile-&gt;rows[row][col], pszValue, eCriteria))
00164       <font class="keywordflow">return</font> ((<font class="keywordtype">char</font> **)csvfile-&gt;rows[row]);
00165   }
00166 
00167   <font class="keywordflow">return</font> NULL;
00168 }
00169 
00170 <font class="keywordtype">int</font> CSVGetFileFieldId( <font class="keyword">const</font> <font class="keywordtype">char</font> * pszFilename, <font class="keyword">const</font> <font class="keywordtype">char</font> * pszFieldName)<font class="keyword"></font>
00171 <font class="keyword"></font>{
00172     datafile_t *csvfile;
00173     <font class="keywordtype">int</font> i;
00174 
00175     csvfile = (datafile_t *)&amp;files[__CSVGetFileId(pszFilename)];
00176     <font class="keywordflow">if</font> (!strncmp(csvfile-&gt;name,pszFilename,(strlen(pszFilename)-4)))
00177     {
00178         <font class="keywordflow">for</font> (i = 0; csvfile-&gt;rows[0][i]; i++) 
00179             <font class="keywordflow">if</font> (!strcasecmp(pszFieldName, csvfile-&gt;rows[0][i]))
00180                 <font class="keywordflow">return</font> i;
00181     }
00182 
00183     <font class="keywordflow">return</font> -1;
00184 }
00185 
00186 <font class="keyword">const</font> <font class="keywordtype">char</font> *CSVGetField( <font class="keyword">const</font> <font class="keywordtype">char</font> * pszFilename,
00187                          <font class="keyword">const</font> <font class="keywordtype">char</font> * pszKeyFieldName,
00188                          <font class="keyword">const</font> <font class="keywordtype">char</font> * pszKeyFieldValue,
00189                          CSVCompareCriteria eCriteria,
00190                          <font class="keyword">const</font> <font class="keywordtype">char</font> * pszTargetField )<font class="keyword"></font>
00191 <font class="keyword"></font>{
00192   <font class="keywordtype">char</font> **papszRecord;
00193 
00194   papszRecord = CSVScanFileByName( pszFilename, pszKeyFieldName,
00195                                    pszKeyFieldValue, CC_Integer );
00196 
00197   <font class="keywordflow">return</font> (papszRecord[CSVGetFileFieldId(pszFilename, pszTargetField)]);
00198 }
00199 
00200 <font class="comment">/* Dummy function */</font>
00201 <font class="keywordtype">void</font> SetCSVFilenameHook( <font class="keyword">const</font> <font class="keywordtype">char</font> *(*pfnNewHook)( <font class="keyword">const</font> <font class="keywordtype">char</font> * ) )
00202 
00203 {
00204 }
</div></pre><hr><address><small>Generated at Sun Mar 4 23:32:44 2001 for libgeotiff by
<a href="http://www.stack.nl/~dimitri/doxygen/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.3-20001105 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2000</small></address>
</body>
</html>
