<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta name="robots" content="noindex">
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>geo_normalize.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.2.3-20001105 on Sun Mar 4 23:32:44 2001 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>geo_normalize.c</h1><div class="fragment"><pre>00001 <font class="comment">/******************************************************************************</font>
00002 <font class="comment"> * $Id$</font>
00003 <font class="comment"> *</font>
00004 <font class="comment"> * Project:  libgeotiff</font>
00005 <font class="comment"> * Purpose:  Code to normalize PCS and other composite codes in a GeoTIFF file.</font>
00006 <font class="comment"> * Author:   Frank Warmerdam, warmerda@home.com</font>
00007 <font class="comment"> *</font>
00008 <font class="comment"> ******************************************************************************</font>
00009 <font class="comment"> * Copyright (c) 1999, Frank Warmerdam</font>
00010 <font class="comment"> *</font>
00011 <font class="comment"> * Permission is hereby granted, free of charge, to any person obtaining a</font>
00012 <font class="comment"> * copy of this software and associated documentation files (the "Software"),</font>
00013 <font class="comment"> * to deal in the Software without restriction, including without limitation</font>
00014 <font class="comment"> * the rights to use, copy, modify, merge, publish, distribute, sublicense,</font>
00015 <font class="comment"> * and/or sell copies of the Software, and to permit persons to whom the</font>
00016 <font class="comment"> * Software is furnished to do so, subject to the following conditions:</font>
00017 <font class="comment"> *</font>
00018 <font class="comment"> * The above copyright notice and this permission notice shall be included</font>
00019 <font class="comment"> * in all copies or substantial portions of the Software.</font>
00020 <font class="comment"> *</font>
00021 <font class="comment"> * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS</font>
00022 <font class="comment"> * OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</font>
00023 <font class="comment"> * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL</font>
00024 <font class="comment"> * THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</font>
00025 <font class="comment"> * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING</font>
00026 <font class="comment"> * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER</font>
00027 <font class="comment"> * DEALINGS IN THE SOFTWARE.</font>
00028 <font class="comment"> ******************************************************************************</font>
00029 <font class="comment"> *</font>
00030 <font class="comment"> * $Log$
00030 <font class="comment"> * Revision 1.2  2001/03/05 04:58:33  warmerda
00030 <font class="comment"> * updated
00030 <font class="comment"> *</font>
00031 <font class="comment"> * Revision 1.24  2001/03/05 03:26:29  warmerda</font>
00032 <font class="comment"> * fixed memory leaks in GTIFPrintDefn()</font>
00033 <font class="comment"> *</font>
00034 <font class="comment"> * Revision 1.23  2001/02/23 13:49:48  warmerda</font>
00035 <font class="comment"> * Fixed GTIFPrintDefn() to use fprintf( fp ), instead of printf().</font>
00036 <font class="comment"> *</font>
00037 <font class="comment"> * Revision 1.22  2000/10/13 14:30:57  warmerda</font>
00038 <font class="comment"> * fixed LCC parm order when parameters read directly from geotiff file</font>
00039 <font class="comment"> *</font>
00040 <font class="comment"> * Revision 1.21  2000/09/15 19:30:14  warmerda</font>
00041 <font class="comment"> * report units of linear proj parms</font>
00042 <font class="comment"> *</font>
00043 <font class="comment"> * Revision 1.20  2000/09/15 18:21:07  warmerda</font>
00044 <font class="comment"> * Fixed order of parameters for LCC 2SP.  When parameters</font>
00045 <font class="comment"> * were read from EPSG CSV files the standard parallels and origin</font>
00046 <font class="comment"> * were mixed up.  This affects alot of state plane zones!</font>
00047 <font class="comment"> *</font>
00048 <font class="comment"> * Revision 1.19  2000/06/09 14:05:43  warmerda</font>
00049 <font class="comment"> * added default knowledge of NAD27/NAD83/WGS72/WGS84</font>
00050 <font class="comment"> *</font>
00051 <font class="comment"> * Revision 1.18  1999/12/10 21:28:12  warmerda</font>
00052 <font class="comment"> * fixed Stereographic to look for ProjCenterLat/Long</font>
00053 <font class="comment"> *</font>
00054 <font class="comment"> * Revision 1.17  1999/12/10 20:06:58  warmerda</font>
00055 <font class="comment"> * fixed up scale geokey used for a couple of projections</font>
00056 <font class="comment"> *</font>
00057 <font class="comment"> * Revision 1.16  1999/12/10 19:50:21  warmerda</font>
00058 <font class="comment"> * Added EquidistantConic support, fixed return of StdParallel2GeoKey for</font>
00059 <font class="comment"> * LCC2, and Albers.</font>
00060 <font class="comment"> *</font>
00061 <font class="comment"> * Revision 1.15  1999/12/10 19:39:26  warmerda</font>
00062 <font class="comment"> * Fixed bug setting the false northing for files with</font>
00063 <font class="comment"> * ProjCenterNorthingGeoKey set in GTIFGetDefn().</font>
00064 <font class="comment"> *</font>
00065 <font class="comment"> * Revision 1.14  1999/09/17 14:58:37  warmerda</font>
00066 <font class="comment"> * Added ProjRectifiedGridAngleGeoKey(3096) and support for it's</font>
00067 <font class="comment"> * use with Oblique Mercator in geo_normalize.c.</font>
00068 <font class="comment"> *</font>
00069 <font class="comment"> * Revision 1.13  1999/09/17 00:55:26  warmerda</font>
00070 <font class="comment"> * added GTIFGetUOMAngleInfo(), and UOMAngle in GTIFDefn</font>
00071 <font class="comment"> *</font>
00072 <font class="comment"> * Revision 1.12  1999/09/15 18:51:31  warmerda</font>
00073 <font class="comment"> * Map 9808 to TM South Oriented, not TM Modified Alaska.</font>
00074 <font class="comment"> *</font>
00075 <font class="comment"> * Revision 1.11  1999/09/15 16:44:06  warmerda</font>
00076 <font class="comment"> * Change meter to metre to match EPSG database in GTIFGetUOMLengthInfo()</font>
00077 <font class="comment"> * shortcut.</font>
00078 <font class="comment"> *</font>
00079 <font class="comment"> * Revision 1.10  1999/09/15 16:35:15  warmerda</font>
00080 <font class="comment"> * Fixed the fractions of second handling properly in GTIFAngleStringToDD().</font>
00081 <font class="comment"> *</font>
00082 <font class="comment"> * Revision 1.9  1999/09/15 14:24:17  warmerda</font>
00083 <font class="comment"> * Fixed serious bug in geo_normalize.c with translation of</font>
00084 <font class="comment"> * DD.MMSSsss values.  Return value was seriously off if any</font>
00085 <font class="comment"> * fraction of a second was included in the string.</font>
00086 <font class="comment"> *</font>
00087 <font class="comment"> * Revision 1.8  1999/07/13 03:12:52  warmerda</font>
00088 <font class="comment"> * Make scale a parameter of CT_Stereographic.</font>
00089 <font class="comment"> *</font>
00090 <font class="comment"> * Revision 1.7  1999/05/04 03:13:22  warmerda</font>
00091 <font class="comment"> * fixed a serious bug in parsing DMSmmss.sss values, and a bug in forming DMS strings</font>
00092 <font class="comment"> *</font>
00093 <font class="comment"> * Revision 1.6  1999/05/03 17:50:31  warmerda</font>
00094 <font class="comment"> * avoid warnings on IRIX</font>
00095 <font class="comment"> *</font>
00096 <font class="comment"> * Revision 1.5  1999/04/28 20:04:51  warmerda</font>
00097 <font class="comment"> * Added doxygen style documentation.</font>
00098 <font class="comment"> * Use GTIFPCSToMapSys() and related functions to partially normalize</font>
00099 <font class="comment"> * projections when we don't have the CSV files.</font>
00100 <font class="comment"> *</font>
00101 <font class="comment"> * Revision 1.4  1999/03/18 21:34:59  geotiff</font>
00102 <font class="comment"> * added GTIFDecToDMS</font>
00103 <font class="comment"> *</font>
00104 <font class="comment"> * Revision 1.3  1999/03/17 19:53:15  geotiff</font>
00105 <font class="comment"> * sys includes moved to cpl_serv.h</font>
00106 <font class="comment"> *</font>
00107 <font class="comment"> * Revision 1.2  1999/03/10 18:24:06  geotiff</font>
00108 <font class="comment"> * corrected to use int'</font>
00109 <font class="comment"> *</font>
00110 <font class="comment"> * Revision 1.1  1999/03/09 15:57:04  geotiff</font>
00111 <font class="comment"> * New</font>
00112 <font class="comment"> *</font>
00113 <font class="comment"> * Revision 1.4  1999/03/03 02:29:38  warmerda</font>
00114 <font class="comment"> * Define PI if not already defined.</font>
00115 <font class="comment"> *</font>
00116 <font class="comment"> * Revision 1.3  1999/03/02 21:10:57  warmerda</font>
00117 <font class="comment"> * added lots of projections</font>
00118 <font class="comment"> *</font>
00119 <font class="comment"> * Revision 1.2  1999/02/24 16:24:15  warmerda</font>
00120 <font class="comment"> * Continuing to evolve</font>
00121 <font class="comment"> *</font>
00122 <font class="comment"> * Revision 1.1  1999/02/22 18:51:08  warmerda</font>
00123 <font class="comment"> * New</font>
00124 <font class="comment"> *</font>
00125 <font class="comment"> */</font>
00126  
00127 <font class="preprocessor">#include "cpl_csv.h"</font>
00128 <font class="preprocessor">#include "<a class="code" href="geotiff_h.html">geotiff.h</a>"</font>
00129 <font class="preprocessor">#include "<a class="code" href="xtiffio_h.html">xtiffio.h</a>"</font>
00130 <font class="preprocessor">#include "geovalues.h"</font>
00131 <font class="preprocessor">#include "<a class="code" href="geo_normalize_h.html">geo_normalize.h</a>"</font>
00132 
00133 <font class="preprocessor">#ifndef KvUserDefined</font>
00134 <font class="preprocessor"></font><font class="preprocessor">#  define KvUserDefined 32767</font>
00135 <font class="preprocessor"></font><font class="preprocessor">#endif</font>
00136 <font class="preprocessor"></font>
00137 <font class="preprocessor">#ifndef PI</font>
00138 <font class="preprocessor"></font><font class="preprocessor">#  define PI 3.14159265358979323846</font>
00139 <font class="preprocessor"></font><font class="preprocessor">#endif</font>
00140 <font class="preprocessor"></font>
00141 <font class="comment">/************************************************************************/</font>
00142 <font class="comment">/*                           GTIFGetPCSInfo()                           */</font>
00143 <font class="comment">/************************************************************************/</font>
00144 
00145 <font class="keywordtype">int</font> GTIFGetPCSInfo( <font class="keywordtype">int</font> nPCSCode, <font class="keywordtype">char</font> **ppszEPSGName,
00146                     <font class="keywordtype">short</font> *pnUOMLengthCode, <font class="keywordtype">short</font> *pnUOMAngleCode,
00147                     <font class="keywordtype">short</font> *pnGeogCS, <font class="keywordtype">short</font> *pnTRFCode )<font class="keyword"></font>
00148 <font class="keyword"></font>
00149 <font class="keyword"></font>{
00150     <font class="keywordtype">char</font>        **papszRecord;
00151     <font class="keywordtype">char</font>        szSearchKey[24];
00152     <font class="keyword">const</font> <font class="keywordtype">char</font>  *pszFilename = CSVFilename( <font class="stringliteral">"horiz_cs.csv"</font> );
00153     
00154 <font class="comment">/* -------------------------------------------------------------------- */</font>
00155 <font class="comment">/*      Search the units database for this unit.  If we don't find      */</font>
00156 <font class="comment">/*      it return failure.                                              */</font>
00157 <font class="comment">/* -------------------------------------------------------------------- */</font>
00158     sprintf( szSearchKey, <font class="stringliteral">"%d"</font>, nPCSCode );
00159     papszRecord = CSVScanFileByName( pszFilename, <font class="stringliteral">"HORIZCS_CODE"</font>,
00160                                      szSearchKey, CC_Integer );
00161 
00162     <font class="keywordflow">if</font>( papszRecord == NULL )
00163         <font class="keywordflow">return</font> FALSE;
00164 
00165 <font class="comment">/* -------------------------------------------------------------------- */</font>
00166 <font class="comment">/*      Get the name, if requested.                                     */</font>
00167 <font class="comment">/* -------------------------------------------------------------------- */</font>
00168     <font class="keywordflow">if</font>( ppszEPSGName != NULL )
00169     {
00170         *ppszEPSGName =
00171             CPLStrdup( CSLGetField( papszRecord,
00172                                     CSVGetFileFieldId(pszFilename,
00173                                                       <font class="stringliteral">"HORIZCS_EPSG_NAME"</font>) ));
00174     }
00175 
00176 <font class="comment">/* -------------------------------------------------------------------- */</font>
00177 <font class="comment">/*      Get the UOM Length code, if requested.                          */</font>
00178 <font class="comment">/* -------------------------------------------------------------------- */</font>
00179     <font class="keywordflow">if</font>( pnUOMLengthCode != NULL )
00180     {
00181         <font class="keyword">const</font> <font class="keywordtype">char</font>      *pszValue;
00182 
00183         pszValue =
00184             CSLGetField( papszRecord,
00185                          CSVGetFileFieldId(pszFilename,<font class="stringliteral">"UOM_LENGTH_CODE"</font>));
00186         <font class="keywordflow">if</font>( atoi(pszValue) &gt; 0 )
00187             *pnUOMLengthCode = atoi(pszValue);
00188         <font class="keywordflow">else</font>
00189             *pnUOMLengthCode = KvUserDefined;
00190     }
00191 
00192 <font class="comment">/* -------------------------------------------------------------------- */</font>
00193 <font class="comment">/*      Get the UOM Angle code, if requested.                           */</font>
00194 <font class="comment">/* -------------------------------------------------------------------- */</font>
00195     <font class="keywordflow">if</font>( pnUOMAngleCode != NULL )
00196     {
00197         <font class="keyword">const</font> <font class="keywordtype">char</font>      *pszValue;
00198         
00199         pszValue =
00200             CSLGetField( papszRecord,
00201                          CSVGetFileFieldId(pszFilename,<font class="stringliteral">"UOM_ANGLE_CODE"</font>) );
00202         
00203         <font class="keywordflow">if</font>( atoi(pszValue) &gt; 0 )
00204             *pnUOMAngleCode = atoi(pszValue);
00205         <font class="keywordflow">else</font>
00206             *pnUOMAngleCode = KvUserDefined;
00207     }
00208 
00209 <font class="comment">/* -------------------------------------------------------------------- */</font>
00210 <font class="comment">/*      Get the GeogCS (Datum with PM) code, if requested.              */</font>
00211 <font class="comment">/* -------------------------------------------------------------------- */</font>
00212     <font class="keywordflow">if</font>( pnGeogCS != NULL )
00213     {
00214         <font class="keyword">const</font> <font class="keywordtype">char</font>      *pszValue;
00215 
00216         pszValue =
00217             CSLGetField( papszRecord,
00218                          CSVGetFileFieldId(pszFilename,<font class="stringliteral">"SOURCE_GEOGCS_CODE"</font>) );
00219         <font class="keywordflow">if</font>( atoi(pszValue) &gt; 0 )
00220             *pnGeogCS = atoi(pszValue);
00221         <font class="keywordflow">else</font>
00222             *pnGeogCS = KvUserDefined;
00223     }
00224 
00225 <font class="comment">/* -------------------------------------------------------------------- */</font>
00226 <font class="comment">/*      Get the GeogCS (Datum with PM) code, if requested.              */</font>
00227 <font class="comment">/* -------------------------------------------------------------------- */</font>
00228     <font class="keywordflow">if</font>( pnTRFCode != NULL )
00229     {
00230         <font class="keyword">const</font> <font class="keywordtype">char</font>      *pszValue;
00231 
00232         pszValue =
00233             CSLGetField( papszRecord,
00234                          CSVGetFileFieldId(pszFilename,<font class="stringliteral">"PROJECTION_TRF_CODE"</font>));
00235                          
00236         
00237         <font class="keywordflow">if</font>( atoi(pszValue) &gt; 0 )
00238             *pnTRFCode = atoi(pszValue);
00239         <font class="keywordflow">else</font>
00240             *pnTRFCode = KvUserDefined;
00241     }
00242 
00243     <font class="keywordflow">return</font> TRUE;
00244 }
00245 
00246 <font class="comment">/************************************************************************/</font>
00247 <font class="comment">/*                           GTIFAngleToDD()                            */</font>
00248 <font class="comment">/*                                                                      */</font>
00249 <font class="comment">/*      Convert a numeric angle to decimal degress.                     */</font>
00250 <font class="comment">/************************************************************************/</font>
00251 
00252 <font class="keywordtype">double</font> GTIFAngleToDD( <font class="keywordtype">double</font> dfAngle, <font class="keywordtype">int</font> nUOMAngle )<font class="keyword"></font>
00253 <font class="keyword"></font>
00254 <font class="keyword"></font>{
00255     <font class="keywordflow">if</font>( nUOMAngle == 9110 )             <font class="comment">/* DDD.MMSSsss */</font>
00256     {
00257         <font class="keywordtype">char</font>    szAngleString[32];
00258 
00259         sprintf( szAngleString, <font class="stringliteral">"%12.7f"</font>, dfAngle );
00260         dfAngle = GTIFAngleStringToDD( szAngleString, nUOMAngle );
00261     }
00262     <font class="keywordflow">else</font>
00263     {
00264         <font class="keywordtype">double</font>          dfInDegrees;
00265         
00266         GTIFGetUOMAngleInfo( nUOMAngle, NULL, &amp;dfInDegrees );
00267         dfAngle = dfAngle * dfInDegrees;
00268     }
00269 
00270     <font class="keywordflow">return</font>( dfAngle );
00271 }
00272 
00273 <font class="comment">/************************************************************************/</font>
00274 <font class="comment">/*                        GTIFAngleStringToDD()                         */</font>
00275 <font class="comment">/*                                                                      */</font>
00276 <font class="comment">/*      Convert an angle in the specified units to decimal degrees.     */</font>
00277 <font class="comment">/************************************************************************/</font>
00278 
00279 <font class="keywordtype">double</font> GTIFAngleStringToDD( <font class="keyword">const</font> <font class="keywordtype">char</font> * pszAngle, <font class="keywordtype">int</font> nUOMAngle )<font class="keyword"></font>
00280 <font class="keyword"></font>
00281 <font class="keyword"></font>{
00282     <font class="keywordtype">double</font>      dfAngle;
00283     
00284     <font class="keywordflow">if</font>( nUOMAngle == 9110 )             <font class="comment">/* DDD.MMSSsss */</font>
00285     {
00286         <font class="keywordtype">char</font>    *pszDecimal;
00287         
00288         dfAngle = ABS(atoi(pszAngle));
00289         pszDecimal = strchr(pszAngle,<font class="charliteral">'.'</font>);
00290         <font class="keywordflow">if</font>( pszDecimal != NULL &amp;&amp; strlen(pszDecimal) &gt; 1 )
00291         {
00292             <font class="keywordtype">char</font>        szMinutes[3];
00293             <font class="keywordtype">char</font>        szSeconds[64];
00294 
00295             szMinutes[0] = pszDecimal[1];
00296             <font class="keywordflow">if</font>( pszDecimal[2] &gt;= <font class="charliteral">'0'</font> &amp;&amp; pszDecimal[2] &lt;= <font class="charliteral">'9'</font> )
00297                 szMinutes[1] = pszDecimal[2];
00298             <font class="keywordflow">else</font>
00299                 szMinutes[1] = <font class="charliteral">'0'</font>;
00300             
00301             szMinutes[2] = <font class="charliteral">'\0'</font>;
00302             dfAngle += atoi(szMinutes) / 60.0;
00303 
00304             <font class="keywordflow">if</font>( strlen(pszDecimal) &gt; 3 )
00305             {
00306                 szSeconds[0] = pszDecimal[3];
00307                 <font class="keywordflow">if</font>( pszDecimal[4] &gt;= <font class="charliteral">'0'</font> &amp;&amp; pszDecimal[4] &lt;= <font class="charliteral">'9'</font> )
00308                 {
00309                     szSeconds[1] = pszDecimal[4];
00310                     szSeconds[2] = <font class="charliteral">'.'</font>;
00311                     strcpy( szSeconds+3, pszDecimal + 5 );
00312                 }
00313                 <font class="keywordflow">else</font>
00314                 {
00315                     szSeconds[1] = <font class="charliteral">'0'</font>;
00316                     szSeconds[2] = <font class="charliteral">'\0'</font>;
00317                 }
00318                 dfAngle += atof(szSeconds) / 3600.0;
00319             }
00320         }
00321 
00322         <font class="keywordflow">if</font>( pszAngle[0] == <font class="charliteral">'-'</font> )
00323             dfAngle *= -1;
00324     }
00325     <font class="keywordflow">else</font> <font class="keywordflow">if</font>( nUOMAngle == 9105 || nUOMAngle == 9106 )   <font class="comment">/* grad */</font>
00326     {
00327         dfAngle = 180 * (atof(pszAngle ) / 200);
00328     }
00329     <font class="keywordflow">else</font> <font class="keywordflow">if</font>( nUOMAngle == 9101 )                        <font class="comment">/* radians */</font>
00330     {
00331         dfAngle = 180 * (atof(pszAngle ) / PI);
00332     }
00333     <font class="keywordflow">else</font> <font class="keywordflow">if</font>( nUOMAngle == 9103 )                        <font class="comment">/* arc-minute */</font>
00334     {
00335         dfAngle = atof(pszAngle) / 60;
00336     }
00337     <font class="keywordflow">else</font> <font class="keywordflow">if</font>( nUOMAngle == 9104 )                        <font class="comment">/* arc-second */</font>
00338     {
00339         dfAngle = atof(pszAngle) / 3600;
00340     }
00341     <font class="keywordflow">else</font> <font class="comment">/* decimal degrees ... some cases missing but seeminly never used */</font>
00342     {
00343         CPLAssert( nUOMAngle == 9102 || nUOMAngle == KvUserDefined
00344                    || nUOMAngle == 0 );
00345         
00346         dfAngle = atof(pszAngle );
00347     }
00348 
00349     <font class="keywordflow">return</font>( dfAngle );
00350 }
00351 
00352 <font class="comment">/************************************************************************/</font>
00353 <font class="comment">/*                           GTIFGetGCSInfo()                           */</font>
00354 <font class="comment">/*                                                                      */</font>
00355 <font class="comment">/*      Fetch the datum, and prime meridian related to a particular     */</font>
00356 <font class="comment">/*      GCS.                                                            */</font>
00357 <font class="comment">/************************************************************************/</font>
00358 
00359 <font class="keywordtype">int</font> GTIFGetGCSInfo( <font class="keywordtype">int</font> nGCSCode, <font class="keywordtype">char</font> ** ppszName,
00360                     <font class="keywordtype">short</font> * pnDatum, <font class="keywordtype">short</font> * pnPM, <font class="keywordtype">short</font> *pnUOMAngle )<font class="keyword"></font>
00361 <font class="keyword"></font>
00362 <font class="keyword"></font>{
00363     <font class="keywordtype">char</font>        szSearchKey[24];
00364     <font class="keywordtype">int</font>         nDatum, nPM, nUOMAngle;
00365 
00366 <font class="comment">/* -------------------------------------------------------------------- */</font>
00367 <font class="comment">/*      Search the database for the corresponding datum code.           */</font>
00368 <font class="comment">/* -------------------------------------------------------------------- */</font>
00369     sprintf( szSearchKey, <font class="stringliteral">"%d"</font>, nGCSCode );
00370 
00371     nDatum = atoi(CSVGetField( CSVFilename(<font class="stringliteral">"horiz_cs.csv"</font> ),
00372                                <font class="stringliteral">"HORIZCS_CODE"</font>, szSearchKey, CC_Integer,
00373                                <font class="stringliteral">"GEOD_DATUM_CODE"</font> ) );
00374 
00375 <font class="comment">/* -------------------------------------------------------------------- */</font>
00376 <font class="comment">/*      Handle some "well known" GCS codes directly if the table        */</font>
00377 <font class="comment">/*      wasn't found.                                                   */</font>
00378 <font class="comment">/* -------------------------------------------------------------------- */</font>
00379     <font class="keywordflow">if</font>( nDatum &lt; 1 )
00380     {
00381         <font class="keyword">const</font> <font class="keywordtype">char</font> * pszName = NULL;
00382         nPM = PM_Greenwich;
00383         nUOMAngle = Angular_DMS_Hemisphere; 
00384         <font class="keywordflow">if</font>( nGCSCode == GCS_NAD27 )
00385         {
00386             nDatum = Datum_North_American_Datum_1927;
00387             pszName = <font class="stringliteral">"NAD27"</font>;
00388         }
00389         <font class="keywordflow">else</font> <font class="keywordflow">if</font>( nGCSCode == GCS_NAD83 )
00390         {
00391             nDatum = Datum_North_American_Datum_1983;
00392             pszName = <font class="stringliteral">"NAD83"</font>;
00393         }
00394         <font class="keywordflow">else</font> <font class="keywordflow">if</font>( nGCSCode == GCS_WGS_84 )
00395         {
00396             nDatum = Datum_WGS84;
00397             pszName = <font class="stringliteral">"WGS 84"</font>;
00398         }
00399         <font class="keywordflow">else</font> <font class="keywordflow">if</font>( nGCSCode == GCS_WGS_72 )
00400         {
00401             nDatum = Datum_WGS72;
00402             pszName = <font class="stringliteral">"WGS 82"</font>;
00403         }
00404         <font class="keywordflow">else</font>
00405             <font class="keywordflow">return</font> FALSE;
00406 
00407         <font class="keywordflow">if</font>( ppszName != NULL )
00408             *ppszName = CPLStrdup( pszName );
00409         <font class="keywordflow">if</font>( pnDatum != NULL )
00410             *pnDatum = nDatum;
00411         <font class="keywordflow">if</font>( pnPM != NULL )
00412             *pnPM = nPM;
00413         <font class="keywordflow">if</font>( pnUOMAngle != NULL )
00414             *pnUOMAngle = nUOMAngle;
00415 
00416         <font class="keywordflow">return</font> TRUE;
00417     }
00418 
00419 <font class="comment">/* -------------------------------------------------------------------- */</font>
00420 <font class="comment">/*      Get the PM.                                                     */</font>
00421 <font class="comment">/* -------------------------------------------------------------------- */</font>
00422     <font class="keywordflow">if</font>( pnDatum != NULL )
00423         *pnDatum = nDatum;
00424     
00425     nPM = atoi(CSVGetField( CSVFilename(<font class="stringliteral">"horiz_cs.csv"</font> ),
00426                             <font class="stringliteral">"HORIZCS_CODE"</font>, szSearchKey, CC_Integer,
00427                             <font class="stringliteral">"PRIME_MERIDIAN_CODE"</font> ) );
00428 
00429     <font class="keywordflow">if</font>( nPM &lt; 1 )
00430         <font class="keywordflow">return</font> FALSE;
00431 
00432     <font class="keywordflow">if</font>( pnPM != NULL )
00433         *pnPM = nPM;
00434 
00435 <font class="comment">/* -------------------------------------------------------------------- */</font>
00436 <font class="comment">/*      Get the angular units.                                          */</font>
00437 <font class="comment">/* -------------------------------------------------------------------- */</font>
00438     nUOMAngle = atoi(CSVGetField( CSVFilename(<font class="stringliteral">"horiz_cs.csv"</font> ),
00439                                   <font class="stringliteral">"HORIZCS_CODE"</font>, szSearchKey, CC_Integer,
00440                                   <font class="stringliteral">"UOM_ANGLE_CODE"</font> ) );
00441 
00442     <font class="keywordflow">if</font>( nUOMAngle &lt; 1 )
00443         <font class="keywordflow">return</font> FALSE;
00444 
00445     <font class="keywordflow">if</font>( pnUOMAngle != NULL )
00446         *pnUOMAngle = nUOMAngle;
00447 
00448 <font class="comment">/* -------------------------------------------------------------------- */</font>
00449 <font class="comment">/*      Get the name, if requested.                                     */</font>
00450 <font class="comment">/* -------------------------------------------------------------------- */</font>
00451     <font class="keywordflow">if</font>( ppszName != NULL )
00452         *ppszName =
00453             CPLStrdup(CSVGetField( CSVFilename(<font class="stringliteral">"horiz_cs.csv"</font> ),
00454                                    <font class="stringliteral">"HORIZCS_CODE"</font>, szSearchKey, CC_Integer,
00455                                    <font class="stringliteral">"HORIZCS_EPSG_NAME"</font> ));
00456     
00457     <font class="keywordflow">return</font>( TRUE );
00458 }
00459 
00460 <font class="comment">/************************************************************************/</font>
00461 <font class="comment">/*                        GTIFGetEllipsoidInfo()                        */</font>
00462 <font class="comment">/*                                                                      */</font>
00463 <font class="comment">/*      Fetch info about an ellipsoid.  Axes are always returned in     */</font>
00464 <font class="comment">/*      meters.  SemiMajor computed based on inverse flattening         */</font>
00465 <font class="comment">/*      where that is provided.                                         */</font>
00466 <font class="comment">/************************************************************************/</font>
00467 
00468 <font class="keywordtype">int</font> GTIFGetEllipsoidInfo( <font class="keywordtype">int</font> nEllipseCode, <font class="keywordtype">char</font> ** ppszName,
00469                           <font class="keywordtype">double</font> * pdfSemiMajor, <font class="keywordtype">double</font> * pdfSemiMinor )<font class="keyword"></font>
00470 <font class="keyword"></font>
00471 <font class="keyword"></font>{
00472     <font class="keywordtype">char</font>        szSearchKey[24];
00473     <font class="keywordtype">double</font>      dfSemiMajor, dfToMeters = 1.0;
00474     <font class="keywordtype">int</font>         nUOMLength;
00475     
00476 <font class="comment">/* -------------------------------------------------------------------- */</font>
00477 <font class="comment">/*      Get the semi major axis.                                        */</font>
00478 <font class="comment">/* -------------------------------------------------------------------- */</font>
00479     sprintf( szSearchKey, <font class="stringliteral">"%d"</font>, nEllipseCode );
00480 
00481     dfSemiMajor =
00482         atof(CSVGetField( CSVFilename(<font class="stringliteral">"ellipsoid.csv"</font> ),
00483                           <font class="stringliteral">"ELLIPSOID_CODE"</font>, szSearchKey, CC_Integer,
00484                           <font class="stringliteral">"SEMI_MAJOR_AXIS"</font> ) );
00485 
00486 <font class="comment">/* -------------------------------------------------------------------- */</font>
00487 <font class="comment">/*      Try some well known ellipsoids.                                 */</font>
00488 <font class="comment">/* -------------------------------------------------------------------- */</font>
00489     <font class="keywordflow">if</font>( dfSemiMajor == 0.0 )
00490     {
00491         <font class="keywordtype">double</font>     dfInvFlattening, dfSemiMinor;
00492         <font class="keyword">const</font> <font class="keywordtype">char</font> *pszName = NULL;
00493         
00494         <font class="keywordflow">if</font>( nEllipseCode == Ellipse_Clarke_1866 )
00495         {
00496             pszName = <font class="stringliteral">"Clarke 1866"</font>;
00497             dfSemiMajor = 6378206.4;
00498             dfSemiMinor = 6356583.8;
00499             dfInvFlattening = 0.0;
00500         }
00501         <font class="keywordflow">else</font> <font class="keywordflow">if</font>( nEllipseCode == Ellipse_GRS_1980 )
00502         {
00503             pszName = <font class="stringliteral">"GRS 1980"</font>;
00504             dfSemiMajor = 6378137.0;
00505             dfSemiMinor = 0.0;
00506             dfInvFlattening = 298.257222101;
00507         }
00508         <font class="keywordflow">else</font> <font class="keywordflow">if</font>( nEllipseCode == Ellipse_WGS_84 )
00509         {
00510             pszName = <font class="stringliteral">"WGS 84"</font>;
00511             dfSemiMajor = 6378137.0;
00512             dfSemiMinor = 0.0;
00513             dfInvFlattening = 298.257223563;
00514         }
00515         <font class="keywordflow">else</font> <font class="keywordflow">if</font>( nEllipseCode == 7043 )
00516         {
00517             pszName = <font class="stringliteral">"WGS 72"</font>;
00518             dfSemiMajor = 6378135.0;
00519             dfSemiMinor = 0.0;
00520             dfInvFlattening = 298.26;
00521         }
00522         <font class="keywordflow">else</font>
00523             <font class="keywordflow">return</font> FALSE;
00524 
00525         <font class="keywordflow">if</font>( dfSemiMinor == 0.0 )
00526             dfSemiMinor = dfSemiMajor * (1 - 1.0/dfInvFlattening);
00527 
00528         <font class="keywordflow">if</font>( pdfSemiMinor != NULL )
00529             *pdfSemiMinor = dfSemiMinor;
00530         <font class="keywordflow">if</font>( pdfSemiMajor != NULL )
00531             *pdfSemiMajor = dfSemiMajor;
00532         <font class="keywordflow">if</font>( ppszName != NULL )
00533             *ppszName = CPLStrdup( pszName );
00534 
00535         <font class="keywordflow">return</font> TRUE;
00536     }
00537 
00538 <font class="comment">/* -------------------------------------------------------------------- */</font>
00539 <font class="comment">/*      Get the translation factor into meters.                         */</font>
00540 <font class="comment">/* -------------------------------------------------------------------- */</font>
00541     nUOMLength = atoi(CSVGetField( CSVFilename(<font class="stringliteral">"ellipsoid.csv"</font> ),
00542                                    <font class="stringliteral">"ELLIPSOID_CODE"</font>, szSearchKey, CC_Integer,
00543                                    <font class="stringliteral">"UOM_LENGTH_CODE"</font> ));
00544     GTIFGetUOMLengthInfo( nUOMLength, NULL, &amp;dfToMeters );
00545 
00546     dfSemiMajor *= dfToMeters;
00547     
00548     <font class="keywordflow">if</font>( pdfSemiMajor != NULL )
00549         *pdfSemiMajor = dfSemiMajor;
00550     
00551 <font class="comment">/* -------------------------------------------------------------------- */</font>
00552 <font class="comment">/*      Get the semi-minor if requested.  If the Semi-minor axis        */</font>
00553 <font class="comment">/*      isn't available, compute it based on the inverse flattening.    */</font>
00554 <font class="comment">/* -------------------------------------------------------------------- */</font>
00555     <font class="keywordflow">if</font>( pdfSemiMinor != NULL )
00556     {
00557         *pdfSemiMinor =
00558             atof(CSVGetField( CSVFilename(<font class="stringliteral">"ellipsoid.csv"</font> ),
00559                               <font class="stringliteral">"ELLIPSOID_CODE"</font>, szSearchKey, CC_Integer,
00560                               <font class="stringliteral">"SEMI_MINOR_AXIS"</font> )) * dfToMeters;
00561 
00562         <font class="keywordflow">if</font>( *pdfSemiMinor == 0.0 )
00563         {
00564             <font class="keywordtype">double</font>      dfInvFlattening;
00565             
00566             dfInvFlattening = 
00567                 atof(CSVGetField( CSVFilename(<font class="stringliteral">"ellipsoid.csv"</font> ),
00568                                   <font class="stringliteral">"ELLIPSOID_CODE"</font>, szSearchKey, CC_Integer,
00569                                   <font class="stringliteral">"INV_FLATTENING"</font> ));
00570             *pdfSemiMinor = dfSemiMajor * (1 - 1.0/dfInvFlattening);
00571         }
00572     }
00573 
00574 <font class="comment">/* -------------------------------------------------------------------- */</font>
00575 <font class="comment">/*      Get the name, if requested.                                     */</font>
00576 <font class="comment">/* -------------------------------------------------------------------- */</font>
00577     <font class="keywordflow">if</font>( ppszName != NULL )
00578         *ppszName =
00579             CPLStrdup(CSVGetField( CSVFilename(<font class="stringliteral">"ellipsoid.csv"</font> ),
00580                                    <font class="stringliteral">"ELLIPSOID_CODE"</font>, szSearchKey, CC_Integer,
00581                                    <font class="stringliteral">"ELLIPSOID_EPSG_NAME"</font> ));
00582     
00583     <font class="keywordflow">return</font>( TRUE );
00584 }
00585 
00586 <font class="comment">/************************************************************************/</font>
00587 <font class="comment">/*                           GTIFGetPMInfo()                            */</font>
00588 <font class="comment">/*                                                                      */</font>
00589 <font class="comment">/*      Get the offset between a given prime meridian and Greenwich     */</font>
00590 <font class="comment">/*      in degrees.                                                     */</font>
00591 <font class="comment">/************************************************************************/</font>
00592 
00593 <font class="keywordtype">int</font> GTIFGetPMInfo( <font class="keywordtype">int</font> nPMCode, <font class="keywordtype">char</font> ** ppszName, <font class="keywordtype">double</font> *pdfOffset )<font class="keyword"></font>
00594 <font class="keyword"></font>
00595 <font class="keyword"></font>{
00596     <font class="keywordtype">char</font>        szSearchKey[24];
00597     <font class="keywordtype">int</font>         nUOMAngle;
00598 
00599 <font class="comment">/* -------------------------------------------------------------------- */</font>
00600 <font class="comment">/*      Use a special short cut for Greenwich, since it is so common.   */</font>
00601 <font class="comment">/* -------------------------------------------------------------------- */</font>
00602     <font class="keywordflow">if</font>( nPMCode == PM_Greenwich )
00603     {
00604         <font class="keywordflow">if</font>( pdfOffset != NULL )
00605             *pdfOffset = 0.0;
00606         <font class="keywordflow">if</font>( ppszName != NULL )
00607             *ppszName = CPLStrdup( <font class="stringliteral">"Greenwich"</font> );
00608         <font class="keywordflow">return</font> TRUE;
00609     }
00610 
00611 <font class="comment">/* -------------------------------------------------------------------- */</font>
00612 <font class="comment">/*      Search the database for the corresponding datum code.           */</font>
00613 <font class="comment">/* -------------------------------------------------------------------- */</font>
00614     sprintf( szSearchKey, <font class="stringliteral">"%d"</font>, nPMCode );
00615 
00616     nUOMAngle =
00617         atoi(CSVGetField( CSVFilename(<font class="stringliteral">"p_meridian.csv"</font> ),
00618                           <font class="stringliteral">"PRIME_MERIDIAN_CODE"</font>, szSearchKey, CC_Integer,
00619                           <font class="stringliteral">"UOM_ANGLE_CODE"</font> ) );
00620     <font class="keywordflow">if</font>( nUOMAngle &lt; 1 )
00621         <font class="keywordflow">return</font> FALSE;
00622 
00623 <font class="comment">/* -------------------------------------------------------------------- */</font>
00624 <font class="comment">/*      Get the PM offset.                                              */</font>
00625 <font class="comment">/* -------------------------------------------------------------------- */</font>
00626     <font class="keywordflow">if</font>( pdfOffset != NULL )
00627     {
00628         *pdfOffset =
00629             GTIFAngleStringToDD(
00630                 CSVGetField( CSVFilename(<font class="stringliteral">"p_meridian.csv"</font> ),
00631                              <font class="stringliteral">"PRIME_MERIDIAN_CODE"</font>, szSearchKey, CC_Integer,
00632                              <font class="stringliteral">"GREENWICH_LONGITUDE"</font> ),
00633                 nUOMAngle );
00634     }
00635     
00636 <font class="comment">/* -------------------------------------------------------------------- */</font>
00637 <font class="comment">/*      Get the name, if requested.                                     */</font>
00638 <font class="comment">/* -------------------------------------------------------------------- */</font>
00639     <font class="keywordflow">if</font>( ppszName != NULL )
00640         *ppszName =
00641             CPLStrdup(
00642                 CSVGetField( CSVFilename(<font class="stringliteral">"p_meridian.csv"</font> ),
00643                              <font class="stringliteral">"PRIME_MERIDIAN_CODE"</font>, szSearchKey, CC_Integer,
00644                              <font class="stringliteral">"PRIME_MERID_EPSG_NAME"</font> ));
00645     
00646     <font class="keywordflow">return</font>( TRUE );
00647 }
00648 
00649 <font class="comment">/************************************************************************/</font>
00650 <font class="comment">/*                          GTIFGetDatumInfo()                          */</font>
00651 <font class="comment">/*                                                                      */</font>
00652 <font class="comment">/*      Fetch the ellipsoid, and name for a datum.                      */</font>
00653 <font class="comment">/************************************************************************/</font>
00654 
00655 <font class="keywordtype">int</font> GTIFGetDatumInfo( <font class="keywordtype">int</font> nDatumCode, <font class="keywordtype">char</font> ** ppszName, <font class="keywordtype">short</font> * pnEllipsoid )<font class="keyword"></font>
00656 <font class="keyword"></font>
00657 <font class="keyword"></font>{
00658     <font class="keywordtype">char</font>        szSearchKey[24];
00659     <font class="keywordtype">int</font>         nEllipsoid;
00660 
00661 <font class="comment">/* -------------------------------------------------------------------- */</font>
00662 <font class="comment">/*      Search the database for the corresponding datum code.           */</font>
00663 <font class="comment">/* -------------------------------------------------------------------- */</font>
00664     sprintf( szSearchKey, <font class="stringliteral">"%d"</font>, nDatumCode );
00665 
00666     nEllipsoid = atoi(CSVGetField( CSVFilename(<font class="stringliteral">"geod_datum.csv"</font> ),
00667                                    <font class="stringliteral">"GEOD_DATUM_CODE"</font>, szSearchKey, CC_Integer,
00668                                    <font class="stringliteral">"ELLIPSOID_CODE"</font> ) );
00669 
00670     <font class="keywordflow">if</font>( pnEllipsoid != NULL )
00671         *pnEllipsoid = nEllipsoid;
00672     
00673 <font class="comment">/* -------------------------------------------------------------------- */</font>
00674 <font class="comment">/*      Handle a few built-in datums.                                   */</font>
00675 <font class="comment">/* -------------------------------------------------------------------- */</font>
00676     <font class="keywordflow">if</font>( nEllipsoid &lt; 1 )
00677     {
00678         <font class="keyword">const</font> <font class="keywordtype">char</font> *pszName = NULL;
00679         
00680         <font class="keywordflow">if</font>( nDatumCode == Datum_North_American_Datum_1927 )
00681         {
00682             nEllipsoid = Ellipse_Clarke_1866;
00683             pszName = <font class="stringliteral">"North American Datum 1927"</font>;
00684         }
00685         <font class="keywordflow">else</font> <font class="keywordflow">if</font>( nDatumCode == Datum_North_American_Datum_1983 )
00686         {
00687             nEllipsoid = Ellipse_GRS_1980;
00688             pszName = <font class="stringliteral">"North American Datum 1983"</font>;
00689         }
00690         <font class="keywordflow">else</font> <font class="keywordflow">if</font>( nDatumCode == Datum_WGS84 )
00691         {
00692             nEllipsoid = Ellipse_WGS_84;
00693             pszName = <font class="stringliteral">"World Geodetic System 1984"</font>;
00694         }
00695         <font class="keywordflow">else</font> <font class="keywordflow">if</font>( nDatumCode == Datum_WGS72 )
00696         {
00697             nEllipsoid = 7043; <font class="comment">/* WGS7 */</font>
00698             pszName = <font class="stringliteral">"World Geodetic System 1972"</font>;
00699         }
00700         <font class="keywordflow">else</font>
00701             <font class="keywordflow">return</font> FALSE;
00702 
00703         <font class="keywordflow">if</font>( pnEllipsoid != NULL )
00704             *pnEllipsoid = nEllipsoid;
00705 
00706         <font class="keywordflow">if</font>( ppszName != NULL )
00707             *ppszName = CPLStrdup( pszName );
00708 
00709         <font class="keywordflow">return</font> TRUE;
00710     }
00711 
00712 <font class="comment">/* -------------------------------------------------------------------- */</font>
00713 <font class="comment">/*      Get the name, if requested.                                     */</font>
00714 <font class="comment">/* -------------------------------------------------------------------- */</font>
00715     <font class="keywordflow">if</font>( ppszName != NULL )
00716         *ppszName =
00717             CPLStrdup(CSVGetField( CSVFilename(<font class="stringliteral">"geod_datum.csv"</font> ),
00718                                    <font class="stringliteral">"GEOD_DATUM_CODE"</font>, szSearchKey, CC_Integer,
00719                                    <font class="stringliteral">"GEOD_DAT_EPSG_NAME"</font> ));
00720     
00721     <font class="keywordflow">return</font>( TRUE );
00722 }
00723 
00724 
00725 <font class="comment">/************************************************************************/</font>
00726 <font class="comment">/*                        GTIFGetUOMLengthInfo()                        */</font>
00727 <font class="comment">/*                                                                      */</font>
00728 <font class="comment">/*      Note: This function should eventually also know how to          */</font>
00729 <font class="comment">/*      lookup length aliases in the UOM_LE_ALIAS table.                */</font>
00730 <font class="comment">/************************************************************************/</font>
00731 
00732 <font class="keywordtype">int</font> GTIFGetUOMLengthInfo( <font class="keywordtype">int</font> nUOMLengthCode,
00733                           <font class="keywordtype">char</font> **ppszUOMName,
00734                           <font class="keywordtype">double</font> * pdfInMeters )<font class="keyword"></font>
00735 <font class="keyword"></font>
00736 <font class="keyword"></font>{
00737     <font class="keywordtype">char</font>        **papszUnitsRecord;
00738     <font class="keywordtype">char</font>        szSearchKey[24];
00739     <font class="keywordtype">int</font>         iNameField;
00740 
00741 <font class="comment">/* -------------------------------------------------------------------- */</font>
00742 <font class="comment">/*      We short cut meter to save work in the most common case.        */</font>
00743 <font class="comment">/* -------------------------------------------------------------------- */</font>
00744     <font class="keywordflow">if</font>( nUOMLengthCode == 9001 )
00745     {
00746         <font class="keywordflow">if</font>( ppszUOMName != NULL )
00747             *ppszUOMName = CPLStrdup( <font class="stringliteral">"metre"</font> );
00748         <font class="keywordflow">if</font>( pdfInMeters != NULL )
00749             *pdfInMeters = 1.0;
00750 
00751         <font class="keywordflow">return</font> TRUE;
00752     }
00753 
00754 <font class="comment">/* -------------------------------------------------------------------- */</font>
00755 <font class="comment">/*      Search the units database for this unit.  If we don't find      */</font>
00756 <font class="comment">/*      it return failure.                                              */</font>
00757 <font class="comment">/* -------------------------------------------------------------------- */</font>
00758     sprintf( szSearchKey, <font class="stringliteral">"%d"</font>, nUOMLengthCode );
00759     papszUnitsRecord =
00760         CSVScanFileByName( CSVFilename( <font class="stringliteral">"uom_length.csv"</font> ),
00761                            <font class="stringliteral">"UOM_LENGTH_CODE"</font>, szSearchKey, CC_Integer );
00762 
00763     <font class="keywordflow">if</font>( papszUnitsRecord == NULL )
00764         <font class="keywordflow">return</font> FALSE;
00765 
00766 <font class="comment">/* -------------------------------------------------------------------- */</font>
00767 <font class="comment">/*      Get the name, if requested.                                     */</font>
00768 <font class="comment">/* -------------------------------------------------------------------- */</font>
00769     <font class="keywordflow">if</font>( ppszUOMName != NULL )
00770     {
00771         iNameField = CSVGetFileFieldId( CSVFilename( <font class="stringliteral">"uom_length.csv"</font> ),
00772                                         <font class="stringliteral">"UNIT_OF_MEAS_EPSG_NAME"</font> );
00773         *ppszUOMName = CPLStrdup( CSLGetField(papszUnitsRecord, iNameField) );
00774     }
00775     
00776 <font class="comment">/* -------------------------------------------------------------------- */</font>
00777 <font class="comment">/*      Get the A and B factor fields, and create the multiplicative    */</font>
00778 <font class="comment">/*      factor.                                                         */</font>
00779 <font class="comment">/* -------------------------------------------------------------------- */</font>
00780     <font class="keywordflow">if</font>( pdfInMeters != NULL )
00781     {
00782         <font class="keywordtype">int</font>     iBFactorField, iCFactorField;
00783         
00784         iBFactorField = CSVGetFileFieldId( CSVFilename( <font class="stringliteral">"uom_length.csv"</font> ),
00785                                            <font class="stringliteral">"FACTOR_B"</font> );
00786         iCFactorField = CSVGetFileFieldId( CSVFilename( <font class="stringliteral">"uom_length.csv"</font> ),
00787                                            <font class="stringliteral">"FACTOR_C"</font> );
00788 
00789         <font class="keywordflow">if</font>( atof(CSLGetField(papszUnitsRecord, iCFactorField)) &gt; 0.0 )
00790             *pdfInMeters = atof(CSLGetField(papszUnitsRecord, iBFactorField))
00791                 / atof(CSLGetField(papszUnitsRecord, iCFactorField));
00792         <font class="keywordflow">else</font>
00793             *pdfInMeters = 0.0;
00794     }
00795     
00796     <font class="keywordflow">return</font>( TRUE );
00797 }
00798 
00799 <font class="comment">/************************************************************************/</font>
00800 <font class="comment">/*                        GTIFGetUOMAngleInfo()                         */</font>
00801 <font class="comment">/************************************************************************/</font>
00802 
00803 <font class="keywordtype">int</font> GTIFGetUOMAngleInfo( <font class="keywordtype">int</font> nUOMLengthCode,
00804                          <font class="keywordtype">char</font> **ppszUOMName,
00805                          <font class="keywordtype">double</font> * pdfInDegrees )<font class="keyword"></font>
00806 <font class="keyword"></font>
00807 <font class="keyword"></font>{
00808     <font class="keyword">const</font> <font class="keywordtype">char</font>  *pszUOMName = NULL;
00809     <font class="keywordtype">double</font>      dfInDegrees = 0.0;
00810 
00811     <font class="keywordflow">switch</font>( nUOMLengthCode )
00812     {
00813       <font class="keywordflow">case</font> 9101:
00814         pszUOMName = <font class="stringliteral">"radian"</font>;
00815         dfInDegrees = 180.0 / 3.14159265358979;
00816         <font class="keywordflow">break</font>;
00817         
00818       <font class="keywordflow">case</font> 9102:
00819       <font class="keywordflow">case</font> 9107:
00820       <font class="keywordflow">case</font> 9108:
00821       <font class="keywordflow">case</font> 9110:
00822         pszUOMName = <font class="stringliteral">"degree"</font>;
00823         dfInDegrees = 1.0;
00824         <font class="keywordflow">break</font>;
00825 
00826       <font class="keywordflow">case</font> 9103:
00827         pszUOMName = <font class="stringliteral">"arc-minute"</font>;
00828         dfInDegrees = 1 / 60.0;
00829         <font class="keywordflow">break</font>;
00830 
00831       <font class="keywordflow">case</font> 9104:
00832         pszUOMName = <font class="stringliteral">"arc-second"</font>;
00833         dfInDegrees = 1 / 3600.0;
00834         <font class="keywordflow">break</font>;
00835         
00836       <font class="keywordflow">case</font> 9105:
00837         pszUOMName = <font class="stringliteral">"grad"</font>;
00838         dfInDegrees = 180.0 / 200.0;
00839         <font class="keywordflow">break</font>;
00840 
00841       <font class="keywordflow">case</font> 9106:
00842         pszUOMName = <font class="stringliteral">"gon"</font>;
00843         dfInDegrees = 180.0 / 200.0;
00844         <font class="keywordflow">break</font>;
00845         
00846       <font class="keywordflow">case</font> 9109:
00847         pszUOMName = <font class="stringliteral">"microradian"</font>;
00848         dfInDegrees = 180.0 / (3.14159265358979 * 1000000.0);
00849         <font class="keywordflow">break</font>;
00850     }
00851 
00852     <font class="keywordflow">if</font>( ppszUOMName != NULL )
00853     {
00854         <font class="keywordflow">if</font>( pszUOMName != NULL )
00855             *ppszUOMName = CPLStrdup( pszUOMName );
00856         <font class="keywordflow">else</font>
00857             *ppszUOMName = NULL;
00858     }
00859 
00860     <font class="keywordflow">if</font>( pdfInDegrees != NULL )
00861         *pdfInDegrees = dfInDegrees;
00862 
00863     <font class="keywordflow">return</font>( TRUE );
00864 }
00865 
00866 <font class="comment">/************************************************************************/</font>
00867 <font class="comment">/*                    EPSGProjMethodToCTProjMethod()                    */</font>
00868 <font class="comment">/*                                                                      */</font>
00869 <font class="comment">/*      Convert between the EPSG enumeration for projection methods,    */</font>
00870 <font class="comment">/*      and the GeoTIFF CT codes.                                       */</font>
00871 <font class="comment">/************************************************************************/</font>
00872 
00873 <font class="keyword">static</font> <font class="keywordtype">int</font> EPSGProjMethodToCTProjMethod( <font class="keywordtype">int</font> nEPSG )<font class="keyword"></font>
00874 <font class="keyword"></font>
00875 <font class="keyword"></font>{
00876     <font class="comment">/* see trf_method.csv for list of EPSG codes */</font>
00877     
00878     <font class="keywordflow">switch</font>( nEPSG )
00879     {
00880       <font class="keywordflow">case</font> 9801:
00881         <font class="keywordflow">return</font>( CT_LambertConfConic_1SP );
00882 
00883       <font class="keywordflow">case</font> 9802:
00884         <font class="keywordflow">return</font>( CT_LambertConfConic_2SP );
00885 
00886       <font class="keywordflow">case</font> 9803:
00887         <font class="keywordflow">return</font>( CT_LambertConfConic_2SP ); <font class="comment">/* Belgian variant not supported */</font>
00888 
00889       <font class="keywordflow">case</font> 9804:
00890         <font class="keywordflow">return</font>( CT_Mercator );  <font class="comment">/* 1SP and 2SP not differentiated */</font>
00891 
00892       <font class="keywordflow">case</font> 9805:
00893         <font class="keywordflow">return</font>( CT_Mercator );  <font class="comment">/* 1SP and 2SP not differentiated */</font>
00894 
00895       <font class="keywordflow">case</font> 9806:
00896         <font class="keywordflow">return</font>( CT_CassiniSoldner );
00897 
00898       <font class="keywordflow">case</font> 9807:
00899         <font class="keywordflow">return</font>( CT_TransverseMercator );
00900 
00901       <font class="keywordflow">case</font> 9808:
00902         <font class="keywordflow">return</font>( CT_TransvMercator_SouthOriented );
00903 
00904       <font class="keywordflow">case</font> 9809:
00905         <font class="keywordflow">return</font>( CT_ObliqueStereographic );
00906 
00907       <font class="keywordflow">case</font> 9810:
00908         <font class="keywordflow">return</font>( CT_PolarStereographic );
00909 
00910       <font class="keywordflow">case</font> 9811:
00911         <font class="keywordflow">return</font>( CT_NewZealandMapGrid );
00912 
00913       <font class="keywordflow">case</font> 9812:
00914         <font class="keywordflow">return</font>( CT_ObliqueMercator ); <font class="comment">/* is hotine actually different? */</font>
00915 
00916       <font class="keywordflow">case</font> 9813:
00917         <font class="keywordflow">return</font>( CT_ObliqueMercator_Laborde );
00918 
00919       <font class="keywordflow">case</font> 9814:
00920         <font class="keywordflow">return</font>( CT_ObliqueMercator_Rosenmund ); <font class="comment">/* swiss  */</font>
00921 
00922       <font class="keywordflow">case</font> 9815:
00923         <font class="keywordflow">return</font>( CT_ObliqueMercator );
00924 
00925       <font class="keywordflow">case</font> 9816: <font class="comment">/* tunesia mining grid has no counterpart */</font>
00926         <font class="keywordflow">return</font>( KvUserDefined );
00927     }
00928 
00929     <font class="keywordflow">return</font>( KvUserDefined );
00930 }
00931 
00932 <font class="comment">/************************************************************************/</font>
00933 <font class="comment">/*                         GTIFGetProjTRFInfo()                         */</font>
00934 <font class="comment">/*                                                                      */</font>
00935 <font class="comment">/*      Transform a PROJECTION_TRF_CODE into a projection method,       */</font>
00936 <font class="comment">/*      and a set of parameters.  The parameters identify will          */</font>
00937 <font class="comment">/*      depend on the returned method, but they will all have been      */</font>
00938 <font class="comment">/*      normalized into degrees and meters.                             */</font>
00939 <font class="comment">/************************************************************************/</font>
00940 
00941 <font class="keywordtype">int</font> GTIFGetProjTRFInfo( <font class="keywordtype">int</font> nProjTRFCode,
00942                         <font class="keywordtype">char</font> **ppszProjTRFName,
00943                         <font class="keywordtype">short</font> * pnProjMethod,
00944                         <font class="keywordtype">double</font> * padfProjParms )<font class="keyword"></font>
00945 <font class="keyword"></font>
00946 <font class="keyword"></font>{
00947     <font class="keywordtype">int</font>         nProjMethod, nUOMLinear, nUOMAngle, i;
00948     <font class="keywordtype">double</font>      adfProjParms[7], dfInMeters;
00949     <font class="keywordtype">char</font>        szTRFCode[16];
00950 
00951 <font class="comment">/* -------------------------------------------------------------------- */</font>
00952 <font class="comment">/*      Get the proj method.  If this fails to return a meaningful      */</font>
00953 <font class="comment">/*      number, then the whole function fails.                          */</font>
00954 <font class="comment">/* -------------------------------------------------------------------- */</font>
00955     sprintf( szTRFCode, <font class="stringliteral">"%d"</font>, nProjTRFCode );
00956     nProjMethod =
00957         atoi( CSVGetField( CSVFilename( <font class="stringliteral">"trf_nonpolynomial.csv"</font> ),
00958                            <font class="stringliteral">"COORD_TRF_CODE"</font>, szTRFCode, CC_Integer,
00959                            <font class="stringliteral">"COORD_TRF_METHOD_CODE"</font> ) );
00960     <font class="keywordflow">if</font>( nProjMethod == 0 )
00961         <font class="keywordflow">return</font> FALSE;
00962 
00963 <font class="comment">/* -------------------------------------------------------------------- */</font>
00964 <font class="comment">/*      Get the linear, and angular (geog) units for the projection     */</font>
00965 <font class="comment">/*      parameters.                                                     */</font>    
00966 <font class="comment">/* -------------------------------------------------------------------- */</font>
00967     nUOMLinear = 
00968         atoi( CSVGetField( CSVFilename( <font class="stringliteral">"trf_nonpolynomial.csv"</font> ),
00969                            <font class="stringliteral">"COORD_TRF_CODE"</font>, szTRFCode, CC_Integer,
00970                            <font class="stringliteral">"UOM_LENGTH_CODE"</font> ) );
00971 
00972     <font class="keywordflow">if</font>( !GTIFGetUOMLengthInfo( nUOMLinear, NULL, &amp;dfInMeters ) )
00973         dfInMeters = 1.0;
00974     
00975     nUOMAngle = 
00976         atoi( CSVGetField( CSVFilename( <font class="stringliteral">"trf_nonpolynomial.csv"</font> ),
00977                            <font class="stringliteral">"COORD_TRF_CODE"</font>, szTRFCode, CC_Integer,
00978                            <font class="stringliteral">"UOM_ANGLE_CODE"</font> ) );
00979     
00980 <font class="comment">/* -------------------------------------------------------------------- */</font>
00981 <font class="comment">/*      Get the parameters for this projection.  For the time being     */</font>
00982 <font class="comment">/*      I am assuming the first four parameters are angles, the         */</font>
00983 <font class="comment">/*      fifth is unitless (normally scale), and the remainder are       */</font>
00984 <font class="comment">/*      linear measures.  This works fine for the existing              */</font>
00985 <font class="comment">/*      projections, but is a pretty fragile approach.                  */</font>
00986 <font class="comment">/* -------------------------------------------------------------------- */</font>
00987 
00988     <font class="keywordflow">for</font>( i = 0; i &lt; 7; i++ )
00989     {
00990         <font class="keywordtype">char</font>    szID[16];
00991         <font class="keyword">const</font> <font class="keywordtype">char</font> *pszValue;
00992         
00993         sprintf( szID, <font class="stringliteral">"PARAMETER_%d"</font>, i+1 );
00994 
00995         pszValue = CSVGetField( CSVFilename( <font class="stringliteral">"trf_nonpolynomial.csv"</font> ),
00996                                 <font class="stringliteral">"COORD_TRF_CODE"</font>, szTRFCode,CC_Integer, szID );
00997         <font class="keywordflow">if</font>( i &lt; 4 )
00998             adfProjParms[i] = GTIFAngleStringToDD( pszValue, nUOMAngle );
00999         <font class="keywordflow">else</font> <font class="keywordflow">if</font>( i &gt; 4 )
01000             adfProjParms[i] = atof(pszValue) * dfInMeters;
01001         <font class="keywordflow">else</font>
01002             adfProjParms[i] = atof( pszValue );
01003     }
01004 
01005 <font class="comment">/* -------------------------------------------------------------------- */</font>
01006 <font class="comment">/*      Get the name, if requested.                                     */</font>
01007 <font class="comment">/* -------------------------------------------------------------------- */</font>
01008     <font class="keywordflow">if</font>( ppszProjTRFName != NULL )
01009     {
01010         *ppszProjTRFName =
01011             CPLStrdup(CSVGetField( CSVFilename(<font class="stringliteral">"trf_nonpolynomial.csv"</font> ),
01012                                    <font class="stringliteral">"COORD_TRF_CODE"</font>, szTRFCode, CC_Integer,
01013                                    <font class="stringliteral">"COORD_TRF_EPSG_NAME"</font> ));
01014     }
01015     
01016 <font class="comment">/* -------------------------------------------------------------------- */</font>
01017 <font class="comment">/*      Transfer requested data into passed variables.                  */</font>
01018 <font class="comment">/* -------------------------------------------------------------------- */</font>
01019     <font class="keywordflow">if</font>( pnProjMethod != NULL )
01020         *pnProjMethod = nProjMethod;
01021 
01022     <font class="keywordflow">if</font>( padfProjParms != NULL )
01023     {
01024         <font class="keywordflow">for</font>( i = 0; i &lt; 7; i++ )
01025             padfProjParms[i] = adfProjParms[i];
01026     }
01027 
01028     <font class="keywordflow">return</font> TRUE;
01029 }
01030 
01031 <font class="comment">/************************************************************************/</font>
01032 <font class="comment">/*                            SetGTParmIds()                            */</font>
01033 <font class="comment">/*                                                                      */</font>
01034 <font class="comment">/*      This is hardcoded logic to set the GeoTIFF parmaeter            */</font>
01035 <font class="comment">/*      identifiers for all the EPSG supported projections.  As the     */</font>
01036 <font class="comment">/*      trf_method.csv table grows with new projections, this code      */</font>
01037 <font class="comment">/*      will need to be updated.                                        */</font>
01038 <font class="comment">/************************************************************************/</font>
01039 
01040 <font class="keyword">static</font> <font class="keywordtype">int</font> SetGTParmIds( <a class="code" href="struct_GTIFDefn.html">GTIFDefn</a> * psDefn )<font class="keyword"></font>
01041 <font class="keyword"></font>
01042 <font class="keyword"></font>{
01043     psDefn-&gt;nParms = 7;
01044     
01045     <font class="keywordflow">switch</font>( psDefn-&gt;CTProjection )
01046     {
01047       <font class="keywordflow">case</font> CT_CassiniSoldner:
01048       <font class="keywordflow">case</font> CT_NewZealandMapGrid:
01049         psDefn-&gt;ProjParmId[0] = ProjNatOriginLatGeoKey;
01050         psDefn-&gt;ProjParmId[1] = ProjNatOriginLongGeoKey;
01051         psDefn-&gt;ProjParmId[5] = ProjFalseEastingGeoKey;
01052         psDefn-&gt;ProjParmId[6] = ProjFalseNorthingGeoKey;
01053         <font class="keywordflow">return</font> TRUE;
01054 
01055       <font class="keywordflow">case</font> CT_ObliqueMercator:
01056         psDefn-&gt;ProjParmId[0] = ProjCenterLatGeoKey;
01057         psDefn-&gt;ProjParmId[1] = ProjCenterLongGeoKey;
01058         psDefn-&gt;ProjParmId[2] = ProjAzimuthAngleGeoKey;
01059         psDefn-&gt;ProjParmId[3] = ProjRectifiedGridAngleGeoKey;
01060         psDefn-&gt;ProjParmId[4] = ProjScaleAtCenterGeoKey;
01061         psDefn-&gt;ProjParmId[5] = ProjFalseEastingGeoKey;
01062         psDefn-&gt;ProjParmId[6] = ProjFalseNorthingGeoKey;
01063         <font class="keywordflow">return</font> TRUE;
01064 
01065       <font class="keywordflow">case</font> CT_ObliqueMercator_Laborde:
01066         psDefn-&gt;ProjParmId[0] = ProjCenterLatGeoKey;
01067         psDefn-&gt;ProjParmId[1] = ProjCenterLongGeoKey;
01068         psDefn-&gt;ProjParmId[2] = ProjAzimuthAngleGeoKey;
01069         psDefn-&gt;ProjParmId[4] = ProjScaleAtCenterGeoKey;
01070         psDefn-&gt;ProjParmId[5] = ProjFalseEastingGeoKey;
01071         psDefn-&gt;ProjParmId[6] = ProjFalseNorthingGeoKey;
01072         <font class="keywordflow">return</font> TRUE;
01073         
01074       <font class="keywordflow">case</font> CT_LambertConfConic_1SP:
01075       <font class="keywordflow">case</font> CT_Mercator:
01076       <font class="keywordflow">case</font> CT_ObliqueStereographic:
01077       <font class="keywordflow">case</font> CT_PolarStereographic:
01078       <font class="keywordflow">case</font> CT_TransverseMercator:
01079       <font class="keywordflow">case</font> CT_TransvMercator_SouthOriented:
01080         psDefn-&gt;ProjParmId[0] = ProjNatOriginLatGeoKey;
01081         psDefn-&gt;ProjParmId[1] = ProjNatOriginLongGeoKey;
01082         psDefn-&gt;ProjParmId[4] = ProjScaleAtNatOriginGeoKey;
01083         psDefn-&gt;ProjParmId[5] = ProjFalseEastingGeoKey;
01084         psDefn-&gt;ProjParmId[6] = ProjFalseNorthingGeoKey;
01085         <font class="keywordflow">return</font> TRUE;
01086 
01087       <font class="keywordflow">case</font> CT_LambertConfConic_2SP:
01088         psDefn-&gt;ProjParmId[0] = ProjFalseOriginLatGeoKey;
01089         psDefn-&gt;ProjParmId[1] = ProjFalseOriginLongGeoKey;
01090         psDefn-&gt;ProjParmId[2] = ProjStdParallel1GeoKey;
01091         psDefn-&gt;ProjParmId[3] = ProjStdParallel2GeoKey;
01092         psDefn-&gt;ProjParmId[5] = ProjFalseEastingGeoKey;
01093         psDefn-&gt;ProjParmId[6] = ProjFalseNorthingGeoKey;
01094         <font class="keywordflow">return</font> TRUE;
01095 
01096       <font class="keywordflow">case</font> CT_SwissObliqueCylindrical:
01097         psDefn-&gt;ProjParmId[0] = ProjCenterLatGeoKey;
01098         psDefn-&gt;ProjParmId[1] = ProjCenterLongGeoKey;
01099         psDefn-&gt;ProjParmId[5] = ProjFalseEastingGeoKey;
01100         psDefn-&gt;ProjParmId[6] = ProjFalseNorthingGeoKey;
01101         <font class="keywordflow">return</font> TRUE;
01102 
01103       <font class="keywordflow">default</font>:
01104         <font class="keywordflow">return</font>( FALSE );
01105     }
01106 }
01107 
01108 <font class="comment">/************************************************************************/</font>
01109 <font class="comment">/*                         GTIFFetchProjParms()                         */</font>
01110 <font class="comment">/*                                                                      */</font>
01111 <font class="comment">/*      Fetch the projection parameters for a particular projection     */</font>
01112 <font class="comment">/*      from a GeoTIFF file, and fill the GTIFDefn structure out        */</font>
01113 <font class="comment">/*      with them.                                                      */</font>
01114 <font class="comment">/************************************************************************/</font>
01115 
01116 <font class="keyword">static</font> <font class="keywordtype">void</font> GTIFFetchProjParms( GTIF * psGTIF, <a class="code" href="struct_GTIFDefn.html">GTIFDefn</a> * psDefn )<font class="keyword"></font>
01117 <font class="keyword"></font>
01118 <font class="keyword"></font>{
01119     <font class="keywordtype">double</font>      dfNatOriginLong, dfNatOriginLat, dfRectGridAngle;
01120     <font class="keywordtype">double</font>      dfFalseEasting, dfFalseNorthing, dfNatOriginScale;
01121     <font class="keywordtype">double</font>      dfStdParallel1, dfStdParallel2, dfAzimuth;
01122 
01123 <font class="comment">/* -------------------------------------------------------------------- */</font>
01124 <font class="comment">/*      Get the false easting, and northing if available.               */</font>
01125 <font class="comment">/* -------------------------------------------------------------------- */</font>
01126     <font class="keywordflow">if</font>( !<a class="code" href="geotiff_h.html#a23">GTIFKeyGet</a>(psGTIF, ProjFalseEastingGeoKey, &amp;dfFalseEasting, 0, 1)
01127         &amp;&amp; !<a class="code" href="geotiff_h.html#a23">GTIFKeyGet</a>(psGTIF, ProjCenterEastingGeoKey,
01128                        &amp;dfFalseEasting, 0, 1) )
01129         dfFalseEasting = 0.0;
01130         
01131     <font class="keywordflow">if</font>( !<a class="code" href="geotiff_h.html#a23">GTIFKeyGet</a>(psGTIF, ProjFalseNorthingGeoKey, &amp;dfFalseNorthing,0,1)
01132         &amp;&amp; !<a class="code" href="geotiff_h.html#a23">GTIFKeyGet</a>(psGTIF, ProjCenterNorthingGeoKey,
01133                        &amp;dfFalseNorthing, 0, 1) )
01134         dfFalseNorthing = 0.0;
01135         
01136     <font class="keywordflow">switch</font>( psDefn-&gt;CTProjection )
01137     {
01138 <font class="comment">/* -------------------------------------------------------------------- */</font>
01139       <font class="keywordflow">case</font> CT_Stereographic:
01140 <font class="comment">/* -------------------------------------------------------------------- */</font>
01141         <font class="keywordflow">if</font>( <a class="code" href="geotiff_h.html#a23">GTIFKeyGet</a>(psGTIF, ProjNatOriginLongGeoKey, 
01142                        &amp;dfNatOriginLong, 0, 1 ) == 0
01143             &amp;&amp; <a class="code" href="geotiff_h.html#a23">GTIFKeyGet</a>(psGTIF, ProjFalseOriginLongGeoKey, 
01144                           &amp;dfNatOriginLong, 0, 1 ) == 0
01145             &amp;&amp; <a class="code" href="geotiff_h.html#a23">GTIFKeyGet</a>(psGTIF, ProjCenterLongGeoKey, 
01146                           &amp;dfNatOriginLong, 0, 1 ) == 0 )
01147             dfNatOriginLong = 0.0;
01148 
01149         <font class="keywordflow">if</font>( <a class="code" href="geotiff_h.html#a23">GTIFKeyGet</a>(psGTIF, ProjNatOriginLatGeoKey, 
01150                        &amp;dfNatOriginLat, 0, 1 ) == 0
01151             &amp;&amp; <a class="code" href="geotiff_h.html#a23">GTIFKeyGet</a>(psGTIF, ProjFalseOriginLatGeoKey, 
01152                           &amp;dfNatOriginLat, 0, 1 ) == 0
01153             &amp;&amp; <a class="code" href="geotiff_h.html#a23">GTIFKeyGet</a>(psGTIF, ProjCenterLatGeoKey, 
01154                           &amp;dfNatOriginLat, 0, 1 ) == 0 )
01155             dfNatOriginLat = 0.0;
01156 
01157         <font class="keywordflow">if</font>( <a class="code" href="geotiff_h.html#a23">GTIFKeyGet</a>(psGTIF, ProjScaleAtNatOriginGeoKey,
01158                        &amp;dfNatOriginScale, 0, 1 ) == 0 )
01159             dfNatOriginScale = 1.0;
01160             
01161         <font class="comment">/* notdef: should transform to decimal degrees at this point */</font>
01162 
01163         psDefn-&gt;ProjParm[0] = dfNatOriginLat;
01164         psDefn-&gt;ProjParmId[0] = ProjCenterLatGeoKey;
01165         psDefn-&gt;ProjParm[1] = dfNatOriginLong;
01166         psDefn-&gt;ProjParmId[1] = ProjCenterLongGeoKey;
01167         psDefn-&gt;ProjParm[4] = dfNatOriginScale;
01168         psDefn-&gt;ProjParmId[4] = ProjScaleAtNatOriginGeoKey;
01169         psDefn-&gt;ProjParm[5] = dfFalseEasting;
01170         psDefn-&gt;ProjParmId[5] = ProjFalseEastingGeoKey;
01171         psDefn-&gt;ProjParm[6] = dfFalseNorthing;
01172         psDefn-&gt;ProjParmId[6] = ProjFalseNorthingGeoKey;
01173 
01174         psDefn-&gt;nParms = 7;
01175         <font class="keywordflow">break</font>;
01176 
01177 <font class="comment">/* -------------------------------------------------------------------- */</font>
01178       <font class="keywordflow">case</font> CT_LambertConfConic_1SP:
01179       <font class="keywordflow">case</font> CT_Mercator:
01180       <font class="keywordflow">case</font> CT_ObliqueStereographic:
01181       <font class="keywordflow">case</font> CT_TransverseMercator:
01182       <font class="keywordflow">case</font> CT_TransvMercator_SouthOriented:
01183 <font class="comment">/* -------------------------------------------------------------------- */</font>
01184         <font class="keywordflow">if</font>( <a class="code" href="geotiff_h.html#a23">GTIFKeyGet</a>(psGTIF, ProjNatOriginLongGeoKey, 
01185                        &amp;dfNatOriginLong, 0, 1 ) == 0
01186             &amp;&amp; <a class="code" href="geotiff_h.html#a23">GTIFKeyGet</a>(psGTIF, ProjFalseOriginLongGeoKey, 
01187                           &amp;dfNatOriginLong, 0, 1 ) == 0
01188             &amp;&amp; <a class="code" href="geotiff_h.html#a23">GTIFKeyGet</a>(psGTIF, ProjCenterLongGeoKey, 
01189                           &amp;dfNatOriginLong, 0, 1 ) == 0 )
01190             dfNatOriginLong = 0.0;
01191 
01192         <font class="keywordflow">if</font>( <a class="code" href="geotiff_h.html#a23">GTIFKeyGet</a>(psGTIF, ProjNatOriginLatGeoKey, 
01193                        &amp;dfNatOriginLat, 0, 1 ) == 0
01194             &amp;&amp; <a class="code" href="geotiff_h.html#a23">GTIFKeyGet</a>(psGTIF, ProjFalseOriginLatGeoKey, 
01195                           &amp;dfNatOriginLat, 0, 1 ) == 0
01196             &amp;&amp; <a class="code" href="geotiff_h.html#a23">GTIFKeyGet</a>(psGTIF, ProjCenterLatGeoKey, 
01197                           &amp;dfNatOriginLat, 0, 1 ) == 0 )
01198             dfNatOriginLat = 0.0;
01199 
01200         <font class="keywordflow">if</font>( <a class="code" href="geotiff_h.html#a23">GTIFKeyGet</a>(psGTIF, ProjScaleAtNatOriginGeoKey,
01201                        &amp;dfNatOriginScale, 0, 1 ) == 0 )
01202             dfNatOriginScale = 1.0;
01203             
01204         <font class="comment">/* notdef: should transform to decimal degrees at this point */</font>
01205 
01206         psDefn-&gt;ProjParm[0] = dfNatOriginLat;
01207         psDefn-&gt;ProjParmId[0] = ProjNatOriginLatGeoKey;
01208         psDefn-&gt;ProjParm[1] = dfNatOriginLong;
01209         psDefn-&gt;ProjParmId[1] = ProjNatOriginLongGeoKey;
01210         psDefn-&gt;ProjParm[4] = dfNatOriginScale;
01211         psDefn-&gt;ProjParmId[4] = ProjScaleAtNatOriginGeoKey;
01212         psDefn-&gt;ProjParm[5] = dfFalseEasting;
01213         psDefn-&gt;ProjParmId[5] = ProjFalseEastingGeoKey;
01214         psDefn-&gt;ProjParm[6] = dfFalseNorthing;
01215         psDefn-&gt;ProjParmId[6] = ProjFalseNorthingGeoKey;
01216 
01217         psDefn-&gt;nParms = 7;
01218         <font class="keywordflow">break</font>;
01219 
01220 <font class="comment">/* -------------------------------------------------------------------- */</font>
01221       <font class="keywordflow">case</font> CT_ObliqueMercator: <font class="comment">/* hotine */</font>
01222 <font class="comment">/* -------------------------------------------------------------------- */</font>
01223         <font class="keywordflow">if</font>( <a class="code" href="geotiff_h.html#a23">GTIFKeyGet</a>(psGTIF, ProjNatOriginLongGeoKey, 
01224                        &amp;dfNatOriginLong, 0, 1 ) == 0
01225             &amp;&amp; <a class="code" href="geotiff_h.html#a23">GTIFKeyGet</a>(psGTIF, ProjFalseOriginLongGeoKey, 
01226                           &amp;dfNatOriginLong, 0, 1 ) == 0
01227             &amp;&amp; <a class="code" href="geotiff_h.html#a23">GTIFKeyGet</a>(psGTIF, ProjCenterLongGeoKey, 
01228                           &amp;dfNatOriginLong, 0, 1 ) == 0 )
01229             dfNatOriginLong = 0.0;
01230 
01231         <font class="keywordflow">if</font>( <a class="code" href="geotiff_h.html#a23">GTIFKeyGet</a>(psGTIF, ProjNatOriginLatGeoKey, 
01232                        &amp;dfNatOriginLat, 0, 1 ) == 0
01233             &amp;&amp; <a class="code" href="geotiff_h.html#a23">GTIFKeyGet</a>(psGTIF, ProjFalseOriginLatGeoKey, 
01234                           &amp;dfNatOriginLat, 0, 1 ) == 0
01235             &amp;&amp; <a class="code" href="geotiff_h.html#a23">GTIFKeyGet</a>(psGTIF, ProjCenterLatGeoKey, 
01236                           &amp;dfNatOriginLat, 0, 1 ) == 0 )
01237             dfNatOriginLat = 0.0;
01238 
01239         <font class="keywordflow">if</font>( <a class="code" href="geotiff_h.html#a23">GTIFKeyGet</a>(psGTIF, ProjAzimuthAngleGeoKey, 
01240                        &amp;dfAzimuth, 0, 1 ) == 0 )
01241             dfAzimuth = 0.0;
01242 
01243         <font class="keywordflow">if</font>( <a class="code" href="geotiff_h.html#a23">GTIFKeyGet</a>(psGTIF, ProjRectifiedGridAngleGeoKey,
01244                        &amp;dfRectGridAngle, 0, 1 ) == 0 )
01245             dfRectGridAngle = 90.0;
01246 
01247         <font class="keywordflow">if</font>( <a class="code" href="geotiff_h.html#a23">GTIFKeyGet</a>(psGTIF, ProjScaleAtNatOriginGeoKey,
01248                        &amp;dfNatOriginScale, 0, 1 ) == 0
01249             &amp;&amp; <a class="code" href="geotiff_h.html#a23">GTIFKeyGet</a>(psGTIF, ProjScaleAtCenterGeoKey,
01250                           &amp;dfNatOriginScale, 0, 1 ) == 0 )
01251             dfNatOriginScale = 1.0;
01252             
01253         <font class="comment">/* notdef: should transform to decimal degrees at this point */</font>
01254 
01255         psDefn-&gt;ProjParm[0] = dfNatOriginLat;
01256         psDefn-&gt;ProjParmId[0] = ProjCenterLatGeoKey;
01257         psDefn-&gt;ProjParm[1] = dfNatOriginLong;
01258         psDefn-&gt;ProjParmId[1] = ProjCenterLongGeoKey;
01259         psDefn-&gt;ProjParm[2] = dfAzimuth;
01260         psDefn-&gt;ProjParmId[2] = ProjAzimuthAngleGeoKey;
01261         psDefn-&gt;ProjParm[3] = dfRectGridAngle;
01262         psDefn-&gt;ProjParmId[3] = ProjRectifiedGridAngleGeoKey;
01263         psDefn-&gt;ProjParm[4] = dfNatOriginScale;
01264         psDefn-&gt;ProjParmId[4] = ProjScaleAtCenterGeoKey;
01265         psDefn-&gt;ProjParm[5] = dfFalseEasting;
01266         psDefn-&gt;ProjParmId[5] = ProjFalseEastingGeoKey;
01267         psDefn-&gt;ProjParm[6] = dfFalseNorthing;
01268         psDefn-&gt;ProjParmId[6] = ProjFalseNorthingGeoKey;
01269 
01270         psDefn-&gt;nParms = 7;
01271         <font class="keywordflow">break</font>;
01272 
01273 <font class="comment">/* -------------------------------------------------------------------- */</font>
01274       <font class="keywordflow">case</font> CT_CassiniSoldner:
01275       <font class="keywordflow">case</font> CT_Polyconic:
01276 <font class="comment">/* -------------------------------------------------------------------- */</font>
01277         <font class="keywordflow">if</font>( <a class="code" href="geotiff_h.html#a23">GTIFKeyGet</a>(psGTIF, ProjNatOriginLongGeoKey, 
01278                        &amp;dfNatOriginLong, 0, 1 ) == 0
01279             &amp;&amp; <a class="code" href="geotiff_h.html#a23">GTIFKeyGet</a>(psGTIF, ProjFalseOriginLongGeoKey, 
01280                           &amp;dfNatOriginLong, 0, 1 ) == 0
01281             &amp;&amp; <a class="code" href="geotiff_h.html#a23">GTIFKeyGet</a>(psGTIF, ProjCenterLongGeoKey, 
01282                           &amp;dfNatOriginLong, 0, 1 ) == 0 )
01283             dfNatOriginLong = 0.0;
01284 
01285         <font class="keywordflow">if</font>( <a class="code" href="geotiff_h.html#a23">GTIFKeyGet</a>(psGTIF, ProjNatOriginLatGeoKey, 
01286                        &amp;dfNatOriginLat, 0, 1 ) == 0
01287             &amp;&amp; <a class="code" href="geotiff_h.html#a23">GTIFKeyGet</a>(psGTIF, ProjFalseOriginLatGeoKey, 
01288                           &amp;dfNatOriginLat, 0, 1 ) == 0
01289             &amp;&amp; <a class="code" href="geotiff_h.html#a23">GTIFKeyGet</a>(psGTIF, ProjCenterLatGeoKey, 
01290                           &amp;dfNatOriginLat, 0, 1 ) == 0 )
01291             dfNatOriginLat = 0.0;
01292 
01293         <font class="keywordflow">if</font>( <a class="code" href="geotiff_h.html#a23">GTIFKeyGet</a>(psGTIF, ProjScaleAtNatOriginGeoKey,
01294                        &amp;dfNatOriginScale, 0, 1 ) == 0
01295             &amp;&amp; <a class="code" href="geotiff_h.html#a23">GTIFKeyGet</a>(psGTIF, ProjScaleAtCenterGeoKey,
01296                           &amp;dfNatOriginScale, 0, 1 ) == 0 )
01297             dfNatOriginScale = 1.0;
01298             
01299         <font class="comment">/* notdef: should transform to decimal degrees at this point */</font>
01300 
01301         psDefn-&gt;ProjParm[0] = dfNatOriginLat;
01302         psDefn-&gt;ProjParmId[0] = ProjNatOriginLatGeoKey;
01303         psDefn-&gt;ProjParm[1] = dfNatOriginLong;
01304         psDefn-&gt;ProjParmId[1] = ProjNatOriginLongGeoKey;
01305         psDefn-&gt;ProjParm[4] = dfNatOriginScale;
01306         psDefn-&gt;ProjParmId[4] = ProjScaleAtNatOriginGeoKey;
01307         psDefn-&gt;ProjParm[5] = dfFalseEasting;
01308         psDefn-&gt;ProjParmId[5] = ProjFalseEastingGeoKey;
01309         psDefn-&gt;ProjParm[6] = dfFalseNorthing;
01310         psDefn-&gt;ProjParmId[6] = ProjFalseNorthingGeoKey;
01311 
01312         psDefn-&gt;nParms = 7;
01313         <font class="keywordflow">break</font>;
01314 
01315 <font class="comment">/* -------------------------------------------------------------------- */</font>
01316       <font class="keywordflow">case</font> CT_AzimuthalEquidistant:
01317       <font class="keywordflow">case</font> CT_MillerCylindrical:
01318       <font class="keywordflow">case</font> CT_Equirectangular:
01319       <font class="keywordflow">case</font> CT_Gnomonic:
01320       <font class="keywordflow">case</font> CT_LambertAzimEqualArea:
01321       <font class="keywordflow">case</font> CT_Orthographic:
01322 <font class="comment">/* -------------------------------------------------------------------- */</font>
01323         <font class="keywordflow">if</font>( <a class="code" href="geotiff_h.html#a23">GTIFKeyGet</a>(psGTIF, ProjNatOriginLongGeoKey, 
01324                        &amp;dfNatOriginLong, 0, 1 ) == 0
01325             &amp;&amp; <a class="code" href="geotiff_h.html#a23">GTIFKeyGet</a>(psGTIF, ProjFalseOriginLongGeoKey, 
01326                           &amp;dfNatOriginLong, 0, 1 ) == 0
01327             &amp;&amp; <a class="code" href="geotiff_h.html#a23">GTIFKeyGet</a>(psGTIF, ProjCenterLongGeoKey, 
01328                           &amp;dfNatOriginLong, 0, 1 ) == 0 )
01329             dfNatOriginLong = 0.0;
01330 
01331         <font class="keywordflow">if</font>( <a class="code" href="geotiff_h.html#a23">GTIFKeyGet</a>(psGTIF, ProjNatOriginLatGeoKey, 
01332                        &amp;dfNatOriginLat, 0, 1 ) == 0
01333             &amp;&amp; <a class="code" href="geotiff_h.html#a23">GTIFKeyGet</a>(psGTIF, ProjFalseOriginLatGeoKey, 
01334                           &amp;dfNatOriginLat, 0, 1 ) == 0
01335             &amp;&amp; <a class="code" href="geotiff_h.html#a23">GTIFKeyGet</a>(psGTIF, ProjCenterLatGeoKey, 
01336                           &amp;dfNatOriginLat, 0, 1 ) == 0 )
01337             dfNatOriginLat = 0.0;
01338 
01339         <font class="comment">/* notdef: should transform to decimal degrees at this point */</font>
01340 
01341         psDefn-&gt;ProjParm[0] = dfNatOriginLat;
01342         psDefn-&gt;ProjParmId[0] = ProjCenterLatGeoKey;
01343         psDefn-&gt;ProjParm[1] = dfNatOriginLong;
01344         psDefn-&gt;ProjParmId[1] = ProjCenterLongGeoKey;
01345         psDefn-&gt;ProjParm[5] = dfFalseEasting;
01346         psDefn-&gt;ProjParmId[5] = ProjFalseEastingGeoKey;
01347         psDefn-&gt;ProjParm[6] = dfFalseNorthing;
01348         psDefn-&gt;ProjParmId[6] = ProjFalseNorthingGeoKey;
01349 
01350         psDefn-&gt;nParms = 7;
01351         <font class="keywordflow">break</font>;
01352 
01353 <font class="comment">/* -------------------------------------------------------------------- */</font>
01354       <font class="keywordflow">case</font> CT_Robinson:
01355       <font class="keywordflow">case</font> CT_Sinusoidal:
01356       <font class="keywordflow">case</font> CT_VanDerGrinten:
01357 <font class="comment">/* -------------------------------------------------------------------- */</font>
01358         <font class="keywordflow">if</font>( <a class="code" href="geotiff_h.html#a23">GTIFKeyGet</a>(psGTIF, ProjNatOriginLongGeoKey, 
01359                        &amp;dfNatOriginLong, 0, 1 ) == 0
01360             &amp;&amp; <a class="code" href="geotiff_h.html#a23">GTIFKeyGet</a>(psGTIF, ProjFalseOriginLongGeoKey, 
01361                           &amp;dfNatOriginLong, 0, 1 ) == 0
01362             &amp;&amp; <a class="code" href="geotiff_h.html#a23">GTIFKeyGet</a>(psGTIF, ProjCenterLongGeoKey, 
01363                           &amp;dfNatOriginLong, 0, 1 ) == 0 )
01364             dfNatOriginLong = 0.0;
01365 
01366         <font class="comment">/* notdef: should transform to decimal degrees at this point */</font>
01367 
01368         psDefn-&gt;ProjParm[1] = dfNatOriginLong;
01369         psDefn-&gt;ProjParmId[1] = ProjCenterLongGeoKey;
01370         psDefn-&gt;ProjParm[5] = dfFalseEasting;
01371         psDefn-&gt;ProjParmId[5] = ProjFalseEastingGeoKey;
01372         psDefn-&gt;ProjParm[6] = dfFalseNorthing;
01373         psDefn-&gt;ProjParmId[6] = ProjFalseNorthingGeoKey;
01374 
01375         psDefn-&gt;nParms = 7;
01376         <font class="keywordflow">break</font>;
01377 
01378 <font class="comment">/* -------------------------------------------------------------------- */</font>
01379       <font class="keywordflow">case</font> CT_PolarStereographic:
01380 <font class="comment">/* -------------------------------------------------------------------- */</font>
01381         <font class="keywordflow">if</font>( <a class="code" href="geotiff_h.html#a23">GTIFKeyGet</a>(psGTIF, ProjStraightVertPoleLongGeoKey, 
01382                        &amp;dfNatOriginLong, 0, 1 ) == 0
01383             &amp;&amp; <a class="code" href="geotiff_h.html#a23">GTIFKeyGet</a>(psGTIF, ProjNatOriginLongGeoKey, 
01384                           &amp;dfNatOriginLong, 0, 1 ) == 0
01385             &amp;&amp; <a class="code" href="geotiff_h.html#a23">GTIFKeyGet</a>(psGTIF, ProjFalseOriginLongGeoKey, 
01386                           &amp;dfNatOriginLong, 0, 1 ) == 0
01387             &amp;&amp; <a class="code" href="geotiff_h.html#a23">GTIFKeyGet</a>(psGTIF, ProjCenterLongGeoKey, 
01388                           &amp;dfNatOriginLong, 0, 1 ) == 0 )
01389             dfNatOriginLong = 0.0;
01390 
01391         <font class="keywordflow">if</font>( <a class="code" href="geotiff_h.html#a23">GTIFKeyGet</a>(psGTIF, ProjNatOriginLatGeoKey, 
01392                        &amp;dfNatOriginLat, 0, 1 ) == 0
01393             &amp;&amp; <a class="code" href="geotiff_h.html#a23">GTIFKeyGet</a>(psGTIF, ProjFalseOriginLatGeoKey, 
01394                           &amp;dfNatOriginLat, 0, 1 ) == 0
01395             &amp;&amp; <a class="code" href="geotiff_h.html#a23">GTIFKeyGet</a>(psGTIF, ProjCenterLatGeoKey, 
01396                           &amp;dfNatOriginLat, 0, 1 ) == 0 )
01397             dfNatOriginLat = 0.0;
01398 
01399         <font class="keywordflow">if</font>( <a class="code" href="geotiff_h.html#a23">GTIFKeyGet</a>(psGTIF, ProjScaleAtNatOriginGeoKey,
01400                        &amp;dfNatOriginScale, 0, 1 ) == 0
01401             &amp;&amp; <a class="code" href="geotiff_h.html#a23">GTIFKeyGet</a>(psGTIF, ProjScaleAtCenterGeoKey,
01402                           &amp;dfNatOriginScale, 0, 1 ) == 0 )
01403             dfNatOriginScale = 1.0;
01404             
01405         <font class="comment">/* notdef: should transform to decimal degrees at this point */</font>
01406 
01407         psDefn-&gt;ProjParm[0] = dfNatOriginLat;
01408         psDefn-&gt;ProjParmId[0] = ProjNatOriginLatGeoKey;;
01409         psDefn-&gt;ProjParm[1] = dfNatOriginLong;
01410         psDefn-&gt;ProjParmId[1] = ProjStraightVertPoleLongGeoKey;
01411         psDefn-&gt;ProjParm[4] = dfNatOriginScale;
01412         psDefn-&gt;ProjParmId[4] = ProjScaleAtNatOriginGeoKey;
01413         psDefn-&gt;ProjParm[5] = dfFalseEasting;
01414         psDefn-&gt;ProjParmId[5] = ProjFalseEastingGeoKey;
01415         psDefn-&gt;ProjParm[6] = dfFalseNorthing;
01416         psDefn-&gt;ProjParmId[6] = ProjFalseNorthingGeoKey;
01417 
01418         psDefn-&gt;nParms = 7;
01419         <font class="keywordflow">break</font>;
01420 
01421 <font class="comment">/* -------------------------------------------------------------------- */</font>
01422       <font class="keywordflow">case</font> CT_LambertConfConic_2SP:
01423 <font class="comment">/* -------------------------------------------------------------------- */</font>
01424         <font class="keywordflow">if</font>( <a class="code" href="geotiff_h.html#a23">GTIFKeyGet</a>(psGTIF, ProjStdParallel1GeoKey, 
01425                        &amp;dfStdParallel1, 0, 1 ) == 0 )
01426             dfStdParallel1 = 0.0;
01427 
01428         <font class="keywordflow">if</font>( <a class="code" href="geotiff_h.html#a23">GTIFKeyGet</a>(psGTIF, ProjStdParallel2GeoKey, 
01429                        &amp;dfStdParallel2, 0, 1 ) == 0 )
01430             dfStdParallel1 = 0.0;
01431 
01432         <font class="keywordflow">if</font>( <a class="code" href="geotiff_h.html#a23">GTIFKeyGet</a>(psGTIF, ProjNatOriginLongGeoKey, 
01433                        &amp;dfNatOriginLong, 0, 1 ) == 0
01434             &amp;&amp; <a class="code" href="geotiff_h.html#a23">GTIFKeyGet</a>(psGTIF, ProjFalseOriginLongGeoKey, 
01435                           &amp;dfNatOriginLong, 0, 1 ) == 0
01436             &amp;&amp; <a class="code" href="geotiff_h.html#a23">GTIFKeyGet</a>(psGTIF, ProjCenterLongGeoKey, 
01437                           &amp;dfNatOriginLong, 0, 1 ) == 0 )
01438             dfNatOriginLong = 0.0;
01439 
01440         <font class="keywordflow">if</font>( <a class="code" href="geotiff_h.html#a23">GTIFKeyGet</a>(psGTIF, ProjNatOriginLatGeoKey, 
01441                        &amp;dfNatOriginLat, 0, 1 ) == 0
01442             &amp;&amp; <a class="code" href="geotiff_h.html#a23">GTIFKeyGet</a>(psGTIF, ProjFalseOriginLatGeoKey, 
01443                           &amp;dfNatOriginLat, 0, 1 ) == 0
01444             &amp;&amp; <a class="code" href="geotiff_h.html#a23">GTIFKeyGet</a>(psGTIF, ProjCenterLatGeoKey, 
01445                           &amp;dfNatOriginLat, 0, 1 ) == 0 )
01446             dfNatOriginLat = 0.0;
01447 
01448         <font class="comment">/* notdef: should transform to decimal degrees at this point */</font>
01449 
01450         psDefn-&gt;ProjParm[0] = dfNatOriginLat;
01451         psDefn-&gt;ProjParmId[0] = ProjFalseOriginLatGeoKey;
01452         psDefn-&gt;ProjParm[1] = dfNatOriginLong;
01453         psDefn-&gt;ProjParmId[1] = ProjFalseOriginLongGeoKey;
01454         psDefn-&gt;ProjParm[2] = dfStdParallel1;
01455         psDefn-&gt;ProjParmId[2] = ProjStdParallel1GeoKey;
01456         psDefn-&gt;ProjParm[3] = dfStdParallel2;
01457         psDefn-&gt;ProjParmId[3] = ProjStdParallel2GeoKey;
01458         psDefn-&gt;ProjParm[5] = dfFalseEasting;
01459         psDefn-&gt;ProjParmId[5] = ProjFalseEastingGeoKey;
01460         psDefn-&gt;ProjParm[6] = dfFalseNorthing;
01461         psDefn-&gt;ProjParmId[6] = ProjFalseNorthingGeoKey;
01462 
01463         psDefn-&gt;nParms = 7;
01464         <font class="keywordflow">break</font>;
01465 
01466 <font class="comment">/* -------------------------------------------------------------------- */</font>
01467       <font class="keywordflow">case</font> CT_AlbersEqualArea:
01468       <font class="keywordflow">case</font> CT_EquidistantConic:
01469 <font class="comment">/* -------------------------------------------------------------------- */</font>
01470         <font class="keywordflow">if</font>( <a class="code" href="geotiff_h.html#a23">GTIFKeyGet</a>(psGTIF, ProjStdParallel1GeoKey, 
01471                        &amp;dfStdParallel1, 0, 1 ) == 0 )
01472             dfStdParallel1 = 0.0;
01473 
01474         <font class="keywordflow">if</font>( <a class="code" href="geotiff_h.html#a23">GTIFKeyGet</a>(psGTIF, ProjStdParallel2GeoKey, 
01475                        &amp;dfStdParallel2, 0, 1 ) == 0 )
01476             dfStdParallel1 = 0.0;
01477 
01478         <font class="keywordflow">if</font>( <a class="code" href="geotiff_h.html#a23">GTIFKeyGet</a>(psGTIF, ProjNatOriginLongGeoKey, 
01479                        &amp;dfNatOriginLong, 0, 1 ) == 0
01480             &amp;&amp; <a class="code" href="geotiff_h.html#a23">GTIFKeyGet</a>(psGTIF, ProjFalseOriginLongGeoKey, 
01481                           &amp;dfNatOriginLong, 0, 1 ) == 0
01482             &amp;&amp; <a class="code" href="geotiff_h.html#a23">GTIFKeyGet</a>(psGTIF, ProjCenterLongGeoKey, 
01483                           &amp;dfNatOriginLong, 0, 1 ) == 0 )
01484             dfNatOriginLong = 0.0;
01485 
01486         <font class="keywordflow">if</font>( <a class="code" href="geotiff_h.html#a23">GTIFKeyGet</a>(psGTIF, ProjNatOriginLatGeoKey, 
01487                        &amp;dfNatOriginLat, 0, 1 ) == 0
01488             &amp;&amp; <a class="code" href="geotiff_h.html#a23">GTIFKeyGet</a>(psGTIF, ProjFalseOriginLatGeoKey, 
01489                           &amp;dfNatOriginLat, 0, 1 ) == 0
01490             &amp;&amp; <a class="code" href="geotiff_h.html#a23">GTIFKeyGet</a>(psGTIF, ProjCenterLatGeoKey, 
01491                           &amp;dfNatOriginLat, 0, 1 ) == 0 )
01492             dfNatOriginLat = 0.0;
01493 
01494         <font class="comment">/* notdef: should transform to decimal degrees at this point */</font>
01495 
01496         psDefn-&gt;ProjParm[0] = dfStdParallel1;
01497         psDefn-&gt;ProjParmId[0] = ProjStdParallel1GeoKey;
01498         psDefn-&gt;ProjParm[1] = dfStdParallel2;
01499         psDefn-&gt;ProjParmId[1] = ProjStdParallel2GeoKey;
01500         psDefn-&gt;ProjParm[2] = dfNatOriginLat;
01501         psDefn-&gt;ProjParmId[2] = ProjNatOriginLatGeoKey;
01502         psDefn-&gt;ProjParm[3] = dfNatOriginLong;
01503         psDefn-&gt;ProjParmId[3] = ProjNatOriginLongGeoKey;
01504         psDefn-&gt;ProjParm[5] = dfFalseEasting;
01505         psDefn-&gt;ProjParmId[5] = ProjFalseEastingGeoKey;
01506         psDefn-&gt;ProjParm[6] = dfFalseNorthing;
01507         psDefn-&gt;ProjParmId[6] = ProjFalseNorthingGeoKey;
01508 
01509         psDefn-&gt;nParms = 7;
01510         <font class="keywordflow">break</font>;
01511     }
01512 }
01513 
01514 <font class="comment">/************************************************************************/</font>
01515 <font class="comment">/*                            GTIFGetDefn()                             */</font>
01516 <font class="comment">/************************************************************************/</font>
01517 
01634 <font class="keywordtype">int</font> <a class="code" href="geo_normalize_h.html#a14">GTIFGetDefn</a>( GTIF * psGTIF, <a class="code" href="struct_GTIFDefn.html">GTIFDefn</a> * psDefn )<font class="keyword"></font>
01635 <font class="keyword"></font>
01636 <font class="keyword"></font>{
01637     <font class="keywordtype">int</font>         i;
01638     <font class="keywordtype">short</font>       nGeogUOMLinear;
01639     
01640 <font class="comment">/* -------------------------------------------------------------------- */</font>
01641 <font class="comment">/*      Initially we default all the information we can.                */</font>
01642 <font class="comment">/* -------------------------------------------------------------------- */</font>
01643     psDefn-&gt;Model = KvUserDefined;
01644     psDefn-&gt;PCS = KvUserDefined;
01645     psDefn-&gt;GCS = KvUserDefined;
01646     psDefn-&gt;UOMLength = KvUserDefined;
01647     psDefn-&gt;UOMLengthInMeters = 1.0;
01648     psDefn-&gt;UOMAngle = KvUserDefined;
01649     psDefn-&gt;UOMAngleInDegrees = 1.0;
01650     psDefn-&gt;Datum = KvUserDefined;
01651     psDefn-&gt;Ellipsoid = KvUserDefined;
01652     psDefn-&gt;SemiMajor = 0.0;
01653     psDefn-&gt;SemiMinor = 0.0;
01654     psDefn-&gt;PM = KvUserDefined;
01655     psDefn-&gt;PMLongToGreenwich = 0.0;
01656 
01657     psDefn-&gt;ProjCode = KvUserDefined;
01658     psDefn-&gt;Projection = KvUserDefined;
01659     psDefn-&gt;CTProjection = KvUserDefined;
01660 
01661     psDefn-&gt;nParms = 0;
01662     <font class="keywordflow">for</font>( i = 0; i &lt; MAX_GTIF_PROJPARMS; i++ )
01663     {
01664         psDefn-&gt;ProjParm[i] = 0.0;
01665         psDefn-&gt;ProjParmId[i] = 0;
01666     }
01667 
01668     psDefn-&gt;MapSys = KvUserDefined;
01669     psDefn-&gt;Zone = 0;
01670 
01671 <font class="comment">/* -------------------------------------------------------------------- */</font>
01672 <font class="comment">/*      Try to get the overall model type.                              */</font>
01673 <font class="comment">/* -------------------------------------------------------------------- */</font>
01674     <a class="code" href="geotiff_h.html#a23">GTIFKeyGet</a>(psGTIF,GTModelTypeGeoKey,&amp;(psDefn-&gt;Model),0,1);
01675 
01676 <font class="comment">/* -------------------------------------------------------------------- */</font>
01677 <font class="comment">/*      Extract the Geog units.                                         */</font>
01678 <font class="comment">/* -------------------------------------------------------------------- */</font>
01679     nGeogUOMLinear = 9001; <font class="comment">/* Linear_Meter */</font>
01680     <a class="code" href="geotiff_h.html#a23">GTIFKeyGet</a>(psGTIF, GeogLinearUnitsGeoKey, &amp;nGeogUOMLinear, 0, 1 );
01681 
01682 <font class="comment">/* -------------------------------------------------------------------- */</font>
01683 <font class="comment">/*      Try to get a PCS.                                               */</font>
01684 <font class="comment">/* -------------------------------------------------------------------- */</font>
01685     <font class="keywordflow">if</font>( <a class="code" href="geotiff_h.html#a23">GTIFKeyGet</a>(psGTIF,ProjectedCSTypeGeoKey, &amp;(psDefn-&gt;PCS),0,1) == 1
01686         &amp;&amp; psDefn-&gt;PCS != KvUserDefined )
01687     {
01688         <font class="comment">/*</font>
01689 <font class="comment">         * Translate this into useful information.</font>
01690 <font class="comment">         */</font>
01691         GTIFGetPCSInfo( psDefn-&gt;PCS, NULL,
01692                         &amp;(psDefn-&gt;UOMLength), &amp;(psDefn-&gt;UOMAngle),
01693                         &amp;(psDefn-&gt;GCS), &amp;(psDefn-&gt;ProjCode) );
01694     }
01695 
01696 <font class="comment">/* -------------------------------------------------------------------- */</font>
01697 <font class="comment">/*       If we have the PCS code, but didn't find it in the CSV files   */</font>
01698 <font class="comment">/*      (likely because we can't find them) we will try some ``jiffy    */</font>
01699 <font class="comment">/*      rules'' for UTM and state plane.                                */</font>
01700 <font class="comment">/* -------------------------------------------------------------------- */</font>
01701     <font class="keywordflow">if</font>( psDefn-&gt;PCS != KvUserDefined &amp;&amp; psDefn-&gt;ProjCode == KvUserDefined )
01702     {
01703         <font class="keywordtype">int</font>     nMapSys, nZone;
01704         <font class="keywordtype">int</font>     nGCS = psDefn-&gt;GCS;
01705 
01706         nMapSys = <a class="code" href="geo_normalize_h.html#a21">GTIFPCSToMapSys</a>( psDefn-&gt;PCS, &amp;nGCS, &amp;nZone );
01707         <font class="keywordflow">if</font>( nMapSys != KvUserDefined )
01708         {
01709             psDefn-&gt;ProjCode = GTIFMapSysToProj( nMapSys, nZone );
01710             psDefn-&gt;GCS = nGCS;
01711         }
01712     }
01713 
01714 <font class="comment">/* -------------------------------------------------------------------- */</font>
01715 <font class="comment">/*      If the Proj_ code is specified directly, use that.              */</font>
01716 <font class="comment">/* -------------------------------------------------------------------- */</font>
01717     <font class="keywordflow">if</font>( psDefn-&gt;ProjCode == KvUserDefined )
01718         <a class="code" href="geotiff_h.html#a23">GTIFKeyGet</a>(psGTIF, ProjectionGeoKey, &amp;(psDefn-&gt;ProjCode), 0, 1 );
01719     
01720     <font class="keywordflow">if</font>( psDefn-&gt;ProjCode != KvUserDefined )
01721     {
01722         <font class="comment">/*</font>
01723 <font class="comment">         * We have an underlying projection transformation value.  Look</font>
01724 <font class="comment">         * this up.  For a PCS of ``WGS 84 / UTM 11'' the transformation</font>
01725 <font class="comment">         * would be Transverse Mercator, with a particular set of options.</font>
01726 <font class="comment">         * The nProjTRFCode itself would correspond to the name</font>
01727 <font class="comment">         * ``UTM zone 11N'', and doesn't include datum info.</font>
01728 <font class="comment">         */</font>
01729         GTIFGetProjTRFInfo( psDefn-&gt;ProjCode, NULL,
01730                             &amp;(psDefn-&gt;Projection),
01731                             psDefn-&gt;ProjParm );
01732         psDefn-&gt;CTProjection =
01733             EPSGProjMethodToCTProjMethod( psDefn-&gt;Projection );
01734         
01735         <font class="comment">/*</font>
01736 <font class="comment">         * Set the GeoTIFF identity of the parameters.</font>
01737 <font class="comment">         */</font>
01738         SetGTParmIds( psDefn );
01739     }
01740 
01741 <font class="comment">/* -------------------------------------------------------------------- */</font>
01742 <font class="comment">/*      Try to get a GCS.  If found, it will override any implied by    */</font>
01743 <font class="comment">/*      the PCS.                                                        */</font>
01744 <font class="comment">/* -------------------------------------------------------------------- */</font>
01745     <a class="code" href="geotiff_h.html#a23">GTIFKeyGet</a>(psGTIF, GeographicTypeGeoKey, &amp;(psDefn-&gt;GCS), 0, 1 );
01746 
01747 <font class="comment">/* -------------------------------------------------------------------- */</font>
01748 <font class="comment">/*      Derive the datum, and prime meridian from the GCS.              */</font>
01749 <font class="comment">/* -------------------------------------------------------------------- */</font>
01750     <font class="keywordflow">if</font>( psDefn-&gt;GCS != KvUserDefined )
01751     {
01752         GTIFGetGCSInfo( psDefn-&gt;GCS, NULL, &amp;(psDefn-&gt;Datum), &amp;(psDefn-&gt;PM),
01753                         &amp;(psDefn-&gt;UOMAngle) );
01754     }
01755     
01756 <font class="comment">/* -------------------------------------------------------------------- */</font>
01757 <font class="comment">/*      Handle the GCS angular units.  GeogAngularUnitsGeoKey           */</font>
01758 <font class="comment">/*      overrides the GCS or PCS setting.                               */</font>
01759 <font class="comment">/* -------------------------------------------------------------------- */</font>
01760     <a class="code" href="geotiff_h.html#a23">GTIFKeyGet</a>(psGTIF, GeogAngularUnitsGeoKey, &amp;(psDefn-&gt;UOMAngle), 0, 1 );
01761     <font class="keywordflow">if</font>( psDefn-&gt;UOMAngle != KvUserDefined )
01762     {
01763         GTIFGetUOMAngleInfo( psDefn-&gt;UOMAngle, NULL,
01764                              &amp;(psDefn-&gt;UOMAngleInDegrees) );
01765     }
01766 
01767 <font class="comment">/* -------------------------------------------------------------------- */</font>
01768 <font class="comment">/*      Check for a datum setting, and then use the datum to derive     */</font>
01769 <font class="comment">/*      an ellipsoid.                                                   */</font>
01770 <font class="comment">/* -------------------------------------------------------------------- */</font>
01771     <a class="code" href="geotiff_h.html#a23">GTIFKeyGet</a>(psGTIF, GeogGeodeticDatumGeoKey, &amp;(psDefn-&gt;Datum), 0, 1 );
01772 
01773     <font class="keywordflow">if</font>( psDefn-&gt;Datum != KvUserDefined )
01774     {
01775         GTIFGetDatumInfo( psDefn-&gt;Datum, NULL, &amp;(psDefn-&gt;Ellipsoid) );
01776     }
01777 
01778 <font class="comment">/* -------------------------------------------------------------------- */</font>
01779 <font class="comment">/*      Check for an explicit ellipsoid.  Use the ellipsoid to          */</font>
01780 <font class="comment">/*      derive the ellipsoid characteristics, if possible.              */</font>
01781 <font class="comment">/* -------------------------------------------------------------------- */</font>
01782     <a class="code" href="geotiff_h.html#a23">GTIFKeyGet</a>(psGTIF, GeogEllipsoidGeoKey, &amp;(psDefn-&gt;Ellipsoid), 0, 1 );
01783 
01784     <font class="keywordflow">if</font>( psDefn-&gt;Ellipsoid != KvUserDefined )
01785     {
01786         GTIFGetEllipsoidInfo( psDefn-&gt;Ellipsoid, NULL,
01787                               &amp;(psDefn-&gt;SemiMajor), &amp;(psDefn-&gt;SemiMinor) );
01788     }
01789     
01790 <font class="comment">/* -------------------------------------------------------------------- */</font>
01791 <font class="comment">/*      Get the prime meridian info.                                    */</font>
01792 <font class="comment">/* -------------------------------------------------------------------- */</font>
01793     <a class="code" href="geotiff_h.html#a23">GTIFKeyGet</a>(psGTIF, GeogPrimeMeridianGeoKey, &amp;(psDefn-&gt;PM), 0, 1 );
01794 
01795     <font class="keywordflow">if</font>( psDefn-&gt;PM != KvUserDefined )
01796     {
01797         GTIFGetPMInfo( psDefn-&gt;PM, NULL, &amp;(psDefn-&gt;PMLongToGreenwich) );
01798     }
01799     <font class="keywordflow">else</font>
01800     {
01801         <a class="code" href="geotiff_h.html#a23">GTIFKeyGet</a>(psGTIF, GeogPrimeMeridianLongGeoKey,
01802                    &amp;(psDefn-&gt;PMLongToGreenwich), 0, 1 );
01803 
01804         psDefn-&gt;PMLongToGreenwich =
01805             GTIFAngleToDD( psDefn-&gt;PMLongToGreenwich,
01806                            psDefn-&gt;UOMAngle );
01807     }
01808 
01809 <font class="comment">/* -------------------------------------------------------------------- */</font>
01810 <font class="comment">/*      Have the projection units of measure been overridden?  We       */</font>
01811 <font class="comment">/*      should likely be doing something about angular units too,       */</font>
01812 <font class="comment">/*      but these are very rarely not decimal degrees for actual        */</font>
01813 <font class="comment">/*      file coordinates.                                               */</font>
01814 <font class="comment">/* -------------------------------------------------------------------- */</font>
01815     <a class="code" href="geotiff_h.html#a23">GTIFKeyGet</a>(psGTIF,ProjLinearUnitsGeoKey,&amp;(psDefn-&gt;UOMLength),0,1);
01816 
01817     <font class="keywordflow">if</font>( psDefn-&gt;UOMLength != KvUserDefined )
01818     {
01819         GTIFGetUOMLengthInfo( psDefn-&gt;UOMLength, NULL,
01820                               &amp;(psDefn-&gt;UOMLengthInMeters) );
01821     }
01822 
01823 <font class="comment">/* -------------------------------------------------------------------- */</font>
01824 <font class="comment">/*      Handle a variety of user defined transform types.               */</font>
01825 <font class="comment">/* -------------------------------------------------------------------- */</font>
01826     <font class="keywordflow">if</font>( <a class="code" href="geotiff_h.html#a23">GTIFKeyGet</a>(psGTIF,ProjCoordTransGeoKey,
01827                    &amp;(psDefn-&gt;CTProjection),0,1) == 1)
01828     {
01829         GTIFFetchProjParms( psGTIF, psDefn );
01830     }
01831 
01832 <font class="comment">/* -------------------------------------------------------------------- */</font>
01833 <font class="comment">/*      Try to set the zoned map system information.                    */</font>
01834 <font class="comment">/* -------------------------------------------------------------------- */</font>
01835     psDefn-&gt;MapSys = <a class="code" href="geo_normalize_h.html#a22">GTIFProjToMapSys</a>( psDefn-&gt;ProjCode, &amp;(psDefn-&gt;Zone) );
01836 
01837 <font class="comment">/* -------------------------------------------------------------------- */</font>
01838 <font class="comment">/*      If this is UTM, and we were unable to extract the projection    */</font>
01839 <font class="comment">/*      parameters from the CSV file, just set them directly now,       */</font>
01840 <font class="comment">/*      since it's pretty easy, and a common case.                      */</font>
01841 <font class="comment">/* -------------------------------------------------------------------- */</font>
01842     <font class="keywordflow">if</font>( (psDefn-&gt;MapSys == MapSys_UTM_North
01843          || psDefn-&gt;MapSys == MapSys_UTM_South)
01844         &amp;&amp; psDefn-&gt;CTProjection == KvUserDefined )
01845     {
01846         psDefn-&gt;CTProjection = CT_TransverseMercator;
01847         psDefn-&gt;nParms = 7;
01848         psDefn-&gt;ProjParmId[0] = ProjNatOriginLatGeoKey;
01849         psDefn-&gt;ProjParm[0] = 0.0;
01850             
01851         psDefn-&gt;ProjParmId[1] = ProjNatOriginLongGeoKey;
01852         psDefn-&gt;ProjParm[1] = psDefn-&gt;Zone*6 - 183.0;
01853         
01854         psDefn-&gt;ProjParmId[4] = ProjScaleAtNatOriginGeoKey;
01855         psDefn-&gt;ProjParm[4] = 0.9996;
01856         
01857         psDefn-&gt;ProjParmId[5] = ProjFalseEastingGeoKey;
01858         psDefn-&gt;ProjParm[5] = 500000.0;
01859         
01860         psDefn-&gt;ProjParmId[6] = ProjFalseNorthingGeoKey;
01861 
01862         <font class="keywordflow">if</font>( psDefn-&gt;MapSys == MapSys_UTM_North )
01863             psDefn-&gt;ProjParm[6] = 0.0;
01864         <font class="keywordflow">else</font>
01865             psDefn-&gt;ProjParm[6] = 10000000.0;
01866     }
01867 
01868 <font class="comment">/* -------------------------------------------------------------------- */</font>
01869 <font class="comment">/*      For now we forceable deaccess all CSV files to reduce the       */</font>
01870 <font class="comment">/*      chance of "leakage".  Really, this should be application        */</font>
01871 <font class="comment">/*      controlled.                                                     */</font>
01872 <font class="comment">/* -------------------------------------------------------------------- */</font>
01873     CSVDeaccess( NULL );
01874 
01875     <font class="keywordflow">return</font> TRUE;
01876 }
01877 
01878 <font class="comment">/************************************************************************/</font>
01879 <font class="comment">/*                            GTIFDecToDMS()                            */</font>
01880 <font class="comment">/*                                                                      */</font>
01881 <font class="comment">/*      Convenient function to translate decimal degrees to DMS         */</font>
01882 <font class="comment">/*      format for reporting to a user.                                 */</font>
01883 <font class="comment">/************************************************************************/</font>
01884 
01885 <font class="keyword">const</font> <font class="keywordtype">char</font> *GTIFDecToDMS( <font class="keywordtype">double</font> dfAngle, <font class="keyword">const</font> <font class="keywordtype">char</font> * pszAxis,
01886                           <font class="keywordtype">int</font> nPrecision )<font class="keyword"></font>
01887 <font class="keyword"></font>
01888 <font class="keyword"></font>{
01889     <font class="keywordtype">int</font>         nDegrees, nMinutes;
01890     <font class="keywordtype">double</font>      dfSeconds;
01891     <font class="keywordtype">char</font>        szFormat[30];
01892     <font class="keyword">static</font> <font class="keywordtype">char</font> szBuffer[50];
01893     <font class="keyword">const</font> <font class="keywordtype">char</font>  *pszHemisphere = NULL;
01894     <font class="keywordtype">double</font>      dfRound;
01895     <font class="keywordtype">int</font>         i;
01896 
01897     dfRound = 0.5/60;
01898     <font class="keywordflow">for</font>( i = 0; i &lt; nPrecision; i++ )
01899         dfRound = dfRound * 0.1;
01900 
01901     nDegrees = (<font class="keywordtype">int</font>) ABS(dfAngle);
01902     nMinutes = (<font class="keywordtype">int</font>) ((ABS(dfAngle) - nDegrees) * 60 + dfRound);
01903     dfSeconds = ABS((ABS(dfAngle) * 3600 - nDegrees*3600 - nMinutes*60));
01904 
01905     <font class="keywordflow">if</font>( EQUAL(pszAxis,<font class="stringliteral">"Long"</font>) &amp;&amp; dfAngle &lt; 0.0 )
01906         pszHemisphere = <font class="stringliteral">"W"</font>;
01907     <font class="keywordflow">else</font> <font class="keywordflow">if</font>( EQUAL(pszAxis,<font class="stringliteral">"Long"</font>) )
01908         pszHemisphere = <font class="stringliteral">"E"</font>;
01909     <font class="keywordflow">else</font> <font class="keywordflow">if</font>( dfAngle &lt; 0.0 )
01910         pszHemisphere = <font class="stringliteral">"S"</font>;
01911     <font class="keywordflow">else</font>
01912         pszHemisphere = <font class="stringliteral">"N"</font>;
01913 
01914     sprintf( szFormat, <font class="stringliteral">"%%3dd%%2d\'%%%d.%df\"%s"</font>,
01915              nPrecision+3, nPrecision, pszHemisphere );
01916     sprintf( szBuffer, szFormat, nDegrees, nMinutes, dfSeconds );
01917 
01918     <font class="keywordflow">return</font>( szBuffer );
01919 }
01920 
01921 <font class="comment">/************************************************************************/</font>
01922 <font class="comment">/*                           GTIFPrintDefn()                            */</font>
01923 <font class="comment">/*                                                                      */</font>
01924 <font class="comment">/*      Report the contents of a GTIFDefn structure ... mostly for      */</font>
01925 <font class="comment">/*      debugging.                                                      */</font>
01926 <font class="comment">/************************************************************************/</font>
01927 
01928 <font class="keywordtype">void</font> GTIFPrintDefn( <a class="code" href="struct_GTIFDefn.html">GTIFDefn</a> * psDefn, FILE * fp )<font class="keyword"></font>
01929 <font class="keyword"></font>
01930 <font class="keyword"></font>{
01931 <font class="comment">/* -------------------------------------------------------------------- */</font>
01932 <font class="comment">/*      Get the PCS name if possible.                                   */</font>
01933 <font class="comment">/* -------------------------------------------------------------------- */</font>
01934     <font class="keywordflow">if</font>( psDefn-&gt;PCS != KvUserDefined )
01935     {
01936         <font class="keywordtype">char</font>    *pszPCSName = CPLStrdup(<font class="stringliteral">"name unknown"</font>);
01937     
01938         GTIFGetPCSInfo( psDefn-&gt;PCS, &amp;pszPCSName, NULL, NULL, NULL, NULL );
01939         fprintf( fp, <font class="stringliteral">"PCS = %d (%s)\n"</font>, psDefn-&gt;PCS, pszPCSName );
01940         CPLFree( pszPCSName );
01941     }
01942 
01943 <font class="comment">/* -------------------------------------------------------------------- */</font>
01944 <font class="comment">/*      Dump the projection code if possible.                           */</font>
01945 <font class="comment">/* -------------------------------------------------------------------- */</font>
01946     <font class="keywordflow">if</font>( psDefn-&gt;ProjCode != KvUserDefined )
01947     {
01948         <font class="keywordtype">char</font>    *pszTRFName = CPLStrdup(<font class="stringliteral">""</font>);
01949 
01950         GTIFGetProjTRFInfo( psDefn-&gt;ProjCode, &amp;pszTRFName, NULL, NULL );
01951         fprintf( fp, <font class="stringliteral">"Projection = %d (%s)\n"</font>,
01952                  psDefn-&gt;ProjCode, pszTRFName );
01953 
01954         CPLFree( pszTRFName );
01955     }
01956 
01957 <font class="comment">/* -------------------------------------------------------------------- */</font>
01958 <font class="comment">/*      Try to dump the projection method name, and parameters if possible.*/</font>
01959 <font class="comment">/* -------------------------------------------------------------------- */</font>
01960     <font class="keywordflow">if</font>( psDefn-&gt;CTProjection != KvUserDefined )
01961     {
01962         <font class="keywordtype">char</font>    *pszName = GTIFValueName(ProjCoordTransGeoKey,
01963                                          psDefn-&gt;CTProjection);
01964         <font class="keywordtype">int</font>     i;
01965 
01966         <font class="keywordflow">if</font>( pszName == NULL )
01967             pszName = <font class="stringliteral">"(unknown)"</font>;
01968             
01969         fprintf( fp, <font class="stringliteral">"Projection Method: %s\n"</font>, pszName );
01970 
01971         <font class="keywordflow">for</font>( i = 0; i &lt; psDefn-&gt;nParms; i++ )
01972         {
01973             <font class="keywordflow">if</font>( psDefn-&gt;ProjParmId[i] == 0 )
01974                 <font class="keywordflow">continue</font>;
01975 
01976             pszName = GTIFKeyName((geokey_t) psDefn-&gt;ProjParmId[i]);
01977             <font class="keywordflow">if</font>( pszName == NULL )
01978                 pszName = <font class="stringliteral">"(unknown)"</font>;
01979 
01980             <font class="keywordflow">if</font>( i &lt; 4 )
01981             {
01982                 <font class="keywordtype">char</font>    *pszAxisName;
01983                 
01984                 <font class="keywordflow">if</font>( strstr(pszName,<font class="stringliteral">"Long"</font>) != NULL )
01985                     pszAxisName = <font class="stringliteral">"Long"</font>;
01986                 <font class="keywordflow">else</font> <font class="keywordflow">if</font>( strstr(pszName,<font class="stringliteral">"Lat"</font>) != NULL )
01987                     pszAxisName = <font class="stringliteral">"Lat"</font>;
01988                 <font class="keywordflow">else</font>
01989                     pszAxisName = <font class="stringliteral">"?"</font>;
01990                 
01991                 fprintf( fp, <font class="stringliteral">"   %s: %f (%s)\n"</font>,
01992                          pszName, psDefn-&gt;ProjParm[i],
01993                          GTIFDecToDMS( psDefn-&gt;ProjParm[i], pszAxisName, 2 ) );
01994             }
01995             <font class="keywordflow">else</font> <font class="keywordflow">if</font>( i == 4 )
01996                 fprintf( fp, <font class="stringliteral">"   %s: %f\n"</font>, pszName, psDefn-&gt;ProjParm[i] );
01997             <font class="keywordflow">else</font>
01998                 fprintf( fp, <font class="stringliteral">"   %s: %f m\n"</font>, pszName, psDefn-&gt;ProjParm[i] );
01999         }
02000     }
02001 
02002 <font class="comment">/* -------------------------------------------------------------------- */</font>
02003 <font class="comment">/*      Report the GCS name, and number.                                */</font>
02004 <font class="comment">/* -------------------------------------------------------------------- */</font>
02005     <font class="keywordflow">if</font>( psDefn-&gt;GCS != KvUserDefined )
02006     {
02007         <font class="keywordtype">char</font>    *pszName = CPLStrdup(<font class="stringliteral">"(unknown)"</font>);
02008 
02009         GTIFGetGCSInfo( psDefn-&gt;GCS, &amp;pszName, NULL, NULL, NULL );
02010         fprintf( fp, <font class="stringliteral">"GCS: %d/%s\n"</font>, psDefn-&gt;GCS, pszName );
02011         CPLFree( pszName );
02012     }
02013 
02014 <font class="comment">/* -------------------------------------------------------------------- */</font>
02015 <font class="comment">/*      Report the datum name.                                          */</font>
02016 <font class="comment">/* -------------------------------------------------------------------- */</font>
02017     <font class="keywordflow">if</font>( psDefn-&gt;Datum != KvUserDefined )
02018     {
02019         <font class="keywordtype">char</font>    *pszName = CPLStrdup(<font class="stringliteral">"(unknown)"</font>);
02020 
02021         GTIFGetDatumInfo( psDefn-&gt;Datum, &amp;pszName, NULL );
02022         fprintf( fp, <font class="stringliteral">"Datum: %d/%s\n"</font>, psDefn-&gt;Datum, pszName );
02023         CPLFree( pszName );
02024     }
02025 
02026 <font class="comment">/* -------------------------------------------------------------------- */</font>
02027 <font class="comment">/*      Report the ellipsoid.                                           */</font>
02028 <font class="comment">/* -------------------------------------------------------------------- */</font>
02029     <font class="keywordflow">if</font>( psDefn-&gt;Ellipsoid != KvUserDefined )
02030     {
02031         <font class="keywordtype">char</font>    *pszName = CPLStrdup(<font class="stringliteral">"(unknown)"</font>);
02032 
02033         GTIFGetEllipsoidInfo( psDefn-&gt;Ellipsoid, &amp;pszName, NULL, NULL );
02034         fprintf( fp, <font class="stringliteral">"Ellipsoid: %d/%s (%.2f,%.2f)\n"</font>,
02035                  psDefn-&gt;Ellipsoid, pszName,
02036                  psDefn-&gt;SemiMajor, psDefn-&gt;SemiMinor );
02037         CPLFree( pszName );
02038     }
02039     
02040 <font class="comment">/* -------------------------------------------------------------------- */</font>
02041 <font class="comment">/*      Report the prime meridian.                                      */</font>
02042 <font class="comment">/* -------------------------------------------------------------------- */</font>
02043     <font class="keywordflow">if</font>( psDefn-&gt;PM != KvUserDefined )
02044     {
02045         <font class="keywordtype">char</font>    *pszName = CPLStrdup(<font class="stringliteral">"(unknown)"</font>);
02046 
02047         GTIFGetPMInfo( psDefn-&gt;PM, &amp;pszName, NULL );
02048         fprintf( fp, <font class="stringliteral">"Prime Meridian: %d/%s (%f/%s)\n"</font>,
02049                  psDefn-&gt;PM, pszName,
02050                  psDefn-&gt;PMLongToGreenwich,
02051                  GTIFDecToDMS( psDefn-&gt;PMLongToGreenwich, "Long", 2 ) );
02052         CPLFree( pszName );
02053     }
02054 
02055 <font class="comment">/* -------------------------------------------------------------------- */</font>
02056 <font class="comment">/*      Report the projection units of measure (currently just          */</font>
02057 <font class="comment">/*      linear).                                                        */</font>
02058 <font class="comment">/* -------------------------------------------------------------------- */</font>
02059     <font class="keywordflow">if</font>( psDefn-&gt;UOMLength != KvUserDefined )
02060     {
02061         <font class="keywordtype">char</font>    *pszName = CPLStrdup( <font class="stringliteral">"(unknown)"</font> );
02062 
02063         GTIFGetUOMLengthInfo( psDefn-&gt;UOMLength, &amp;pszName, NULL );
02064         fprintf( fp, <font class="stringliteral">"Projection Linear Units: %d/%s (%fm)\n"</font>,
02065                  psDefn-&gt;UOMLength, pszName, psDefn-&gt;UOMLengthInMeters );
02066         CPLFree( pszName );
02067     }
02068 }
02069 
</div></pre><hr><address><small>Generated at Sun Mar 4 23:32:44 2001 for libgeotiff by
<a href="http://www.stack.nl/~dimitri/doxygen/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.3-20001105 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2000</small></address>
</body>
</html>
