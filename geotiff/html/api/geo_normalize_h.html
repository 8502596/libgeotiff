<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta name="robots" content="noindex">
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>geo_normalize.h File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.2.3-20001105 on Sun Mar 4 22:25:49 2001 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>geo_normalize.h File Reference</h1><code>#include &lt;stdio.h&gt;</code><br>
<code>#include "<a class="el" href="geotiff_h-source.html">geotiff.h</a>"</code><br>

<p>
<a href="geo_normalize_h-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td colspan=2><br><h2>Compounds</h2></td></tr>
<tr><td nowrap align=right valign=top>struct &nbsp;</td><td valign=bottom><a class="el" href="struct_GTIFDefn.html">GTIFDefn</a></td></tr>
<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td nowrap align=right valign=top>int CPL_DLL&nbsp;</td><td valign=bottom><a class="el" href="geo_normalize_h.html#a14">GTIFGetDefn</a> ( GTIF *psGTIF, <a class="el" href="struct_GTIFDefn.html">GTIFDefn</a> * psDefn )</td></tr>
<tr><td nowrap align=right valign=top>int CPL_DLL&nbsp;</td><td valign=bottom><a class="el" href="geo_normalize_h.html#a21">GTIFPCSToMapSys</a> ( int PCSCode, int * pDatum, int * pZone )</td></tr>
<tr><td nowrap align=right valign=top>int CPL_DLL&nbsp;</td><td valign=bottom><a class="el" href="geo_normalize_h.html#a22">GTIFProjToMapSys</a> ( int ProjCode, int * pZone )</td></tr>
</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>

<p>
Include file for extended projection definition normalization api.
<p>
<hr><h2>Function Documentation</h2>
<a name="a14" doxytag="geo_normalize.h::GTIFGetDefn"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td nowrap valign="top"><b> 
int CPL_DLL GTIFGetDefn (
          </b></td>
          <td valign="bottom"><b>
GTIF * <em>psGTIF</em>, 
          </b></td>
        </tr>
        <tr>
          <td></td>
          <td><b>
<a class="el" href="struct_GTIFDefn.html">GTIFDefn</a> * <em>psDefn</em>&nbsp;)
          </b></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<dl compact><dt>
<b>Parameters: </b><dd>
<table border=0 cellspacing=2 cellpadding=0>
<tr><td valign=top><em>psGTIF</em>
&nbsp;</td><td>
 GeoTIFF information handle as returned by GTIFNew. </td></tr>
<tr><td valign=top><em>psDefn</em>
&nbsp;</td><td>
 Pointer to an existing <a class="el" href="struct_GTIFDefn.html">GTIFDefn</a> structure. This structure does not need to have been pre-initialized at all.
<p>
</td></tr>
</table>
</dl><dl compact><dt>
<b>Returns: </b><dd>
 TRUE if the function has been successful, otherwise FALSE.
<p>
</dl>This function reads the coordinate system definition from a GeoTIFF file, and <em>normalizes</em> it into a set of component information using  definitions from CSV (Comma Seperated Value ASCII) files derived from  EPSG tables. This function is intended to simplify correct support for reading files with defined PCS (Projected Coordinate System) codes that wouldn't otherwise be directly known by application software by reducing it to the underlying projection method, parameters, datum, ellipsoid,  prime meridian and units.
<p>

<p>
The application should pass a pointer to an existing uninitialized  <a class="el" href="struct_GTIFDefn.html">GTIFDefn</a> structure, and <a class="el" href="geo_normalize_h.html#a14">GTIFGetDefn</a>() will fill it in. The fuction  currently always returns TRUE but in the future will return FALSE if  CSV files are not found. In any event, all geokeys actually found in the file will be copied into the <a class="el" href="struct_GTIFDefn.html">GTIFDefn</a>. However, if the CSV files aren't found codes implied by other codes will not be set properly.
<p>

<p>
<a class="el" href="geo_normalize_h.html#a14">GTIFGetDefn</a>() will not generally work if the EPSG derived CSV files cannot be found. By default a modest attempt will be made to find them, but  in general it is necessary for the calling application to override the logic to find them. This can be done by calling the  <a class="el" href="geo_normalize_h.html">SetCSVFilenameHook</a>() function to override the search method based on application knowledge of where they are found.
<p>

<p>
The normalization methodology operates by fetching tags from the GeoTIFF file, and then setting all other tags implied by them in the structure. The implied relationships are worked out by reading definitions from the  various EPSG derived CSV tables.
<p>

<p>
For instance, if a PCS (ProjectedCSTypeGeoKey) is found in the GeoTIFF file this code is used to lookup a record in the <code>horiz_cs.csv</code> CSV file. For example given the PCS 26746 we can find the name (NAD27 / California zone VI), the GCS 4257 (NAD27), and the ProjectionCode 10406 (California CS27 zone VI). The GCS, and ProjectionCode can in turn be looked up in other tables until all the details of units, ellipsoid,  prime meridian, datum, projection (LambertConfConic_2SP) and projection parameters are established. A full listgeo dump of a file  for this result might look like the following, all based on a single PCS value:
<p>

<p>
<pre>
% listgeo -norm ~/data/geotiff/pci_eg/spaf27.tif
Geotiff_Information:
   Version: 1
   Key_Revision: 1.0
   Tagged_Information:
      ModelTiepointTag (2,3):
         0                0                0 
         1577139.71       634349.176       0 
      ModelPixelScaleTag (1,3):
         195.509321       198.32184        0 
      End_Of_Tags.
   Keyed_Information:
      GTModelTypeGeoKey (Short,1): ModelTypeProjected
      GTRasterTypeGeoKey (Short,1): RasterPixelIsArea
      ProjectedCSTypeGeoKey (Short,1): PCS_NAD27_California_VI
      End_Of_Keys.
   End_Of_Geotiff.

PCS = 26746 (NAD27 / California zone VI)
Projection = 10406 (California CS27 zone VI)
Projection Method: CT_LambertConfConic_2SP
   ProjStdParallel1GeoKey: 33.883333
   ProjStdParallel2GeoKey: 32.766667
   ProjFalseOriginLatGeoKey: 32.166667
   ProjFalseOriginLongGeoKey: -116.233333
   ProjFalseEastingGeoKey: 609601.219202
   ProjFalseNorthingGeoKey: 0.000000
GCS: 4267/NAD27
Datum: 6267/North American Datum 1927
Ellipsoid: 7008/Clarke 1866 (6378206.40,6356583.80)
Prime Meridian: 8901/Greenwich (0.000000)
Projection Linear Units: 9003/US survey foot (0.304801m)
</pre>
<p>
Note that <a class="el" href="geo_normalize_h.html#a14">GTIFGetDefn</a>() does not inspect or return the tiepoints and scale. This must be handled seperately as it normally would. It is intended to simplify capture and normalization of the coordinate system definition.  Note that <a class="el" href="geo_normalize_h.html#a14">GTIFGetDefn</a>() also does the following things:
<p>
<ol>
 <li> Convert all angular values to decimal degrees. <li> Convert all linear values to meters.  <li> Return the linear units and conversion to meters for the tiepoints and scale (though the tiepoints and scale remain in their native units).  <li> When reading projection parameters a variety of differences between different GeoTIFF generators are handled, and a normalized set of parameters for each projection are always returned. </ol>

<p>
Code fields in the <a class="el" href="struct_GTIFDefn.html">GTIFDefn</a> are filled with KvUserDefined if there is not value to assign. The parameter lists for each of the underlying projection transform methods can be found at the <a href="http://www.remotesensing.org/geotiff/proj_list">Projections</a> page. Note that nParms will be set based on the maximum parameter used. Some of the parameters may not be used in which case the <a class="el" href="struct_GTIFDefn.html#m18">GTIFDefn::ProjParmId</a>[] will be zero. This is done to retain correspondence to the EPSG parameter numbering scheme.
<p>

<p>
The  <a href="http://www.remotesensing.org/cgi-bin/cvsweb.cgi/~checkout~/osrs/geotiff/libgeotiff/geotiff_proj4.c">geotiff_proj4.c</a> module distributed with libgeotiff can  be used as an example of code that converts a <a class="el" href="struct_GTIFDefn.html">GTIFDefn</a> into another projection system.
<p>

<p>
<dl compact><dt>
<b>See also: </b><dd>
 <a class="el" href="geotiff_h.html#a24">GTIFKeySet</a>(), <a class="el" href="geo_normalize_h.html">SetCSVFilenameHook</a>() </dl>    </td>
  </tr>
</table>
<a name="a21" doxytag="geo_normalize.h::GTIFPCSToMapSys"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td nowrap valign="top"><b> 
int CPL_DLL GTIFPCSToMapSys (
          </b></td>
          <td valign="bottom"><b>
int <em>PCSCode</em>, 
          </b></td>
        </tr>
        <tr>
          <td></td>
          <td><b>
int * <em>pDatum</em>, 
          </b></td>
        </tr>
        <tr>
          <td></td>
          <td><b>
int * <em>pZone</em>&nbsp;)
          </b></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Translate a PCS_ code into a UTM or State Plane map system, a datum, and a zone if possible.<dl compact><dt>
<b>Parameters: </b><dd>
<table border=0 cellspacing=2 cellpadding=0>
<tr><td valign=top><em>PCSCode</em>
&nbsp;</td><td>
 The projection code (PCS_*) as would be stored in the ProjectedCSTypeGeoKey of a GeoTIFF file.</td></tr>
<tr><td valign=top><em>pDatum</em>
&nbsp;</td><td>
 Pointer to an integer into which the datum code (GCS_*) is put if the function succeeds.</td></tr>
<tr><td valign=top><em>pZone</em>
&nbsp;</td><td>
 Pointer to an integer into which the zone will be placed if the function is successful.
<p>
</td></tr>
</table>
</dl><dl compact><dt>
<b>Returns: </b><dd>
 Returns either MapSys_UTM_North, MapSys_UTM_South, MapSys_State_Plane_83, MapSys_State_Plane_27 or KvUserDefined. KvUserDefined indicates that the function failed to recognise the projection as UTM or State Plane.
<p>
</dl>The zone value is only set if the return code is other than KvUserDefined. For utm map system the returned zone will be between 1 and 60. For State Plane, the USGS state plane zone number is returned. For instance, Alabama East is zone 101.
<p>
The datum (really this is the GCS) is set to a GCS_ value such as GCS_NAD27.
<p>
This function is useful to recognise (most) UTM and State Plane coordinate systems, even if CSV files aren't available to translate them automatically. It is used as a fallback mechanism by <a class="el" href="geo_normalize_h.html#a14">GTIFGetDefn</a>() for normalization when CSV files aren't found.     </td>
  </tr>
</table>
<a name="a22" doxytag="geo_normalize.h::GTIFProjToMapSys"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td nowrap valign="top"><b> 
int CPL_DLL GTIFProjToMapSys (
          </b></td>
          <td valign="bottom"><b>
int <em>ProjCode</em>, 
          </b></td>
        </tr>
        <tr>
          <td></td>
          <td><b>
int * <em>pZone</em>&nbsp;)
          </b></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Translate a Proj_ code into a UTM or State Plane map system, and a zone if possible.<dl compact><dt>
<b>Parameters: </b><dd>
<table border=0 cellspacing=2 cellpadding=0>
<tr><td valign=top><em>ProjCode</em>
&nbsp;</td><td>
 The projection code (Proj_*) as would be stored in the ProjectionGeoKey of a GeoTIFF file. </td></tr>
<tr><td valign=top><em>pZone</em>
&nbsp;</td><td>
 Pointer to an integer into which the zone will be placed if the function is successful.
<p>
</td></tr>
</table>
</dl><dl compact><dt>
<b>Returns: </b><dd>
 Returns either MapSys_UTM_North, MapSys_UTM_South, MapSys_State_Plane_27, MapSys_State_Plane_83 or KvUserDefined. KvUserDefined indicates that the function failed to recognise the projection as UTM or State Plane.
<p>
</dl>The zone value is only set if the return code is other than KvUserDefined. For utm map system the returned zone will be between 1 and 60. For State Plane, the USGS state plane zone number is returned. For instance, Alabama East is zone 101.
<p>
This function is useful to recognise UTM and State Plane coordinate systems, and to extract zone numbers so the projections can be represented as UTM rather than as the underlying projection method such Transverse Mercator for instance.     </td>
  </tr>
</table>
<hr><address><small>Generated at Sun Mar 4 22:25:49 2001 for libgeotiff by
<a href="http://www.stack.nl/~dimitri/doxygen/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.3-20001105 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2000</small></address>
</body>
</html>
