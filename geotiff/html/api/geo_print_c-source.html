<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta name="robots" content="noindex">
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>geo_print.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.2.3-20001105 on Sun Mar 4 22:25:49 2001 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>geo_print.c</h1><div class="fragment"><pre>00001 <font class="comment">/**********************************************************************</font>
00002 <font class="comment"> *</font>
00003 <font class="comment"> *  geo_print.c  -- Key-dumping routines for GEOTIFF files.</font>
00004 <font class="comment"> *</font>
00005 <font class="comment"> *    Written By: Niles D. Ritter.</font>
00006 <font class="comment"> *</font>
00007 <font class="comment"> *  copyright (c) 1995   Niles D. Ritter</font>
00008 <font class="comment"> *</font>
00009 <font class="comment"> *  Permission granted to use this software, so long as this copyright</font>
00010 <font class="comment"> *  notice accompanies any products derived therefrom.</font>
00011 <font class="comment"> *</font>
00012 <font class="comment"> *  Revision History;</font>
00013 <font class="comment"> *</font>
00014 <font class="comment"> *    20 June,  1995      Niles D. Ritter      New</font>
00015 <font class="comment"> *     7 July,  1995      NDR                  Fix indexing</font>
00016 <font class="comment"> *    27 July,  1995      NDR                  Added Import utils</font>
00017 <font class="comment"> *    28 July,  1995      NDR                  Made parser more strict.</font>
00018 <font class="comment"> *    29  Sep,  1995      NDR                  Fixed matrix printing.</font>
00019 <font class="comment"> *</font>
00020 <font class="comment"> * $Log$
00020 <font class="comment"> * Revision 1.1  2001/03/05 03:34:00  warmerda
00020 <font class="comment"> * New
00020 <font class="comment"> *</font>
00021 <font class="comment"> * Revision 1.3  1999/05/04 03:14:35  warmerda</font>
00022 <font class="comment"> * avoid warnings</font>
00023 <font class="comment"> *</font>
00024 <font class="comment"> * Revision 1.2  1999/05/03 17:50:31  warmerda</font>
00025 <font class="comment"> * avoid warnings on IRIX</font>
00026 <font class="comment"> *</font>
00027 <font class="comment"> *</font>
00028 <font class="comment"> **********************************************************************/</font>
00029 
00030 <font class="preprocessor">#include "<a class="code" href="geotiff_h.html">geotiff.h</a>"</font>   <font class="comment">/* public interface        */</font>
00031 <font class="preprocessor">#include "geo_tiffp.h"</font> <font class="comment">/* external TIFF interface */</font>
00032 <font class="preprocessor">#include "geo_keyp.h"</font>  <font class="comment">/* private interface       */</font>
00033 <font class="preprocessor">#include "geokeys.h"</font>
00034 
00035 <font class="preprocessor">#include &lt;stdio.h&gt;</font>     <font class="comment">/* for sprintf             */</font>
00036 
00037 <font class="preprocessor">#define FMT_GEOTIFF "Geotiff_Information:"</font>
00038 <font class="preprocessor"></font><font class="preprocessor">#define FMT_VERSION "Version: %hd"</font>
00039 <font class="preprocessor"></font><font class="preprocessor">#define FMT_REV     "Key_Revision: %1hd.%hd"</font>
00040 <font class="preprocessor"></font><font class="preprocessor">#define FMT_TAGS    "Tagged_Information:"</font>
00041 <font class="preprocessor"></font><font class="preprocessor">#define FMT_TAGEND  "End_Of_Tags."</font>
00042 <font class="preprocessor"></font><font class="preprocessor">#define FMT_KEYS    "Keyed_Information:"</font>
00043 <font class="preprocessor"></font><font class="preprocessor">#define FMT_KEYEND  "End_Of_Keys."</font>
00044 <font class="preprocessor"></font><font class="preprocessor">#define FMT_GEOEND  "End_Of_Geotiff."</font>
00045 <font class="preprocessor"></font><font class="preprocessor">#define FMT_DOUBLE  "%-17.9g"</font>
00046 <font class="preprocessor"></font><font class="preprocessor">#define FMT_SHORT   "%-11hd"</font>
00047 <font class="preprocessor"></font>
00048 <font class="keyword">static</font> <font class="keywordtype">void</font> DefaultPrint(<font class="keywordtype">char</font> *string, <font class="keywordtype">void</font> *aux);
00049 <font class="keyword">static</font> <font class="keywordtype">void</font> PrintKey(GeoKey *key, GTIFPrintMethod print,<font class="keywordtype">void</font> *aux);
00050 <font class="keyword">static</font> <font class="keywordtype">void</font> PrintGeoTags(GTIF *gtif,GTIFReadMethod scan,<font class="keywordtype">void</font> *aux);
00051 <font class="keyword">static</font> <font class="keywordtype">void</font> PrintTag(<font class="keywordtype">int</font> tag, <font class="keywordtype">int</font> nrows, <font class="keywordtype">double</font> *data, <font class="keywordtype">int</font> ncols, 
00052                                         GTIFPrintMethod print,<font class="keywordtype">void</font> *aux);
00053 <font class="keyword">static</font> <font class="keywordtype">void</font> DefaultRead(<font class="keywordtype">char</font> *string, <font class="keywordtype">void</font> *aux);
00054 <font class="keyword">static</font> <font class="keywordtype">int</font>  ReadKey(GTIF *gt, GTIFReadMethod scan, <font class="keywordtype">void</font> *aux);
00055 <font class="keyword">static</font> <font class="keywordtype">int</font>  ReadTag(GTIF *gt,GTIFReadMethod scan,<font class="keywordtype">void</font> *aux);
00056 <font class="keyword">static</font> <font class="keywordtype">char</font> message[1024];
00057 
00058 <font class="comment">/*</font>
00059 <font class="comment"> * Print off the directory info, using whatever method is specified</font>
00060 <font class="comment"> * (defaults to fprintf if null). The "aux" parameter is provided for user</font>
00061 <font class="comment"> * defined method for passing parameters or whatever.</font>
00062 <font class="comment"> *</font>
00063 <font class="comment"> * The output format is a "GeoTIFF meta-data" file, which may be</font>
00064 <font class="comment"> * used to import information with the GTIFFImport() routine.</font>
00065 <font class="comment"> */</font>
00066  
00067 <font class="keywordtype">void</font> GTIFPrint(GTIF *gtif, GTIFPrintMethod print,<font class="keywordtype">void</font> *aux)<font class="keyword"></font>
00068 <font class="keyword"></font>{
00069     <font class="keywordtype">int</font> i;
00070     <font class="keywordtype">int</font> numkeys = gtif-&gt;gt_num_keys;
00071     GeoKey *key = gtif-&gt;gt_keys;
00072         
00073     <font class="keywordflow">if</font> (!print) print = (GTIFPrintMethod) &amp;DefaultPrint;
00074     <font class="keywordflow">if</font> (!aux) aux=stdout;       
00075 
00076     sprintf(message,FMT_GEOTIFF <font class="stringliteral">"\n"</font>); 
00077     print(message,aux);
00078     sprintf(message, <font class="stringliteral">"Version: %hd"</font> ,gtif-&gt;gt_version);
00079     sprintf(message, FMT_VERSION,gtif-&gt;gt_version);
00080     print(<font class="stringliteral">"   "</font>,aux); print(message,aux); print(<font class="stringliteral">"\n"</font>,aux);
00081     sprintf(message, FMT_REV,gtif-&gt;gt_rev_major,
00082             gtif-&gt;gt_rev_minor); 
00083     print(<font class="stringliteral">"   "</font>,aux); print(message,aux); print(<font class="stringliteral">"\n"</font>,aux);
00084 
00085     sprintf(message,<font class="stringliteral">"   %s\n"</font>,FMT_TAGS); print(message,aux);
00086     PrintGeoTags(gtif,print,aux);
00087     sprintf(message,<font class="stringliteral">"      %s\n"</font>,FMT_TAGEND); print(message,aux);
00088 
00089     sprintf(message,<font class="stringliteral">"   %s\n"</font>,FMT_KEYS); print(message,aux);
00090     <font class="keywordflow">for</font> (i=0; i&lt;numkeys; i++)
00091         PrintKey(++key,print,aux);
00092     sprintf(message,<font class="stringliteral">"      %s\n"</font>,FMT_KEYEND); print(message,aux);
00093 
00094     sprintf(message,<font class="stringliteral">"   %s\n"</font>,FMT_GEOEND); print(message,aux);
00095 }
00096 
00097 <font class="keyword">static</font> <font class="keywordtype">void</font> PrintGeoTags(GTIF *gt, GTIFPrintMethod print,<font class="keywordtype">void</font> *aux)<font class="keyword"></font>
00098 <font class="keyword"></font>{
00099         <font class="keywordtype">double</font> *data;
00100         <font class="keywordtype">int</font> count;
00101         tiff_t *tif=gt-&gt;gt_tif;
00102 
00103         <font class="keywordflow">if</font> ((gt-&gt;gt_methods.get)(tif, GTIFF_TIEPOINTS, &amp;count, &amp;data ))
00104                 PrintTag(GTIFF_TIEPOINTS,count/3, data, 3, print, aux);
00105         <font class="keywordflow">if</font> ((gt-&gt;gt_methods.get)(tif, GTIFF_PIXELSCALE, &amp;count, &amp;data ))
00106                 PrintTag(GTIFF_PIXELSCALE,count/3, data, 3, print, aux);
00107         <font class="keywordflow">if</font> ((gt-&gt;gt_methods.get)(tif, GTIFF_TRANSMATRIX, &amp;count, &amp;data ))
00108                 PrintTag(GTIFF_TRANSMATRIX,count/4, data, 4, print, aux);
00109 }
00110 
00111 <font class="keyword">static</font> <font class="keywordtype">void</font> PrintTag(<font class="keywordtype">int</font> tag, <font class="keywordtype">int</font> nrows, <font class="keywordtype">double</font> *dptr, <font class="keywordtype">int</font> ncols, 
00112                                         GTIFPrintMethod print,<font class="keywordtype">void</font> *aux)<font class="keyword"></font>
00113 <font class="keyword"></font>{
00114         <font class="keywordtype">int</font> i,j;
00115         <font class="keywordtype">double</font> *data=dptr;
00116 
00117         print(<font class="stringliteral">"      "</font>,aux);
00118         print(GTIFTagName(tag),aux);
00119         sprintf(message,<font class="stringliteral">" (%d,%d):\n"</font>,nrows,ncols);
00120         print(message,aux);
00121         <font class="keywordflow">for</font> (i=0;i&lt;nrows;i++)
00122         {
00123                 print(<font class="stringliteral">"         "</font>,aux);
00124                 <font class="keywordflow">for</font> (j=0;j&lt;ncols;j++)
00125                 {
00126                         sprintf(message,FMT_DOUBLE,*data++);
00127                         print(message,aux);
00128                 }
00129                 print(<font class="stringliteral">"\n"</font>,aux);
00130         }
00131         _GTIFFree(dptr); <font class="comment">/* free up the allocated memory */</font>
00132 }
00133 
00134 
00135 <font class="keyword">static</font> <font class="keywordtype">void</font> PrintKey(GeoKey *key, GTIFPrintMethod print, <font class="keywordtype">void</font> *aux)<font class="keyword"></font>
00136 <font class="keyword"></font>{
00137     <font class="keywordtype">char</font> *data;
00138     geokey_t keyid = (geokey_t) key-&gt;gk_key;
00139     <font class="keywordtype">int</font> count = key-&gt;gk_count;
00140     <font class="keywordtype">int</font> vals_now,i;
00141     pinfo_t *sptr;
00142     <font class="keywordtype">double</font> *dptr;
00143 
00144 
00145     print(<font class="stringliteral">"      "</font>,aux);
00146     print(GTIFKeyName(keyid),aux);
00147         
00148     sprintf(message,<font class="stringliteral">" (%s,%d): "</font>,GTIFTypeName(key-&gt;gk_type),count);
00149     print(message,aux);
00150         
00151     <font class="keywordflow">if</font> (key-&gt;gk_type==TYPE_SHORT &amp;&amp; count==1)
00152         data = (<font class="keywordtype">char</font> *)&amp;key-&gt;gk_data;
00153     <font class="keywordflow">else</font>
00154         data = key-&gt;gk_data;
00155                 
00156     <font class="keywordflow">switch</font> (key-&gt;gk_type)
00157     {
00158       <font class="keywordflow">case</font> TYPE_ASCII: 
00159         print(<font class="stringliteral">"\""</font>,aux);
00160         _GTIFmemcpy(message,data,count);
00161         message[count-1]=<font class="charliteral">'\0'</font>;
00162         print(message,aux);
00163         print(<font class="stringliteral">"\"\n"</font>,aux);
00164         <font class="keywordflow">break</font>;
00165         
00166       <font class="keywordflow">case</font> TYPE_DOUBLE: 
00167         <font class="keywordflow">for</font> (dptr = (<font class="keywordtype">double</font> *)data; count &gt; 0; count-= vals_now)
00168         {
00169             vals_now = count &gt; 3? 3: count;
00170             <font class="keywordflow">for</font> (i=0; i&lt;vals_now; i++,dptr++)
00171             {
00172                 sprintf(message,FMT_DOUBLE ,*dptr);
00173                 print(message,aux);
00174             }
00175             print(<font class="stringliteral">"\n"</font>,aux);
00176         }
00177         <font class="keywordflow">break</font>;
00178         
00179       <font class="keywordflow">case</font> TYPE_SHORT: 
00180         sptr = (pinfo_t *)data;
00181         <font class="keywordflow">if</font> (count==1)
00182         {
00183             sprintf(message,<font class="stringliteral">"%s\n"</font>,GTIFValueName(keyid,*sptr));
00184             print(message,aux);
00185         }
00186         <font class="keywordflow">else</font>
00187             <font class="keywordflow">for</font> (; count &gt; 0; count-= vals_now)
00188             {
00189                 vals_now = count &gt; 3? 3: count;
00190                 <font class="keywordflow">for</font> (i=0; i&lt;vals_now; i++,sptr++)
00191                 {
00192                     sprintf(message,FMT_SHORT,*sptr);
00193                     print(message,aux);
00194                 }
00195                 print(<font class="stringliteral">"\n"</font>,aux);
00196             }
00197         <font class="keywordflow">break</font>;
00198         
00199       <font class="keywordflow">default</font>: 
00200         sprintf(message, <font class="stringliteral">"Unknown Type (%d)\n"</font>,key-&gt;gk_type);
00201         print(message,aux);
00202         <font class="keywordflow">break</font>;
00203     }
00204 }
00205 
00206 <font class="keyword">static</font> <font class="keywordtype">void</font> DefaultPrint(<font class="keywordtype">char</font> *string, <font class="keywordtype">void</font> *aux)<font class="keyword"></font>
00207 <font class="keyword"></font>{
00208     <font class="comment">/* Pretty boring */</font>
00209     fprintf((FILE *)aux,string);
00210 }
00211 
00212 
00213 <font class="comment">/*</font>
00214 <font class="comment"> *  Importing metadata file</font>
00215 <font class="comment"> */</font>
00216 
00217 <font class="comment">/*</font>
00218 <font class="comment"> * Import the directory info, using whatever method is specified</font>
00219 <font class="comment"> * (defaults to fscanf if null). The "aux" parameter is provided for user</font>
00220 <font class="comment"> * defined method for passing file or whatever.</font>
00221 <font class="comment"> *</font>
00222 <font class="comment"> * The input format is a "GeoTIFF meta-data" file, which may be</font>
00223 <font class="comment"> * generated by the GTIFFPrint() routine.</font>
00224 <font class="comment"> */</font>
00225  
00226 <font class="keywordtype">int</font> GTIFImport(GTIF *gtif, GTIFReadMethod scan,<font class="keywordtype">void</font> *aux)<font class="keyword"></font>
00227 <font class="keyword"></font>{
00228     <font class="keywordtype">int</font> status;
00229         
00230     <font class="keywordflow">if</font> (!scan) scan = (GTIFReadMethod) &amp;DefaultRead;
00231     <font class="keywordflow">if</font> (!aux) aux=stdin;        
00232         
00233     scan(message,aux);
00234     <font class="keywordflow">if</font> (strncmp(message,FMT_GEOTIFF,8)) <font class="keywordflow">return</font> 0; 
00235     scan(message,aux);
00236     <font class="keywordflow">if</font> (!sscanf(message,FMT_VERSION,&amp;gtif-&gt;gt_version)) <font class="keywordflow">return</font> 0;
00237     scan(message,aux);
00238     <font class="keywordflow">if</font> (sscanf(message,FMT_REV,&amp;gtif-&gt;gt_rev_major,
00239                &amp;gtif-&gt;gt_rev_minor) !=2) <font class="keywordflow">return</font> 0;
00240 
00241     scan(message,aux);
00242     <font class="keywordflow">if</font> (strncmp(message,FMT_TAGS,8)) <font class="keywordflow">return</font> 0;
00243     <font class="keywordflow">while</font> ((status=ReadTag(gtif,scan,aux))&gt;0);
00244     <font class="keywordflow">if</font> (status &lt; 0) <font class="keywordflow">return</font> 0;
00245 
00246     scan(message,aux);
00247     <font class="keywordflow">if</font> (strncmp(message,FMT_KEYS,8)) <font class="keywordflow">return</font> 0;
00248     <font class="keywordflow">while</font> ((status=ReadKey(gtif,scan,aux))&gt;0);
00249         
00250     <font class="keywordflow">return</font> (status==0); <font class="comment">/* success */</font>
00251 }
00252 
00253 <font class="keyword">static</font> <font class="keywordtype">int</font> StringError(<font class="keywordtype">char</font> *string)<font class="keyword"></font>
00254 <font class="keyword"></font>{
00255         fprintf(stderr,<font class="stringliteral">"Parsing Error at \'%s\'\n"</font>,string);
00256         <font class="keywordflow">return</font> -1;
00257 }
00258 
00259 <font class="preprocessor">#define SKIPWHITE(vptr) \</font>
00260 <font class="preprocessor">  while (*vptr &amp;&amp; (*vptr==' '||*vptr=='\t')) vptr++</font>
00261 <font class="preprocessor"></font><font class="preprocessor">#define FINDCHAR(vptr,c) \</font>
00262 <font class="preprocessor">  while (*vptr &amp;&amp; *vptr!=(c)) vptr++</font>
00263 <font class="preprocessor"></font>
00264 <font class="keyword">static</font> <font class="keywordtype">int</font> ReadTag(GTIF *gt,GTIFReadMethod scan,<font class="keywordtype">void</font> *aux)<font class="keyword"></font>
00265 <font class="keyword"></font>{
00266     <font class="keywordtype">int</font> i,j,tag;
00267     <font class="keywordtype">char</font> *vptr;
00268     <font class="keywordtype">char</font> tagname[100];
00269     <font class="keywordtype">double</font> data[100],*dptr=data;
00270     <font class="keywordtype">int</font> count,nrows,ncols,num;
00271 
00272     scan(message,aux);
00273     <font class="keywordflow">if</font> (!strncmp(message,FMT_TAGEND,8)) <font class="keywordflow">return</font> 0;
00274 
00275     num=sscanf(message,<font class="stringliteral">"%[^( ] (%d,%d):\n"</font>,tagname,&amp;nrows,&amp;ncols);
00276     <font class="keywordflow">if</font> (num!=3) <font class="keywordflow">return</font> StringError(message);
00277         
00278     tag = GTIFTagCode(tagname);
00279     <font class="keywordflow">if</font> (tag &lt; 0) <font class="keywordflow">return</font> StringError(tagname);
00280         
00281     count = nrows*ncols;
00282     <font class="keywordflow">for</font> (i=0;i&lt;nrows;i++)
00283     {
00284         scan(message,aux);
00285         vptr = message;
00286         <font class="keywordflow">for</font> (j=0;j&lt;ncols;j++)
00287         {
00288             <font class="keywordflow">if</font> (!sscanf(vptr,<font class="stringliteral">"%lg"</font>,dptr++))
00289                 <font class="keywordflow">return</font> StringError(vptr);
00290             FINDCHAR(vptr,<font class="charliteral">' '</font>);
00291             SKIPWHITE(vptr);
00292         }
00293     }   
00294     (gt-&gt;gt_methods.set)(gt-&gt;gt_tif, tag, count, data );        
00295 
00296     <font class="keywordflow">return</font> 1;
00297 }
00298 
00299 
00300 <font class="keyword">static</font> <font class="keywordtype">int</font> ReadKey(GTIF *gt, GTIFReadMethod scan, <font class="keywordtype">void</font> *aux)<font class="keyword"></font>
00301 <font class="keyword"></font>{
00302     tagtype_t ktype;
00303     <font class="keywordtype">int</font> count,outcount;
00304     <font class="keywordtype">int</font> vals_now,i;
00305     geokey_t key;
00306     <font class="keywordtype">int</font> icode;
00307     pinfo_t code;
00308     <font class="keywordtype">short</font>  *sptr;
00309     <font class="keywordtype">char</font> name[1000];
00310     <font class="keywordtype">char</font> type[20];
00311     <font class="keywordtype">double</font> data[100];
00312     <font class="keywordtype">double</font> *dptr;
00313     <font class="keywordtype">char</font> *cdata = (<font class="keywordtype">char</font> *)data;
00314     <font class="keywordtype">char</font> *vptr;
00315     <font class="keywordtype">int</font> num;
00316 
00317     scan(message,aux); 
00318     <font class="keywordflow">if</font> (!strncmp(message,FMT_KEYEND,8)) <font class="keywordflow">return</font> 0;
00319 
00320     num=sscanf(message,<font class="stringliteral">"%[^( ] (%[^,],%d):\n"</font>,name,type,&amp;count);
00321     <font class="keywordflow">if</font> (num!=3) <font class="keywordflow">return</font> StringError(message);
00322 
00323     vptr = message;
00324     FINDCHAR(vptr,<font class="charliteral">':'</font>); 
00325     <font class="keywordflow">if</font> (!*vptr) <font class="keywordflow">return</font> StringError(message);
00326     vptr+=2;
00327 
00328     <font class="keywordflow">if</font>( GTIFKeyCode(name) &lt; 0 )
00329         <font class="keywordflow">return</font> StringError(name);
00330     <font class="keywordflow">else</font>
00331         key = (geokey_t) GTIFKeyCode(name);
00332 
00333     <font class="keywordflow">if</font>( GTIFTypeCode(type) &lt; 0 )
00334         <font class="keywordflow">return</font> StringError(type);
00335     <font class="keywordflow">else</font>
00336         ktype = (tagtype_t) GTIFTypeCode(type);
00337 
00338     <font class="comment">/* skip white space */</font>
00339     SKIPWHITE(vptr);
00340     <font class="keywordflow">if</font> (!*vptr) <font class="keywordflow">return</font> StringError(message);
00341                         
00342     <font class="keywordflow">switch</font> (ktype)
00343     {
00344       <font class="keywordflow">case</font> TYPE_ASCII: 
00345         FINDCHAR(vptr,<font class="charliteral">'"'</font>);
00346         <font class="keywordflow">if</font> (!*vptr) <font class="keywordflow">return</font> StringError(message);
00347         _GTIFmemcpy(cdata,vptr+1,count);
00348         cdata[count-1]=<font class="charliteral">'\0'</font>;
00349         <a class="code" href="geotiff_h.html#a24">GTIFKeySet</a>(gt,key,ktype,count,cdata);
00350         <font class="keywordflow">break</font>;
00351         
00352       <font class="keywordflow">case</font> TYPE_DOUBLE: 
00353         outcount = count;
00354         <font class="keywordflow">for</font> (dptr = data; count &gt; 0; count-= vals_now)
00355         {
00356             vals_now = count &gt; 3? 3: count;
00357             <font class="keywordflow">for</font> (i=0; i&lt;vals_now; i++,dptr++)
00358             {
00359                 <font class="keywordflow">if</font> (!sscanf(vptr,<font class="stringliteral">"%lg"</font> ,dptr))
00360                     StringError(vptr);
00361                 FINDCHAR(vptr,<font class="charliteral">' '</font>);
00362                 SKIPWHITE(vptr);
00363             }
00364             <font class="keywordflow">if</font> (vals_now&lt;count)
00365             {
00366                 scan(message,aux);
00367                 vptr = message;
00368             }
00369         }
00370         <font class="keywordflow">if</font> (outcount==1)
00371             <a class="code" href="geotiff_h.html#a24">GTIFKeySet</a>(gt,key,ktype,outcount,data[0]);
00372         <font class="keywordflow">else</font>
00373             <a class="code" href="geotiff_h.html#a24">GTIFKeySet</a>(gt,key,ktype,outcount,data);
00374         <font class="keywordflow">break</font>;
00375         
00376       <font class="keywordflow">case</font> TYPE_SHORT: 
00377         <font class="keywordflow">if</font> (count==1)
00378         {
00379             icode = GTIFValueCode(key,vptr);
00380             <font class="keywordflow">if</font> (icode &lt; 0) <font class="keywordflow">return</font> StringError(vptr);
00381             code = icode;
00382             <a class="code" href="geotiff_h.html#a24">GTIFKeySet</a>(gt,key,ktype,count,code);
00383         }
00384         <font class="keywordflow">else</font>  <font class="comment">/* multi-valued short - no such thing yet */</font>
00385         {
00386             sptr = (<font class="keywordtype">short</font> *)data;
00387             outcount = count;
00388             <font class="keywordflow">for</font> (; count &gt; 0; count-= vals_now)
00389             {
00390                 vals_now = count &gt; 3? 3: count;
00391                 <font class="keywordflow">for</font> (i=0; i&lt;vals_now; i++,sptr++)
00392                 {
00393                     <font class="keywordtype">int</font>         work_int;
00394 
00395                     <font class="comment">/* note: FMT_SHORT (%11hd) not supported on IRIX */</font>
00396                     sscanf(message,<font class="stringliteral">"%11d"</font>,&amp;work_int);
00397                     *sptr = work_int;
00398                     scan(message,aux);
00399                 }
00400                 <font class="keywordflow">if</font> (vals_now&lt;count)
00401                 {
00402                     scan(message,aux);
00403                     vptr = message;
00404                 }
00405             }
00406             <a class="code" href="geotiff_h.html#a24">GTIFKeySet</a>(gt,key,ktype,outcount,sptr);                     
00407         }
00408         <font class="keywordflow">break</font>;
00409         
00410       <font class="keywordflow">default</font>: 
00411         <font class="keywordflow">return</font> -1;
00412     }
00413     <font class="keywordflow">return</font> 1;
00414 }
00415 
00416 
00417 <font class="keyword">static</font> <font class="keywordtype">void</font> DefaultRead(<font class="keywordtype">char</font> *string, <font class="keywordtype">void</font> *aux)<font class="keyword"></font>
00418 <font class="keyword"></font>{
00419         <font class="comment">/* Pretty boring */</font>
00420         fscanf((FILE *)aux,<font class="stringliteral">"%[^\n]\n"</font>,string);
00421 }
00422 
</div></pre><hr><address><small>Generated at Sun Mar 4 22:25:49 2001 for libgeotiff by
<a href="http://www.stack.nl/~dimitri/doxygen/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.3-20001105 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2000</small></address>
</body>
</html>
