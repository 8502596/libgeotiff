<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta name="robots" content="noindex">
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>geotiff_proj4.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.2.3-20001105 on Sun Mar 4 23:32:45 2001 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>geotiff_proj4.c</h1><div class="fragment"><pre>00001 <font class="comment">/******************************************************************************</font>
00002 <font class="comment"> * $Id$</font>
00003 <font class="comment"> *</font>
00004 <font class="comment"> * Project:  libgeotiff</font>
00005 <font class="comment"> * Purpose:  Code to convert a normalized GeoTIFF definition into a PROJ.4</font>
00006 <font class="comment"> *           (OGDI) compatible projection string.</font>
00007 <font class="comment"> * Author:   Frank Warmerdam, warmerda@home.com</font>
00008 <font class="comment"> *</font>
00009 <font class="comment"> ******************************************************************************</font>
00010 <font class="comment"> * Copyright (c) 1999, Frank Warmerdam</font>
00011 <font class="comment"> *</font>
00012 <font class="comment"> * Permission is hereby granted, free of charge, to any person obtaining a</font>
00013 <font class="comment"> * copy of this software and associated documentation files (the "Software"),</font>
00014 <font class="comment"> * to deal in the Software without restriction, including without limitation</font>
00015 <font class="comment"> * the rights to use, copy, modify, merge, publish, distribute, sublicense,</font>
00016 <font class="comment"> * and/or sell copies of the Software, and to permit persons to whom the</font>
00017 <font class="comment"> * Software is furnished to do so, subject to the following conditions:</font>
00018 <font class="comment"> *</font>
00019 <font class="comment"> * The above copyright notice and this permission notice shall be included</font>
00020 <font class="comment"> * in all copies or substantial portions of the Software.</font>
00021 <font class="comment"> *</font>
00022 <font class="comment"> * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS</font>
00023 <font class="comment"> * OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</font>
00024 <font class="comment"> * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL</font>
00025 <font class="comment"> * THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</font>
00026 <font class="comment"> * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING</font>
00027 <font class="comment"> * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER</font>
00028 <font class="comment"> * DEALINGS IN THE SOFTWARE.</font>
00029 <font class="comment"> ******************************************************************************</font>
00030 <font class="comment"> *</font>
00031 <font class="comment"> * $Log$
00031 <font class="comment"> * Revision 1.2  2001/03/05 04:58:33  warmerda
00031 <font class="comment"> * updated
00031 <font class="comment"> *</font>
00032 <font class="comment"> * Revision 1.16  2000/12/05 19:21:45  warmerda</font>
00033 <font class="comment"> * added cassini support</font>
00034 <font class="comment"> *</font>
00035 <font class="comment"> * Revision 1.15  2000/12/05 17:44:41  warmerda</font>
00036 <font class="comment"> * Use +R_A for Miller and VanDerGrinten</font>
00037 <font class="comment"> *</font>
00038 <font class="comment"> * Revision 1.14  2000/10/13 18:06:51  warmerda</font>
00039 <font class="comment"> * added econic support for PROJ.4 translation</font>
00040 <font class="comment"> *</font>
00041 <font class="comment"> * Revision 1.13  2000/09/15 19:30:48  warmerda</font>
00042 <font class="comment"> * *** empty log message ***</font>
00043 <font class="comment"> *</font>
00044 <font class="comment"> * Revision 1.12  2000/09/15 18:21:07  warmerda</font>
00045 <font class="comment"> * Fixed order of parameters for LCC 2SP.  When parameters</font>
00046 <font class="comment"> * were read from EPSG CSV files the standard parallels and origin</font>
00047 <font class="comment"> * were mixed up.  This affects alot of state plane zones!</font>
00048 <font class="comment"> *</font>
00049 <font class="comment"> * Revision 1.11  2000/06/06 17:39:45  warmerda</font>
00050 <font class="comment"> * Modify to work with projUV version of library.</font>
00051 <font class="comment"> *</font>
00052 <font class="comment"> * Revision 1.10  1999/07/06 15:05:51  warmerda</font>
00053 <font class="comment"> * Fixed up LCC_1SP notes.</font>
00054 <font class="comment"> *</font>
00055 <font class="comment"> * Revision 1.9  1999/05/04 16:24:49  warmerda</font>
00056 <font class="comment"> * Fixed projection string formating with zones.</font>
00057 <font class="comment"> *</font>
00058 <font class="comment"> * Revision 1.8  1999/05/04 12:27:01  geotiff</font>
00059 <font class="comment"> * only emit proj unsupported warning if DEBUG defined</font>
00060 <font class="comment"> *</font>
00061 <font class="comment"> * Revision 1.7  1999/05/04 03:14:59  warmerda</font>
00062 <font class="comment"> * fixed use of foot instead of ft for units</font>
00063 <font class="comment"> *</font>
00064 <font class="comment"> * Revision 1.6  1999/05/03 17:50:31  warmerda</font>
00065 <font class="comment"> * avoid warnings on IRIX</font>
00066 <font class="comment"> *</font>
00067 <font class="comment"> * Revision 1.5  1999/04/29 23:02:24  warmerda</font>
00068 <font class="comment"> * added mapsys utm test.</font>
00069 <font class="comment"> *</font>
00070 <font class="comment"> * Revision 1.4  1999/03/18 21:35:42  geotiff</font>
00071 <font class="comment"> * Added reprojection functions</font>
00072 <font class="comment"> *</font>
00073 <font class="comment"> * Revision 1.3  1999/03/10 18:11:17  geotiff</font>
00074 <font class="comment"> * Removed comment about this not being the master ... now it is.</font>
00075 <font class="comment"> *</font>
00076 <font class="comment"> * Revision 1.2  1999/03/10 18:10:27  geotiff</font>
00077 <font class="comment"> * Avoid use of cpl_serv.h and CPLStrdup().</font>
00078 <font class="comment"> *</font>
00079 <font class="comment"> * Revision 1.1  1999/03/10 15:20:43  geotiff</font>
00080 <font class="comment"> * New</font>
00081 <font class="comment"> *</font>
00082 <font class="comment"> */</font>
00083 
00084 <font class="preprocessor">#include "cpl_serv.h"</font>
00085 <font class="preprocessor">#include "<a class="code" href="geotiff_h.html">geotiff.h</a>"</font>
00086 <font class="preprocessor">#include "<a class="code" href="geo_normalize_h.html">geo_normalize.h</a>"</font>
00087 <font class="preprocessor">#include "geovalues.h"</font>
00088 
00089 <font class="comment">/************************************************************************/</font>
00090 <font class="comment">/*                          GTIFGetProj4Defn()                          */</font>
00091 <font class="comment">/************************************************************************/</font>
00092 
00093 <font class="keywordtype">char</font> * GTIFGetProj4Defn( <a class="code" href="struct_GTIFDefn.html">GTIFDefn</a> * psDefn )<font class="keyword"></font>
00094 <font class="keyword"></font>
00095 <font class="keyword"></font>{
00096     <font class="keywordtype">char</font>        szProjection[512];
00097     <font class="keywordtype">char</font>        szUnits[24];
00098     <font class="keywordtype">double</font>      dfFalseEasting, dfFalseNorthing;
00099 
00100     szProjection[0] = <font class="charliteral">'\0'</font>;
00101     
00102 <font class="comment">/* ==================================================================== */</font>
00103 <font class="comment">/*      Translate the units of measure.                                 */</font>
00104 <font class="comment">/*                                                                      */</font>
00105 <font class="comment">/*      Note that even with a +units, or +to_meter in effect, it is     */</font>
00106 <font class="comment">/*      still assumed that all the projection parameters are in         */</font>
00107 <font class="comment">/*      meters.                                                         */</font>
00108 <font class="comment">/* ==================================================================== */</font>
00109     <font class="keywordflow">if</font>( psDefn-&gt;UOMLength == Linear_Meter )
00110     {
00111         strcpy( szUnits, <font class="stringliteral">"+units=m "</font> ); 
00112     }
00113     <font class="keywordflow">else</font> <font class="keywordflow">if</font>( psDefn-&gt;UOMLength == Linear_Foot )
00114     {
00115         strcpy( szUnits, <font class="stringliteral">"+units=ft "</font> );
00116     }
00117     <font class="keywordflow">else</font> <font class="keywordflow">if</font>( psDefn-&gt;UOMLength == Linear_Foot_US_Survey )
00118     {
00119         strcpy( szUnits, <font class="stringliteral">"+units=us-ft "</font> );
00120     }
00121     <font class="keywordflow">else</font> <font class="keywordflow">if</font>( psDefn-&gt;UOMLength == Linear_Foot_Indian )
00122     {
00123         strcpy( szUnits, <font class="stringliteral">"+units=ind-ft "</font> );
00124     }
00125     <font class="keywordflow">else</font> <font class="keywordflow">if</font>( psDefn-&gt;UOMLength == Linear_Link )
00126     {
00127         strcpy( szUnits, <font class="stringliteral">"+units=link "</font> );
00128     }
00129     <font class="keywordflow">else</font> <font class="keywordflow">if</font>( psDefn-&gt;UOMLength == Linear_Yard_Indian)
00130     {
00131         strcpy( szUnits, <font class="stringliteral">"+units=ind-yd "</font> );
00132     }
00133     <font class="keywordflow">else</font> <font class="keywordflow">if</font>( psDefn-&gt;UOMLength == Linear_Fathom )
00134     {
00135         strcpy( szUnits, <font class="stringliteral">"+units=fath "</font> );
00136     }
00137     <font class="keywordflow">else</font> <font class="keywordflow">if</font>( psDefn-&gt;UOMLength == Linear_Mile_International_Nautical )
00138     {
00139         strcpy( szUnits, <font class="stringliteral">"+units=kmi "</font> );
00140     }
00141     <font class="keywordflow">else</font>
00142     {
00143         sprintf( szUnits, <font class="stringliteral">"+to_meter=%.10f"</font>, psDefn-&gt;UOMLengthInMeters );
00144     }
00145 
00146 <font class="comment">/* -------------------------------------------------------------------- */</font>
00147 <font class="comment">/*      false easting and northing are in meters and that is what       */</font>
00148 <font class="comment">/*      PROJ.4 wants regardless of the linear units.                    */</font>
00149 <font class="comment">/* -------------------------------------------------------------------- */</font>
00150     dfFalseEasting = psDefn-&gt;ProjParm[5];
00151     dfFalseNorthing = psDefn-&gt;ProjParm[6];
00152     
00153 <font class="comment">/* ==================================================================== */</font>
00154 <font class="comment">/*      Handle general projection methods.                              */</font>
00155 <font class="comment">/* ==================================================================== */</font>
00156 
00157 <font class="comment">/* -------------------------------------------------------------------- */</font>
00158 <font class="comment">/*      UTM - special case override on transverse mercator so things    */</font>
00159 <font class="comment">/*      will be more meaningful to the user.                            */</font>
00160 <font class="comment">/* -------------------------------------------------------------------- */</font>
00161     <font class="keywordflow">if</font>( psDefn-&gt;MapSys == MapSys_UTM_North )
00162     {
00163         sprintf( szProjection+strlen(szProjection),
00164                  <font class="stringliteral">"+proj=utm +zone=%d "</font>,
00165                  psDefn-&gt;Zone );
00166     }
00167     
00168 <font class="comment">/* -------------------------------------------------------------------- */</font>
00169 <font class="comment">/*      Transverse Mercator                                             */</font>
00170 <font class="comment">/* -------------------------------------------------------------------- */</font>
00171     <font class="keywordflow">else</font> <font class="keywordflow">if</font>( psDefn-&gt;CTProjection == CT_TransverseMercator )
00172     {
00173         sprintf( szProjection+strlen(szProjection),
00174            <font class="stringliteral">"+proj=tmerc +lat_0=%.9f +lon_0=%.9f +k=%f +x_0=%.3f +y_0=%.3f "</font>,
00175                  psDefn-&gt;ProjParm[0],
00176                  psDefn-&gt;ProjParm[1],
00177                  psDefn-&gt;ProjParm[4],
00178                  dfFalseEasting,
00179                  dfFalseNorthing );
00180     }
00181 
00182 <font class="comment">/* -------------------------------------------------------------------- */</font>
00183 <font class="comment">/*      Mercator                                                        */</font>
00184 <font class="comment">/* -------------------------------------------------------------------- */</font>
00185     <font class="keywordflow">else</font> <font class="keywordflow">if</font>( psDefn-&gt;CTProjection == CT_Mercator )
00186     {
00187         sprintf( szProjection+strlen(szProjection),
00188            <font class="stringliteral">"+proj=merc +lat_ts=%.9f +lon_0=%.9f +k=%f +x_0=%.3f +y_0=%.3f "</font>,
00189                  psDefn-&gt;ProjParm[0],
00190                  psDefn-&gt;ProjParm[1],
00191                  psDefn-&gt;ProjParm[4],
00192                  dfFalseEasting,
00193                  dfFalseNorthing );
00194     }
00195 
00196 <font class="comment">/* -------------------------------------------------------------------- */</font>
00197 <font class="comment">/*      Cassini/Soldner                                                 */</font>
00198 <font class="comment">/* -------------------------------------------------------------------- */</font>
00199     <font class="keywordflow">else</font> <font class="keywordflow">if</font>( psDefn-&gt;CTProjection == CT_CassiniSoldner )
00200     {
00201         sprintf( szProjection+strlen(szProjection),
00202                  <font class="stringliteral">"+proj=cass +lat_0=%.9f +lon_0=%.9f +x_0=%.3f +y_0=%.3f "</font>,
00203                  psDefn-&gt;ProjParm[0],
00204                  psDefn-&gt;ProjParm[1],
00205                  dfFalseEasting,
00206                  dfFalseNorthing );
00207     }
00208 
00209 <font class="comment">/* -------------------------------------------------------------------- */</font>
00210 <font class="comment">/*      Oblique Stereographic - Should this really map onto             */</font>
00211 <font class="comment">/*      Stereographic?                                                  */</font>
00212 <font class="comment">/* -------------------------------------------------------------------- */</font>
00213     <font class="keywordflow">else</font> <font class="keywordflow">if</font>( psDefn-&gt;CTProjection == CT_ObliqueStereographic )
00214     {
00215         sprintf( szProjection+strlen(szProjection),
00216            <font class="stringliteral">"+proj=stere +lat_0=%.9f +lon_0=%.9f +k=%f +x_0=%.3f +y_0=%.3f "</font>,
00217                  psDefn-&gt;ProjParm[0],
00218                  psDefn-&gt;ProjParm[1],
00219                  psDefn-&gt;ProjParm[4],
00220                  dfFalseEasting,
00221                  dfFalseNorthing );
00222     }
00223 
00224 <font class="comment">/* -------------------------------------------------------------------- */</font>
00225 <font class="comment">/*      Stereographic                                                   */</font>
00226 <font class="comment">/* -------------------------------------------------------------------- */</font>
00227     <font class="keywordflow">else</font> <font class="keywordflow">if</font>( psDefn-&gt;CTProjection == CT_Stereographic )
00228     {
00229         sprintf( szProjection+strlen(szProjection),
00230            <font class="stringliteral">"+proj=stere +lat_0=%.9f +lon_0=%.9f +x_0=%.3f +y_0=%.3f "</font>,
00231                  psDefn-&gt;ProjParm[0],
00232                  psDefn-&gt;ProjParm[1],
00233                  dfFalseEasting,
00234                  dfFalseNorthing );
00235     }
00236 
00237 <font class="comment">/* -------------------------------------------------------------------- */</font>
00238 <font class="comment">/*      Polar Stereographic                                             */</font>
00239 <font class="comment">/* -------------------------------------------------------------------- */</font>
00240     <font class="keywordflow">else</font> <font class="keywordflow">if</font>( psDefn-&gt;CTProjection == CT_PolarStereographic )
00241     {
00242         sprintf( szProjection+strlen(szProjection),
00243            <font class="stringliteral">"+proj=stere +lat_0=%.9f +lon_0=%.9f +k=%.9f +x_0=%.3f +y_0=%.3f "</font>,
00244                  psDefn-&gt;ProjParm[0],
00245                  psDefn-&gt;ProjParm[1],
00246                  psDefn-&gt;ProjParm[4],
00247                  dfFalseEasting,
00248                  dfFalseNorthing );
00249     }
00250 
00251 <font class="comment">/* -------------------------------------------------------------------- */</font>
00252 <font class="comment">/*      Equirectangular                                                 */</font>
00253 <font class="comment">/* -------------------------------------------------------------------- */</font>
00254     <font class="keywordflow">else</font> <font class="keywordflow">if</font>( psDefn-&gt;CTProjection == CT_Equirectangular )
00255     {
00256         sprintf( szProjection+strlen(szProjection),
00257                  <font class="stringliteral">"+proj=eqc +lat_ts=%.9f +lon_0=%.9f +x_0=%.3f +y_0=%.3f "</font>,
00258                  psDefn-&gt;ProjParm[0],
00259                  psDefn-&gt;ProjParm[1],
00260                  dfFalseEasting,
00261                  dfFalseNorthing );
00262     }
00263 
00264 <font class="comment">/* -------------------------------------------------------------------- */</font>
00265 <font class="comment">/*      Gnomonic                                                        */</font>
00266 <font class="comment">/* -------------------------------------------------------------------- */</font>
00267     <font class="keywordflow">else</font> <font class="keywordflow">if</font>( psDefn-&gt;CTProjection == CT_Gnomonic )
00268     {
00269         sprintf( szProjection+strlen(szProjection),
00270                  <font class="stringliteral">"+proj=gnom +lat_0=%.9f +lon_0=%.9f +x_0=%.3f +y_0=%.3f "</font>,
00271                  psDefn-&gt;ProjParm[0],
00272                  psDefn-&gt;ProjParm[1],
00273                  dfFalseEasting,
00274                  dfFalseNorthing );
00275     }
00276 
00277 <font class="comment">/* -------------------------------------------------------------------- */</font>
00278 <font class="comment">/*      Orthographic                                                    */</font>
00279 <font class="comment">/* -------------------------------------------------------------------- */</font>
00280     <font class="keywordflow">else</font> <font class="keywordflow">if</font>( psDefn-&gt;CTProjection == CT_Orthographic )
00281     {
00282         sprintf( szProjection+strlen(szProjection),
00283                  <font class="stringliteral">"+proj=ortho +lat_0=%.9f +lon_0=%.9f +x_0=%.3f +y_0=%.3f "</font>,
00284                  psDefn-&gt;ProjParm[0],
00285                  psDefn-&gt;ProjParm[1],
00286                  dfFalseEasting,
00287                  dfFalseNorthing );
00288     }
00289 
00290 <font class="comment">/* -------------------------------------------------------------------- */</font>
00291 <font class="comment">/*      Lambert Azimuthal Equal Area                                    */</font>
00292 <font class="comment">/* -------------------------------------------------------------------- */</font>
00293     <font class="keywordflow">else</font> <font class="keywordflow">if</font>( psDefn-&gt;CTProjection == CT_LambertAzimEqualArea )
00294     {
00295         sprintf( szProjection+strlen(szProjection),
00296                  <font class="stringliteral">"+proj=laea +lat_0=%.9f +lon_0=%.9f +x_0=%.3f +y_0=%.3f "</font>,
00297                  psDefn-&gt;ProjParm[0],
00298                  psDefn-&gt;ProjParm[1],
00299                  dfFalseEasting,
00300                  dfFalseNorthing );
00301     }
00302 
00303 <font class="comment">/* -------------------------------------------------------------------- */</font>
00304 <font class="comment">/*      Azimuthal Equidistant                                           */</font>
00305 <font class="comment">/* -------------------------------------------------------------------- */</font>
00306     <font class="keywordflow">else</font> <font class="keywordflow">if</font>( psDefn-&gt;CTProjection == CT_AzimuthalEquidistant )
00307     {
00308         sprintf( szProjection+strlen(szProjection),
00309            <font class="stringliteral">"+proj=aeqd +lat_0=%.9f +lon_0=%.9f +x_0=%.3f +y_0=%.3f "</font>,
00310                  psDefn-&gt;ProjParm[0],
00311                  psDefn-&gt;ProjParm[1],
00312                  dfFalseEasting,
00313                  dfFalseNorthing );
00314     }
00315 
00316 <font class="comment">/* -------------------------------------------------------------------- */</font>
00317 <font class="comment">/*      Miller Cylindrical                                              */</font>
00318 <font class="comment">/* -------------------------------------------------------------------- */</font>
00319     <font class="keywordflow">else</font> <font class="keywordflow">if</font>( psDefn-&gt;CTProjection == CT_MillerCylindrical )
00320     {
00321         sprintf( szProjection+strlen(szProjection),
00322            <font class="stringliteral">"+proj=mill +lat_0=%.9f +lon_0=%.9f +x_0=%.3f +y_0=%.3f +R_A "</font>,
00323                  psDefn-&gt;ProjParm[0],
00324                  psDefn-&gt;ProjParm[1],
00325                  dfFalseEasting,
00326                  dfFalseNorthing );
00327     }
00328 
00329 <font class="comment">/* -------------------------------------------------------------------- */</font>
00330 <font class="comment">/*      Polyconic                                                       */</font>
00331 <font class="comment">/* -------------------------------------------------------------------- */</font>
00332     <font class="keywordflow">else</font> <font class="keywordflow">if</font>( psDefn-&gt;CTProjection == CT_Polyconic )
00333     {
00334         sprintf( szProjection+strlen(szProjection),
00335            <font class="stringliteral">"+proj=poly +lat_0=%.9f +lon_0=%.9f +x_0=%.3f +y_0=%.3f "</font>,
00336                  psDefn-&gt;ProjParm[0],
00337                  psDefn-&gt;ProjParm[1],
00338                  dfFalseEasting,
00339                  dfFalseNorthing );
00340     }
00341 
00342 <font class="comment">/* -------------------------------------------------------------------- */</font>
00343 <font class="comment">/*      AlbersEqualArea                                                 */</font>
00344 <font class="comment">/* -------------------------------------------------------------------- */</font>
00345     <font class="keywordflow">else</font> <font class="keywordflow">if</font>( psDefn-&gt;CTProjection == CT_AlbersEqualArea )
00346     {
00347         sprintf( szProjection+strlen(szProjection),
00348                  <font class="stringliteral">"+proj=aea +lat_1=%.9f +lat_2=%.9f +lat_0=%.9f +lon_0=%.9f"</font>
00349                  <font class="stringliteral">" +x_0=%.3f +y_0=%.3f "</font>,
00350                  psDefn-&gt;ProjParm[0],
00351                  psDefn-&gt;ProjParm[1],
00352                  psDefn-&gt;ProjParm[2],
00353                  psDefn-&gt;ProjParm[3],
00354                  dfFalseEasting,
00355                  dfFalseNorthing );
00356     }
00357     
00358 <font class="comment">/* -------------------------------------------------------------------- */</font>
00359 <font class="comment">/*      EquidistantConic                                                */</font>
00360 <font class="comment">/* -------------------------------------------------------------------- */</font>
00361     <font class="keywordflow">else</font> <font class="keywordflow">if</font>( psDefn-&gt;CTProjection == CT_EquidistantConic )
00362     {
00363         sprintf( szProjection+strlen(szProjection),
00364                  <font class="stringliteral">"+proj=eqdc +lat_1=%.9f +lat_2=%.9f +lat_0=%.9f +lon_0=%.9f"</font>
00365                  <font class="stringliteral">" +x_0=%.3f +y_0=%.3f "</font>,
00366                  psDefn-&gt;ProjParm[0],
00367                  psDefn-&gt;ProjParm[1],
00368                  psDefn-&gt;ProjParm[2],
00369                  psDefn-&gt;ProjParm[3],
00370                  dfFalseEasting,
00371                  dfFalseNorthing );
00372     }
00373     
00374 <font class="comment">/* -------------------------------------------------------------------- */</font>
00375 <font class="comment">/*      Robinson                                                        */</font>
00376 <font class="comment">/* -------------------------------------------------------------------- */</font>
00377     <font class="keywordflow">else</font> <font class="keywordflow">if</font>( psDefn-&gt;CTProjection == CT_Robinson )
00378     {
00379         sprintf( szProjection+strlen(szProjection),
00380                  <font class="stringliteral">"+proj=robin +lon_0=%.9f +x_0=%.3f +y_0=%.3f "</font>,
00381                  psDefn-&gt;ProjParm[1],
00382                  dfFalseEasting,
00383                  dfFalseNorthing );
00384     }
00385     
00386 <font class="comment">/* -------------------------------------------------------------------- */</font>
00387 <font class="comment">/*      VanDerGrinten                                                   */</font>
00388 <font class="comment">/* -------------------------------------------------------------------- */</font>
00389     <font class="keywordflow">else</font> <font class="keywordflow">if</font>( psDefn-&gt;CTProjection == CT_VanDerGrinten )
00390     {
00391         sprintf( szProjection+strlen(szProjection),
00392                  <font class="stringliteral">"+proj=vandg +lon_0=%.9f +x_0=%.3f +y_0=%.3f +R_A "</font>,
00393                  psDefn-&gt;ProjParm[1],
00394                  dfFalseEasting,
00395                  dfFalseNorthing );
00396     }
00397     
00398 <font class="comment">/* -------------------------------------------------------------------- */</font>
00399 <font class="comment">/*      Sinusoidal                                                      */</font>
00400 <font class="comment">/* -------------------------------------------------------------------- */</font>
00401     <font class="keywordflow">else</font> <font class="keywordflow">if</font>( psDefn-&gt;CTProjection == CT_Sinusoidal )
00402     {
00403         sprintf( szProjection+strlen(szProjection),
00404                  <font class="stringliteral">"+proj=sinu +lon_0=%.9f +x_0=%.3f +y_0=%.3f "</font>,
00405                  psDefn-&gt;ProjParm[1],
00406                  dfFalseEasting,
00407                  dfFalseNorthing );
00408     }
00409     
00410 <font class="comment">/* -------------------------------------------------------------------- */</font>
00411 <font class="comment">/*      LambertConfConic_2SP                                            */</font>
00412 <font class="comment">/* -------------------------------------------------------------------- */</font>
00413     <font class="keywordflow">else</font> <font class="keywordflow">if</font>( psDefn-&gt;CTProjection == CT_LambertConfConic_2SP )
00414     {
00415         sprintf( szProjection+strlen(szProjection),
00416                  <font class="stringliteral">"+proj=lcc +lat_0=%.9f +lon_0=%.9f +lat_1=%.9f +lat_2=%.9f "</font>
00417                  <font class="stringliteral">" +x_0=%.3f +y_0=%.3f "</font>,
00418                  psDefn-&gt;ProjParm[0],
00419                  psDefn-&gt;ProjParm[1],
00420                  psDefn-&gt;ProjParm[2],
00421                  psDefn-&gt;ProjParm[3],
00422                  dfFalseEasting,
00423                  dfFalseNorthing );
00424     }
00425     
00426 <font class="comment">/* -------------------------------------------------------------------- */</font>
00427 <font class="comment">/*      LambertConfConic_1SP                                            */</font>
00428 <font class="comment">/* -------------------------------------------------------------------- */</font>
00429     <font class="keywordflow">else</font> <font class="keywordflow">if</font>( psDefn-&gt;CTProjection == CT_LambertConfConic_1SP )
00430     {
00431         <font class="comment">/* this appears to be an unsupported formulation with PROJ.4 */</font>
00432 
00433         <font class="comment">/* to at least some degree this can be treated similarly to</font>
00434 <font class="comment">         * the 2SP case.</font>
00435 <font class="comment">         *</font>
00436 <font class="comment">         * See http://www.mentorsoftwareinc.com/CC/asknorm/ASK0699.HTM#Q2</font>
00437 <font class="comment">         */</font>
00438     }
00439     
00440 <font class="comment">/* -------------------------------------------------------------------- */</font>
00441 <font class="comment">/*      NewZealandMapGrid                                               */</font>
00442 <font class="comment">/* -------------------------------------------------------------------- */</font>
00443     <font class="keywordflow">else</font> <font class="keywordflow">if</font>( psDefn-&gt;CTProjection == CT_NewZealandMapGrid )
00444     {
00445         <font class="comment">/* this appears to be an unsupported formulation with PROJ.4 */</font>
00446     }
00447     
00448 <font class="comment">/* -------------------------------------------------------------------- */</font>
00449 <font class="comment">/*      Transverse Mercator - south oriented.                           */</font>
00450 <font class="comment">/* -------------------------------------------------------------------- */</font>
00451     <font class="keywordflow">else</font> <font class="keywordflow">if</font>( psDefn-&gt;CTProjection == CT_TransvMercator_SouthOriented )
00452     {
00453         <font class="comment">/* this appears to be an unsupported formulation with PROJ.4 */</font>
00454     }
00455     
00456 <font class="comment">/* -------------------------------------------------------------------- */</font>
00457 <font class="comment">/*      ObliqueMercator (Hotine)                                        */</font>
00458 <font class="comment">/* -------------------------------------------------------------------- */</font>
00459     <font class="keywordflow">else</font> <font class="keywordflow">if</font>( psDefn-&gt;CTProjection == CT_ObliqueMercator )
00460     {
00461         <font class="comment">/* not clear how ProjParm[3] - angle from rectified to skewed grid -</font>
00462 <font class="comment">           should be applied ... see the +not_rot flag for PROJ.4.</font>
00463 <font class="comment">           Just ignoring for now. */</font>
00464 
00465         sprintf( szProjection+strlen(szProjection),
00466                  <font class="stringliteral">"+proj=omerc +lat_0=%.9f +lonc=%.9f +alpha=%.9f"</font>
00467                  <font class="stringliteral">" +k=%.9f +x_0=%.3f +y_0=%.3f "</font>,
00468                  psDefn-&gt;ProjParm[0],
00469                  psDefn-&gt;ProjParm[1],
00470                  psDefn-&gt;ProjParm[2],
00471                  psDefn-&gt;ProjParm[4],
00472                  psDefn-&gt;ProjParm[5],
00473                  psDefn-&gt;ProjParm[6] );
00474     }
00475 
00476 <font class="comment">/* ==================================================================== */</font>
00477 <font class="comment">/*      Handle ellipsoid information.                                   */</font>
00478 <font class="comment">/* ==================================================================== */</font>
00479     <font class="keywordflow">if</font>( psDefn-&gt;Ellipsoid == Ellipse_WGS_84 )
00480         strcat( szProjection, <font class="stringliteral">"+ellps=WGS84 "</font> );
00481     <font class="keywordflow">else</font> <font class="keywordflow">if</font>( psDefn-&gt;Ellipsoid == Ellipse_Clarke_1866 )
00482         strcat( szProjection, <font class="stringliteral">"+ellps=clrk66 "</font> );
00483     <font class="keywordflow">else</font> <font class="keywordflow">if</font>( psDefn-&gt;Ellipsoid == Ellipse_Clarke_1880 )
00484         strcat( szProjection, <font class="stringliteral">"+ellps=clrk80 "</font> );
00485     <font class="keywordflow">else</font> <font class="keywordflow">if</font>( psDefn-&gt;Ellipsoid == Ellipse_GRS_1980 )
00486         strcat( szProjection, <font class="stringliteral">"+ellps=GRS80 "</font> );
00487     <font class="keywordflow">else</font>
00488     {
00489         <font class="keywordflow">if</font>( psDefn-&gt;SemiMajor != 0.0 &amp;&amp; psDefn-&gt;SemiMinor != 0.0 )
00490         {
00491             sprintf( szProjection+strlen(szProjection),
00492                      <font class="stringliteral">"+a=%.3f +b=%.3f "</font>,
00493                      psDefn-&gt;SemiMajor,
00494                      psDefn-&gt;SemiMinor );
00495         }
00496     }
00497 
00498     strcat( szProjection, szUnits );
00499 
00500     <font class="keywordflow">return</font>( strdup( szProjection ) );
00501 }
00502 
00503 <font class="preprocessor">#if !defined(HAVE_LIBPROJ) || !defined(HAVE_PROJECTS_H)</font>
00504 <font class="preprocessor"></font>
00505 <font class="keywordtype">int</font> GTIFProj4ToLatLong( <a class="code" href="struct_GTIFDefn.html">GTIFDefn</a> * psDefn, <font class="keywordtype">int</font> nPoints,
00506                         <font class="keywordtype">double</font> *padfX, <font class="keywordtype">double</font> *padfY )<font class="keyword"></font>
00507 <font class="keyword"></font>{
00508 <font class="preprocessor">#ifdef DEBUG    </font>
00509 <font class="preprocessor"></font>    fprintf( stderr,
00510              <font class="stringliteral">"GTIFProj4ToLatLong() - PROJ.4 support not compiled in.\n"</font> );
00511 <font class="preprocessor">#endif    </font>
00512 <font class="preprocessor"></font>    <font class="keywordflow">return</font> FALSE;
00513 }
00514 
00515 <font class="keywordtype">int</font> GTIFProj4FromLatLong( <a class="code" href="struct_GTIFDefn.html">GTIFDefn</a> * psDefn, <font class="keywordtype">int</font> nPoints,
00516                           <font class="keywordtype">double</font> *padfX, <font class="keywordtype">double</font> *padfY )<font class="keyword"></font>
00517 <font class="keyword"></font>{
00518 <font class="preprocessor">#ifdef DEBUG    </font>
00519 <font class="preprocessor"></font>    fprintf( stderr,
00520              <font class="stringliteral">"GTIFProj4FromLatLong() - PROJ.4 support not compiled in.\n"</font> );
00521 <font class="preprocessor">#endif    </font>
00522 <font class="preprocessor"></font>    <font class="keywordflow">return</font> FALSE;
00523 }
00524 <font class="preprocessor">#else</font>
00525 <font class="preprocessor"></font>
00526 <font class="preprocessor">#include "projects.h"</font>
00527 
00528 <font class="preprocessor">#ifdef USE_PROJUV</font>
00529 <font class="preprocessor"></font><font class="preprocessor">#  define UV projUV</font>
00530 <font class="preprocessor"></font><font class="preprocessor">#endif</font>
00531 <font class="preprocessor"></font>
00532 <font class="comment">/************************************************************************/</font>
00533 <font class="comment">/*                        GTIFProj4FromLatLong()                        */</font>
00534 <font class="comment">/*                                                                      */</font>
00535 <font class="comment">/*      Convert lat/long values to projected coordinate for a           */</font>
00536 <font class="comment">/*      particular definition.                                          */</font>
00537 <font class="comment">/************************************************************************/</font>
00538 
00539 <font class="keywordtype">int</font> GTIFProj4FromLatLong( <a class="code" href="struct_GTIFDefn.html">GTIFDefn</a> * psDefn, <font class="keywordtype">int</font> nPoints,
00540                           <font class="keywordtype">double</font> *padfX, <font class="keywordtype">double</font> *padfY )<font class="keyword"></font>
00541 <font class="keyword"></font>
00542 <font class="keyword"></font>{
00543     <font class="keywordtype">char</font>        *pszProjection, **papszArgs;
00544     PJ          *psPJ;
00545     <font class="keywordtype">int</font>         i;
00546     
00547 <font class="comment">/* -------------------------------------------------------------------- */</font>
00548 <font class="comment">/*      Get a projection definition.                                    */</font>
00549 <font class="comment">/* -------------------------------------------------------------------- */</font>
00550     pszProjection = GTIFGetProj4Defn( psDefn );
00551 
00552     <font class="keywordflow">if</font>( pszProjection == NULL )
00553         <font class="keywordflow">return</font> FALSE;
00554 
00555 <font class="comment">/* -------------------------------------------------------------------- */</font>
00556 <font class="comment">/*      Parse into tokens for pj_init(), and initialize the projection. */</font>
00557 <font class="comment">/* -------------------------------------------------------------------- */</font>
00558     
00559     papszArgs = CSLTokenizeStringComplex( pszProjection, <font class="stringliteral">" +"</font>, TRUE, FALSE );
00560     free( pszProjection );
00561 
00562     psPJ = pj_init( CSLCount(papszArgs), papszArgs );
00563 
00564     CSLDestroy( papszArgs );
00565 
00566     <font class="keywordflow">if</font>( psPJ == NULL )
00567     {
00568         <font class="keywordflow">return</font> FALSE;
00569     }
00570 
00571 <font class="comment">/* -------------------------------------------------------------------- */</font>
00572 <font class="comment">/*      Process each of the points.                                     */</font>
00573 <font class="comment">/* -------------------------------------------------------------------- */</font>
00574     <font class="keywordflow">for</font>( i = 0; i &lt; nPoints; i++ )
00575     {
00576         UV      sUV;
00577 
00578         sUV.u = padfX[i] * DEG_TO_RAD;
00579         sUV.v = padfY[i] * DEG_TO_RAD;
00580 
00581         sUV = pj_fwd( sUV, psPJ );
00582 
00583         padfX[i] = sUV.u;
00584         padfY[i] = sUV.v;
00585     }
00586 
00587     <font class="keywordflow">return</font> TRUE;
00588 }
00589 
00590 <font class="comment">/************************************************************************/</font>
00591 <font class="comment">/*                         GTIFProj4ToLatLong()                         */</font>
00592 <font class="comment">/*                                                                      */</font>
00593 <font class="comment">/*      Convert projection coordinates to lat/long for a particular     */</font>
00594 <font class="comment">/*      definition.                                                     */</font>
00595 <font class="comment">/************************************************************************/</font>
00596 
00597 <font class="keywordtype">int</font> GTIFProj4ToLatLong( <a class="code" href="struct_GTIFDefn.html">GTIFDefn</a> * psDefn, <font class="keywordtype">int</font> nPoints,
00598                         <font class="keywordtype">double</font> *padfX, <font class="keywordtype">double</font> *padfY )<font class="keyword"></font>
00599 <font class="keyword"></font>
00600 <font class="keyword"></font>{
00601     <font class="keywordtype">char</font>        *pszProjection, **papszArgs;
00602     PJ          *psPJ;
00603     <font class="keywordtype">int</font>         i;
00604     
00605 <font class="comment">/* -------------------------------------------------------------------- */</font>
00606 <font class="comment">/*      Get a projection definition.                                    */</font>
00607 <font class="comment">/* -------------------------------------------------------------------- */</font>
00608     pszProjection = GTIFGetProj4Defn( psDefn );
00609 
00610     <font class="keywordflow">if</font>( pszProjection == NULL )
00611         <font class="keywordflow">return</font> FALSE;
00612 
00613 <font class="comment">/* -------------------------------------------------------------------- */</font>
00614 <font class="comment">/*      Parse into tokens for pj_init(), and initialize the projection. */</font>
00615 <font class="comment">/* -------------------------------------------------------------------- */</font>
00616     
00617     papszArgs = CSLTokenizeStringComplex( pszProjection, <font class="stringliteral">" +"</font>, TRUE, FALSE );
00618     free( pszProjection );
00619 
00620     psPJ = pj_init( CSLCount(papszArgs), papszArgs );
00621 
00622     CSLDestroy( papszArgs );
00623 
00624     <font class="keywordflow">if</font>( psPJ == NULL )
00625     {
00626         <font class="keywordflow">return</font> FALSE;
00627     }
00628 
00629 <font class="comment">/* -------------------------------------------------------------------- */</font>
00630 <font class="comment">/*      Process each of the points.                                     */</font>
00631 <font class="comment">/* -------------------------------------------------------------------- */</font>
00632     <font class="keywordflow">for</font>( i = 0; i &lt; nPoints; i++ )
00633     {
00634         UV      sUV;
00635 
00636         sUV.u = padfX[i];
00637         sUV.v = padfY[i];
00638 
00639         sUV = pj_inv( sUV, psPJ );
00640 
00641         padfX[i] = sUV.u * RAD_TO_DEG;
00642         padfY[i] = sUV.v * RAD_TO_DEG;
00643     }
00644 
00645     <font class="keywordflow">return</font> TRUE;
00646 }
00647 
00648 
00649 <font class="preprocessor">#endif </font><font class="comment">/* has projects.h and -lproj */</font>
00650 
</div></pre><hr><address><small>Generated at Sun Mar 4 23:32:45 2001 for libgeotiff by
<a href="http://www.stack.nl/~dimitri/doxygen/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.3-20001105 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2000</small></address>
</body>
</html>
